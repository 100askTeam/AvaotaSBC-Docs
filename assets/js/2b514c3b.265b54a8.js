"use strict";(self.webpackChunkavaota_docs=self.webpackChunkavaota_docs||[]).push([[7960],{9322:(n,r,t)=>{t.r(r),t.d(r,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>d});var e=t(85893),l=t(11151);const i={},a="UART - \u901a\u7528\u5f02\u6b65\u6536\u53d1\u4f20\u8f93\u5668",s={id:"linux-manual/amp-docs/hal/uart",title:"UART - \u901a\u7528\u5f02\u6b65\u6536\u53d1\u4f20\u8f93\u5668",description:"Universal Asynchronous Receiver/Transmitter\uff0c\u901a\u7528\u5f02\u6b65\u6536\u53d1\u4f20\u8f93\u5668",source:"@site/docs/linux-manual/amp-docs/hal/uart.md",sourceDirName:"linux-manual/amp-docs/hal",slug:"/linux-manual/amp-docs/hal/uart",permalink:"/linux-manual/amp-docs/hal/uart",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"linuxManualSidebar",previous:{title:"TWI - \u53cc\u603b\u7ebf\u534f\u8bae",permalink:"/linux-manual/amp-docs/hal/twi"},next:{title:"NPU \u5f00\u53d1",permalink:"/category/npu-\u5f00\u53d1"}},c={},d=[{value:"\u6a21\u5757\u914d\u7f6e",id:"\u6a21\u5757\u914d\u7f6e",level:2},{value:"\u6e90\u7801\u7ed3\u6784",id:"\u6e90\u7801\u7ed3\u6784",level:2},{value:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",level:2},{value:"\u8fd4\u56de\u503c\u679a\u4e3e",id:"\u8fd4\u56de\u503c\u679a\u4e3e",level:3},{value:"\u6ce2\u7279\u7387\u679a\u4e3e",id:"\u6ce2\u7279\u7387\u679a\u4e3e",level:3},{value:"UART \u5b57\u957f\u679a\u4e3e",id:"uart-\u5b57\u957f\u679a\u4e3e",level:3},{value:"UART \u505c\u6b62\u4f4d\u679a\u4e3e",id:"uart-\u505c\u6b62\u4f4d\u679a\u4e3e",level:3},{value:"UART \u5947\u5076\u679a\u4e3e",id:"uart-\u5947\u5076\u679a\u4e3e",level:3},{value:"UART \u914d\u7f6e\u7ed3\u6784\u4f53",id:"uart-\u914d\u7f6e\u7ed3\u6784\u4f53",level:3},{value:"\u83b7\u53d6UART\u9a71\u52a8\u7684\u7248\u672c\u53f7",id:"\u83b7\u53d6uart\u9a71\u52a8\u7684\u7248\u672c\u53f7",level:3},{value:"\u521d\u59cb\u5316UART\u9a71\u52a8",id:"\u521d\u59cb\u5316uart\u9a71\u52a8",level:3},{value:"\u521d\u59cb\u5316\u5f02\u6784AMP UART\u63a7\u5236\u53f0",id:"\u521d\u59cb\u5316\u5f02\u6784amp-uart\u63a7\u5236\u53f0",level:3},{value:"\u5378\u8f7dUART\u9a71\u52a8",id:"\u5378\u8f7duart\u9a71\u52a8",level:3},{value:"\u53d1\u9001\u6570\u636e",id:"\u53d1\u9001\u6570\u636e",level:3},{value:"\u53d1\u9001\u4e00\u4e2a\u5b57\u7b26",id:"\u53d1\u9001\u4e00\u4e2a\u5b57\u7b26",level:3},{value:"\u63a5\u6536\u6570\u636e",id:"\u63a5\u6536\u6570\u636e",level:3},{value:"\u975e\u963b\u585e\u63a5\u6536\u6570\u636e",id:"\u975e\u963b\u585e\u63a5\u6536\u6570\u636e",level:3},{value:"\u63a5\u6536\u4e00\u4e2a\u5b57\u7b26",id:"\u63a5\u6536\u4e00\u4e2a\u5b57\u7b26",level:3},{value:"\u8bbe\u7f6e UART \u5de5\u4f5c\u53c2\u6570",id:"\u8bbe\u7f6e-uart-\u5de5\u4f5c\u53c2\u6570",level:3},{value:"\u8f6e\u8be2\u63a5\u6536",id:"\u8f6e\u8be2\u63a5\u6536",level:3},{value:"\u67e5\u770b\u8f6e\u8be2\u63a5\u6536\u72b6\u6001",id:"\u67e5\u770b\u8f6e\u8be2\u63a5\u6536\u72b6\u6001",level:3},{value:"\u6267\u884c\u5524\u9192\u5904\u7406\u51fd\u6570",id:"\u6267\u884c\u5524\u9192\u5904\u7406\u51fd\u6570",level:3},{value:"\u6ce8\u518c\u5524\u9192\u5904\u7406\u51fd\u6570",id:"\u6ce8\u518c\u5524\u9192\u5904\u7406\u51fd\u6570",level:3},{value:"\u8bbe\u7f6e\u786c\u4ef6\u6d41\u63a7",id:"\u8bbe\u7f6e\u786c\u4ef6\u6d41\u63a7",level:3},{value:"\u7981\u7528\u786c\u4ef6\u6d41\u63a7",id:"\u7981\u7528\u786c\u4ef6\u6d41\u63a7",level:3},{value:"\u8bbe\u7f6e UART \u56de\u73af",id:"\u8bbe\u7f6e-uart-\u56de\u73af",level:3},{value:"\u4f7f\u80fd RX \u4e2d\u65ad",id:"\u4f7f\u80fd-rx-\u4e2d\u65ad",level:3},{value:"\u5931\u80fd RX \u4e2d\u65ad",id:"\u5931\u80fd-rx-\u4e2d\u65ad",level:3},{value:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",level:2}];function _(n){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.a)(),...n.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(r.h1,{id:"uart---\u901a\u7528\u5f02\u6b65\u6536\u53d1\u4f20\u8f93\u5668",children:"UART - \u901a\u7528\u5f02\u6b65\u6536\u53d1\u4f20\u8f93\u5668"}),"\n",(0,e.jsx)(r.p,{children:"Universal Asynchronous Receiver/Transmitter\uff0c\u901a\u7528\u5f02\u6b65\u6536\u53d1\u4f20\u8f93\u5668"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"Compatible with industry-standard 16450/16550 UARTs"}),"\n",(0,e.jsx)(r.li,{children:"64-Byte Transmit and receive data FIFOs"}),"\n",(0,e.jsx)(r.li,{children:"Supports DMA controller interface"}),"\n",(0,e.jsx)(r.li,{children:"Supports Software/ Hardware Flow Control"}),"\n",(0,e.jsx)(r.li,{children:"Supports IrDA 1.0 SIR"}),"\n",(0,e.jsx)(r.li,{children:"Supports RS-485 mode"}),"\n"]}),"\n",(0,e.jsx)(r.h2,{id:"\u6a21\u5757\u914d\u7f6e",children:"\u6a21\u5757\u914d\u7f6e"}),"\n",(0,e.jsx)(r.p,{children:"\u5176menuconfig \u7684\u914d\u7f6e\u5982\u4e0b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-shell",children:"Kernel Setup ---\x3e\r\n    Drivers Setup ---\x3e\r\n        SoC HAL Drivers ---\x3e\r\n            UART devices ---\x3e\r\n                [*] enable uart driver\r\n                [*] enbale uart hal APIs Test command\n"})}),"\n",(0,e.jsx)(r.h2,{id:"\u6e90\u7801\u7ed3\u6784",children:"\u6e90\u7801\u7ed3\u6784"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:".\r\n\u2502  hal_uart.c         # \u9a71\u52a8\u6e90\u7801\r\n\u2502  platform-uart.h    # \u5e73\u53f0\u9009\u62e9\u5934\u6587\u4ef6\r\n\u2502  uart.h             # \u9a71\u52a8\u79c1\u6709\u5934\u6587\u4ef6\r\n\u2514\u2500platform\r\n        uart-sun20iw2p1.h # \u5e73\u53f0\u7279\u5316\u5b9a\u4e49\n"})}),"\n",(0,e.jsx)(r.h2,{id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",children:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e"}),"\n",(0,e.jsx)(r.p,{children:"\u5934\u6587\u4ef6"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"#include <hal_uart.h>\n"})}),"\n",(0,e.jsx)(r.h3,{id:"\u8fd4\u56de\u503c\u679a\u4e3e",children:"\u8fd4\u56de\u503c\u679a\u4e3e"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"typedef enum\r\n{\r\n    HAL_UART_STATUS_ERROR_PARAMETER = -4,      /**< Invalid user input parameter. */\r\n    HAL_UART_STATUS_ERROR_BUSY = -3,           /**< UART port is currently in use. */\r\n    HAL_UART_STATUS_ERROR_UNINITIALIZED = -2,  /**< UART port has not been initialized. */\r\n    HAL_UART_STATUS_ERROR = -1,                /**< UART driver detected a common error. */\r\n    HAL_UART_STATUS_OK = 0                     /**< UART function executed successfully. */\r\n} hal_uart_status_t;\n"})}),"\n",(0,e.jsx)(r.h3,{id:"\u6ce2\u7279\u7387\u679a\u4e3e",children:"\u6ce2\u7279\u7387\u679a\u4e3e"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"typedef enum\r\n{\r\n    UART_BAUDRATE_300 = 0,\r\n    UART_BAUDRATE_600,\r\n    UART_BAUDRATE_1200,\r\n    UART_BAUDRATE_2400,\r\n    UART_BAUDRATE_4800,\r\n    UART_BAUDRATE_9600,\r\n    UART_BAUDRATE_19200,\r\n    UART_BAUDRATE_38400,\r\n    UART_BAUDRATE_57600,\r\n    UART_BAUDRATE_115200,\r\n    UART_BAUDRATE_230400,\r\n    UART_BAUDRATE_576000,\r\n    UART_BAUDRATE_921600,\r\n    UART_BAUDRATE_1000000,\r\n    UART_BAUDRATE_1500000,\r\n    UART_BAUDRATE_3000000,\r\n    UART_BAUDRATE_4000000,\r\n    UART_BAUDRATE_MAX,\r\n} uart_baudrate_t;\n"})}),"\n",(0,e.jsx)(r.h3,{id:"uart-\u5b57\u957f\u679a\u4e3e",children:"UART \u5b57\u957f\u679a\u4e3e"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"typedef enum\r\n{\r\n    UART_WORD_LENGTH_5 = 0,\r\n    UART_WORD_LENGTH_6,\r\n    UART_WORD_LENGTH_7,\r\n    UART_WORD_LENGTH_8,\r\n} uart_word_length_t;\n"})}),"\n",(0,e.jsx)(r.h3,{id:"uart-\u505c\u6b62\u4f4d\u679a\u4e3e",children:"UART \u505c\u6b62\u4f4d\u679a\u4e3e"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"typedef enum\r\n{\r\n    UART_STOP_BIT_1 = 0,\r\n    UART_STOP_BIT_2,\r\n} uart_stop_bit_t;\n"})}),"\n",(0,e.jsx)(r.h3,{id:"uart-\u5947\u5076\u679a\u4e3e",children:"UART \u5947\u5076\u679a\u4e3e"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"typedef enum\r\n{\r\n    UART_PARITY_NONE = 0,\r\n    UART_PARITY_ODD,\r\n    UART_PARITY_EVEN\r\n} uart_parity_t;\n"})}),"\n",(0,e.jsx)(r.h3,{id:"uart-\u914d\u7f6e\u7ed3\u6784\u4f53",children:"UART \u914d\u7f6e\u7ed3\u6784\u4f53"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"typedef struct\r\n{\r\n    uart_baudrate_t baudrate;\r\n    uart_word_length_t word_length;\r\n    uart_stop_bit_t stop_bit;\r\n    uart_parity_t parity;\r\n} _uart_config_t;\n"})}),"\n",(0,e.jsx)(r.h3,{id:"\u83b7\u53d6uart\u9a71\u52a8\u7684\u7248\u672c\u53f7",children:"\u83b7\u53d6UART\u9a71\u52a8\u7684\u7248\u672c\u53f7"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"sunxi_hal_version_t hal_uart_get_version(int32_t dev)\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"dev\uff1aUART\u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"UART \u9a71\u52a8\u7248\u672c\u53f7"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u521d\u59cb\u5316uart\u9a71\u52a8",children:"\u521d\u59cb\u5316UART\u9a71\u52a8"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_init(int32_t uart_port);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"uart_port\uff1aUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,e.jsx)(r.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u521d\u59cb\u5316\u5f02\u6784amp-uart\u63a7\u5236\u53f0",children:"\u521d\u59cb\u5316\u5f02\u6784AMP UART\u63a7\u5236\u53f0"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_init_for_amp_cli(int32_t uart_port);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"uart_port\uff1aUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,e.jsx)(r.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u5378\u8f7duart\u9a71\u52a8",children:"\u5378\u8f7dUART\u9a71\u52a8"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_deinit(int32_t uart_port);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"uart_port\uff1aUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,e.jsx)(r.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u53d1\u9001\u6570\u636e",children:"\u53d1\u9001\u6570\u636e"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_send(int32_t dev, const uint8_t *data, uint32_t num);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"dev\uff1aUART \u7aef\u53e3\u53f7"}),"\n",(0,e.jsx)(r.li,{children:"data\uff1a\u51c6\u5907\u53d1\u9001\u7684\u6570\u636ebuffer"}),"\n",(0,e.jsx)(r.li,{children:"num\uff1abuffer \u5927\u5c0f"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"\u6210\u529f\u53d1\u9001\u7684\u5b57\u8282\u6570"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u53d1\u9001\u4e00\u4e2a\u5b57\u7b26",children:"\u53d1\u9001\u4e00\u4e2a\u5b57\u7b26"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_put_char(int32_t dev, char c);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"dev\uff1aUART \u7aef\u53e3\u53f7"}),"\n",(0,e.jsx)(r.li,{children:"c\uff1a\u5f85\u53d1\u9001\u7684\u5b57\u7b26"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"1\uff1a\u6210\u529f"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u63a5\u6536\u6570\u636e",children:"\u63a5\u6536\u6570\u636e"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_receive(int32_t dev, uint8_t *data, uint32_t num);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"dev\uff1aUART \u7aef\u53e3\u53f7"}),"\n",(0,e.jsx)(r.li,{children:"data\uff1a\u63a5\u6536\u6570\u636e\u7f13\u51b2\u533a"}),"\n",(0,e.jsx)(r.li,{children:"num\uff1a\u63a5\u6536\u6570\u636e\u7684\u5927\u5c0f"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"size\uff1a\u63a5\u6536\u5230\u7684\u6570\u636e\u5927\u5c0f"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u975e\u963b\u585e\u63a5\u6536\u6570\u636e",children:"\u975e\u963b\u585e\u63a5\u6536\u6570\u636e"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_receive_no_block(int32_t dev, uint8_t *data, uint32_t num, int32_t timeout);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"dev\uff1aUART \u7aef\u53e3\u53f7"}),"\n",(0,e.jsx)(r.li,{children:"data\uff1a\u63a5\u6536\u6570\u636e\u7f13\u51b2\u533a"}),"\n",(0,e.jsx)(r.li,{children:"num\uff1a\u63a5\u6536\u6570\u636e\u7684\u5927\u5c0f"}),"\n",(0,e.jsx)(r.li,{children:"timeout\uff1a\u8d85\u65f6\u65f6\u95f4"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"size\uff1a\u63a5\u6536\u5230\u7684\u6570\u636e\u5927\u5c0f"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u63a5\u6536\u4e00\u4e2a\u5b57\u7b26",children:"\u63a5\u6536\u4e00\u4e2a\u5b57\u7b26"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"uint8_t hal_uart_get_char(int32_t dev);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"dev\uff1aUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"\u6536\u5230\u7684\u5b57\u7b26\u503c"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u8bbe\u7f6e-uart-\u5de5\u4f5c\u53c2\u6570",children:"\u8bbe\u7f6e UART \u5de5\u4f5c\u53c2\u6570"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_control(int32_t uart_port, int cmd, void *args);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"uart_port\uff1aUART \u7aef\u53e3\u53f7"}),"\n",(0,e.jsx)(r.li,{children:"cmd\uff1a\u4fdd\u7559"}),"\n",(0,e.jsx)(r.li,{children:"args:  \u6307\u5411 _uart_config_t \u7c7b\u578b\u7684\u7ed3\u6784\u4f53"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,e.jsx)(r.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u8f6e\u8be2\u63a5\u6536",children:"\u8f6e\u8be2\u63a5\u6536"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_receive_polling(int32_t dev, uint8_t *data, uint32_t num);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"dev\uff1aUART \u7aef\u53e3\u53f7"}),"\n",(0,e.jsx)(r.li,{children:"data\uff1a\u63a5\u6536\u6570\u636e\u7f13\u51b2\u533a"}),"\n",(0,e.jsx)(r.li,{children:"num\uff1a\u63a5\u6536\u6570\u636e\u7684\u5927\u5c0f"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"size\uff1a\u63a5\u6536\u5230\u7684\u6570\u636e\u5927\u5c0f"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u67e5\u770b\u8f6e\u8be2\u63a5\u6536\u72b6\u6001",children:"\u67e5\u770b\u8f6e\u8be2\u63a5\u6536\u72b6\u6001"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_check_poll_state(int32_t dev_id, short key);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"dev_id\uff1aUART \u7aef\u53e3\u53f7"}),"\n",(0,e.jsx)(r.li,{children:"key\uff1a\u6807\u5fd7\u4f4d\uff0c\u53d6\u503c POLLIN\uff0cPOLLOUT\uff0cPOLLERR"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"UART \u5f53\u524d\u7684\u63a5\u6536\u72b6\u6001"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u6267\u884c\u5524\u9192\u5904\u7406\u51fd\u6570",children:"\u6267\u884c\u5524\u9192\u5904\u7406\u51fd\u6570"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_poll_wakeup(int32_t dev_id, short key);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"dev_id\uff1aUART \u7aef\u53e3\u53f7"}),"\n",(0,e.jsx)(r.li,{children:"key\uff1a\u6807\u5fd7\u4f4d\uff0c\u53d6\u503c POLLIN\uff0cPOLLOUT\uff0cPOLLERR"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"\u56de\u8c03\u51fd\u6570\u6267\u884c\u8fd4\u56de\u503c"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u6ce8\u518c\u5524\u9192\u5904\u7406\u51fd\u6570",children:"\u6ce8\u518c\u5524\u9192\u5904\u7406\u51fd\u6570"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_register_poll_wakeup(poll_wakeup_func poll_wakeup);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"poll_wakeup\uff1a\u56de\u8c03\u51fd\u6570"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"0"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u8bbe\u7f6e\u786c\u4ef6\u6d41\u63a7",children:"\u8bbe\u7f6e\u786c\u4ef6\u6d41\u63a7"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"void hal_uart_set_hardware_flowcontrol(uart_port_t uart_port);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"uart_port\uff1aUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"\u65e0"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u7981\u7528\u786c\u4ef6\u6d41\u63a7",children:"\u7981\u7528\u786c\u4ef6\u6d41\u63a7"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"void hal_uart_disable_flowcontrol(uart_port_t uart_port);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"uart_port\uff1aUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"\u65e0"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u8bbe\u7f6e-uart-\u56de\u73af",children:"\u8bbe\u7f6e UART \u56de\u73af"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"void hal_uart_set_loopback(uart_port_t uart_port, bool enable);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"uart_port\uff1aUART \u7aef\u53e3\u53f7"}),"\n",(0,e.jsx)(r.li,{children:"enable\uff1a\u662f\u5426\u5f00\u542f"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"\u65e0"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u4f7f\u80fd-rx-\u4e2d\u65ad",children:"\u4f7f\u80fd RX \u4e2d\u65ad"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_enable_rx(int32_t uart_port);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"uart_port\uff1aUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"0"}),"\n"]}),"\n",(0,e.jsx)(r.h3,{id:"\u5931\u80fd-rx-\u4e2d\u65ad",children:"\u5931\u80fd RX \u4e2d\u65ad"}),"\n",(0,e.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:"int32_t hal_uart_disable_rx(int32_t uart_port);\n"})}),"\n",(0,e.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"uart_port\uff1aUART \u7aef\u53e3\u53f7"}),"\n"]}),"\n",(0,e.jsx)(r.p,{children:"\u8fd4\u56de\uff1a"}),"\n",(0,e.jsxs)(r.ul,{children:["\n",(0,e.jsx)(r.li,{children:"0"}),"\n"]}),"\n",(0,e.jsx)(r.h2,{id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",children:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b"}),"\n",(0,e.jsx)(r.pre,{children:(0,e.jsx)(r.code,{className:"language-c",children:'#include <stdio.h>\r\n#include <stdlib.h>\r\n#include <stdint.h>\r\n#include <string.h>\r\n\r\n#include <hal_log.h>\r\n#include <hal_cmd.h>\r\n#include <hal_timer.h>\r\n#include <hal_uart.h>\r\n\r\nstatic void cmd_usage(void)\r\n{\r\n\tprintf("Usage:\\n"\r\n\t\t"\\t hal_uart <port> <baudrate>\\n");\r\n}\r\n\r\nint cmd_test_uart(int argc, char **argv)\r\n{\r\n\tuint8_t tbuf[6] = {"hello"};\r\n\tuint8_t rbuf[10] = {0};\r\n\tuart_port_t port;\r\n\tuint32_t baudrate;\r\n\t_uart_config_t uart_config;\r\n\tint i;\r\n\r\n\thal_log_info("Testing UART in loopback mode");\r\n\r\n\tif (argc != 3) {\r\n\t\tcmd_usage();\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tport = strtol(argv[1], NULL, 0);\r\n\tbaudrate = strtol(argv[2], NULL, 0);\r\n\r\n\tif(CONFIG_CLI_UART_PORT == port){\r\n\t\thal_log_info("uart0 can\'t test, please use other port!");\r\n\t\treturn -1;\r\n\t}\r\n\tmemset(rbuf, 0, 10 * sizeof(uint8_t));\r\n\r\n\tswitch (baudrate) {\r\n\tcase 4800:\r\n\t\tuart_config.baudrate = UART_BAUDRATE_4800;\r\n\t\tbreak;\r\n\r\n\tcase 9600:\r\n\t\tuart_config.baudrate = UART_BAUDRATE_9600;\r\n\t\tbreak;\r\n\r\n\tcase 115200:\r\n\t\tuart_config.baudrate = UART_BAUDRATE_115200;\r\n\t\tbreak;\r\n\r\n\tcase 1500000:\r\n\t\tuart_config.baudrate = UART_BAUDRATE_1500000;\r\n\t\tbreak;\r\n\r\n\tcase 4000000:\r\n\t\tuart_config.baudrate = UART_BAUDRATE_4000000;\r\n\t\tbreak;\r\n\tdefault:\r\n\t\thal_log_info("Using default baudrate: 115200");\r\n\t\tuart_config.baudrate = UART_BAUDRATE_115200;\r\n\t\tbreak;\r\n\t}\r\n\r\n\tuart_config.word_length = UART_WORD_LENGTH_8;\r\n\tuart_config.stop_bit = UART_STOP_BIT_1;\r\n\tuart_config.parity = UART_PARITY_NONE;\r\n\r\n\thal_uart_init(port);\r\n\thal_uart_control(port, 0, &uart_config);\r\n\thal_uart_disable_flowcontrol(port);\r\n\thal_uart_set_loopback(port, 1);\r\n\r\n\t/* send */\r\n\thal_uart_send(port, tbuf, 5);\r\n\r\n\t/* loopback receive */\r\n\thal_uart_receive_no_block(port, rbuf, 5, MS_TO_OSTICK(1000));\r\n\r\n\tprintf("Sending:");\r\n\tfor (i = 0; i < 5; i++)\r\n\t\tprintf("%c", tbuf[i]);\r\n\tprintf("\\n");\r\n\r\n\tprintf("Receiving:");\r\n\tfor (i = 0; i < 5; i++)\r\n\t\tprintf("%c", rbuf[i]);\r\n\tprintf("\\n");\r\n\r\n\t/* verify data */\r\n\tfor (i = 0; i < 5; i++) {\r\n\t\tif (tbuf[i] != rbuf[i])\r\n\t\t\tbreak;\r\n\t}\r\n\tif (i == 5) {\r\n\t\thal_log_info("Test hal_uart_init API success!");\r\n\t\thal_log_info("Test hal_uart_control API success!");\r\n\t\thal_log_info("Test hal_uart_disable_flowcontrol API success!");\r\n\t\thal_log_info("Test hal_uart_set_loopback API success!");\r\n\t\thal_log_info("Test hal_uart_send API success!");\r\n\t\thal_log_info("Test hal_uart_receive API success!");\r\n\t\thal_log_info("Test hal_uart_deinit API success!");\r\n\t\thal_log_info("Test uart hal APIs success!");\r\n\t} else {\r\n\t\thal_log_info("Test uart hal APIs failed!");\r\n\t}\r\n\r\n\thal_msleep(1000);\r\n\thal_uart_deinit(port);\r\n\r\n\treturn 0;\r\n}\r\n\r\nFINSH_FUNCTION_EXPORT_CMD(cmd_test_uart, hal_uart, uart hal APIs tests)\r\n\r\n#define BUFFSIZE 4096\r\n\r\nstatic void cmd_stress_usage(void)\r\n{\r\n\tprintf("Usage:\\n"\r\n\t\t"\\t hal_uart <port> <baudrate> <flowctrl> <loopback> <len>\\n");\r\n}\r\n\r\nint cmd_test_uart_stress(int argc, char **argv)\r\n{\r\n\tuint8_t *tbuf = malloc(BUFFSIZE);\r\n\tuint8_t *rbuf = malloc(BUFFSIZE);\r\n\tuart_port_t port;\r\n\tuint32_t baudrate;\r\n\t_uart_config_t uart_config;\r\n\tint i;\r\n\tint flowctrl, loopback, testlen;\r\n\r\n\thal_log_info("Testing UART in loopback mode with stress");\r\n\r\n\tif (argc != 6) {\r\n\t\tcmd_stress_usage();\r\n\t\tfree(tbuf);\r\n\t\tfree(rbuf);\r\n\t\treturn -1;\r\n\t}\r\n\r\n\tport = strtol(argv[1], NULL, 0);\r\n\tbaudrate = strtol(argv[2], NULL, 0);\r\n\tflowctrl = strtol(argv[3], NULL, 0);\r\n\tloopback = strtol(argv[4], NULL, 0);\r\n\ttestlen = strtol(argv[5], NULL, 0);\r\n\r\n\tfor (i = 0; i < BUFFSIZE; i++) {\r\n\t\ttbuf[i] = (\'a\' + i) & 0xff;\r\n\t}\r\n\tmemset(rbuf, 0, BUFFSIZE * sizeof(uint8_t));\r\n\r\n\tswitch (baudrate) {\r\n\tcase 4800:\r\n\t\tuart_config.baudrate = UART_BAUDRATE_4800;\r\n\t\tbreak;\r\n\r\n\tcase 9600:\r\n\t\tuart_config.baudrate = UART_BAUDRATE_9600;\r\n\t\tbreak;\r\n\r\n\tcase 115200:\r\n\t\tuart_config.baudrate = UART_BAUDRATE_115200;\r\n\t\tbreak;\r\n\r\n\tcase 1500000:\r\n\t\tuart_config.baudrate = UART_BAUDRATE_1500000;\r\n\t\tbreak;\r\n\r\n\tdefault:\r\n\t\thal_log_info("Using default baudrate: 115200");\r\n\t\tuart_config.baudrate = UART_BAUDRATE_115200;\r\n\t\tbreak;\r\n\t}\r\n\r\n\tuart_config.word_length = UART_WORD_LENGTH_8;\r\n\tuart_config.stop_bit = UART_STOP_BIT_1;\r\n\tuart_config.parity = UART_PARITY_NONE;\r\n\r\n\thal_uart_init(port);\r\n\thal_uart_control(port, 0, &uart_config);\r\n\tprintf("flow:%d, loopback:%d len:%d\\n", flowctrl, loopback, testlen);\r\n\tif (flowctrl)\r\n\t\thal_uart_set_hardware_flowcontrol(port);\r\n\telse\r\n\t\thal_uart_disable_flowcontrol(port);\r\n\r\n\tif (loopback)\r\n\t\thal_uart_set_loopback(port, 1);\r\n\telse\r\n\t\thal_uart_set_loopback(port, 0);\r\n\r\n\t/* send */\r\n\tprintf("send\\n");\r\n\thal_uart_send(port, tbuf, testlen);\r\n\tprintf("send done\\n");\r\n\r\n\tprintf("recv\\n");\r\n\t/* loopback receive */\r\n\thal_uart_receive(port, rbuf, testlen);\r\n\tprintf("recv done\\n");\r\n\r\n#if 0\r\n\tprintf("Sending:");\r\n\tfor (i = 0; i < testlen; i++) {\r\n\t\tif (i % 16 == 0)\r\n\t\t\tprintf("\\n");\r\n\t\tprintf("0x%x ", tbuf[i]);\r\n\t}\r\n\tprintf("\\n");\r\n\r\n\tprintf("Receiving:");\r\n\tfor (i = 0; i < testlen; i++) {\r\n\t\tif (i % 16 == 0)\r\n\t\t\tprintf("\\n");\r\n\t\tprintf("0x%x ", rbuf[i]);\r\n\t}\r\n\tprintf("\\n");\r\n#endif\r\n\r\n\t/* verify data */\r\n\tfor (i = 0; i < testlen; i++) {\r\n\t\tif (tbuf[i] != rbuf[i]) {\r\n\t\t\tprintf("check %d fail, 0x%x != 0x%x\\n", i, tbuf[i], rbuf[i]);\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\tif (i == testlen) {\r\n\t\thal_log_info("Test hal_uart_init API success!");\r\n\t\thal_log_info("Test hal_uart_control API success!");\r\n\t\thal_log_info("Test hal_uart_disable_flowcontrol API success!");\r\n\t\thal_log_info("Test hal_uart_set_loopback API success!");\r\n\t\thal_log_info("Test hal_uart_send API success!");\r\n\t\thal_log_info("Test hal_uart_receive API success!");\r\n\t\thal_log_info("Test hal_uart_deinit API success!");\r\n\t\thal_log_info("Test uart hal APIs success!");\r\n\t} else {\r\n\t\thal_log_info("Test uart hal APIs failed!");\r\n\t}\r\n\r\n\thal_msleep(1000);\r\n\thal_uart_deinit(port);\r\n\tfree(tbuf);\r\n\tfree(rbuf);\r\n\r\n\treturn 0;\r\n}\r\n\r\nFINSH_FUNCTION_EXPORT_CMD(cmd_test_uart_stress, hal_uart_stress, uart hal APIs tests)\n'})})]})}function u(n={}){const{wrapper:r}={...(0,l.a)(),...n.components};return r?(0,e.jsx)(r,{...n,children:(0,e.jsx)(_,{...n})}):_(n)}},11151:(n,r,t)=>{t.d(r,{Z:()=>s,a:()=>a});var e=t(67294);const l={},i=e.createContext(l);function a(n){const r=e.useContext(i);return e.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function s(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(l):n.components||l:a(n.components),e.createElement(i.Provider,{value:r},n.children)}}}]);