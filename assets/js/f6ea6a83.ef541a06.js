"use strict";(self.webpackChunkavaota_docs=self.webpackChunkavaota_docs||[]).push([[4092],{39665:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>s,contentTitle:()=>c,default:()=>h,frontMatter:()=>t,metadata:()=>a,toc:()=>d});var l=e(85893),i=e(11151);const t={},c="PWM - \u8109\u51b2\u5bbd\u5ea6\u8c03\u5236",a={id:"linux-manual/amp-docs/hal/pwm",title:"PWM - \u8109\u51b2\u5bbd\u5ea6\u8c03\u5236",description:"\u6a21\u5757\u4ecb\u7ecd",source:"@site/docs/linux-manual/amp-docs/hal/pwm.md",sourceDirName:"linux-manual/amp-docs/hal",slug:"/linux-manual/amp-docs/hal/pwm",permalink:"/linux-manual/amp-docs/hal/pwm",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"linuxManualSidebar",previous:{title:"MSGBOX - \u5f02\u6784\u901a\u8baf",permalink:"/linux-manual/amp-docs/hal/msgbox"},next:{title:"RTC - \u5b9e\u65f6\u65f6\u949f",permalink:"/linux-manual/amp-docs/hal/rtc"}},s={},d=[{value:"\u6a21\u5757\u4ecb\u7ecd",id:"\u6a21\u5757\u4ecb\u7ecd",level:2},{value:"\u6a21\u5757\u914d\u7f6e",id:"\u6a21\u5757\u914d\u7f6e",level:2},{value:"\u6e90\u7801\u7ed3\u6784",id:"\u6e90\u7801\u7ed3\u6784",level:2},{value:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",level:2},{value:"\u8fd4\u56de\u503c\u679a\u4e3e",id:"\u8fd4\u56de\u503c\u679a\u4e3e",level:3},{value:"PWM \u521d\u59cb\u5316\u63a5\u53e3",id:"pwm-\u521d\u59cb\u5316\u63a5\u53e3",level:3},{value:"PWM \u901a\u9053\u914d\u7f6e\u63a5\u53e3",id:"pwm-\u901a\u9053\u914d\u7f6e\u63a5\u53e3",level:3},{value:"PWM \u901a\u9053\u4f7f\u80fd\u63a5\u53e3",id:"pwm-\u901a\u9053\u4f7f\u80fd\u63a5\u53e3",level:3},{value:"PWM \u53bb\u521d\u59cb\u5316\u63a5\u53e3",id:"pwm-\u53bb\u521d\u59cb\u5316\u63a5\u53e3",level:3},{value:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",level:2}];function p(n){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...n.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(r.h1,{id:"pwm---\u8109\u51b2\u5bbd\u5ea6\u8c03\u5236",children:"PWM - \u8109\u51b2\u5bbd\u5ea6\u8c03\u5236"}),"\n",(0,l.jsx)(r.h2,{id:"\u6a21\u5757\u4ecb\u7ecd",children:"\u6a21\u5757\u4ecb\u7ecd"}),"\n",(0,l.jsx)(r.p,{children:"\u8109\u51b2\u5bbd\u5ea6\u8c03\u5236\uff08PWM\uff09\u662f\u4e00\u79cd\u5bf9\u6a21\u62df\u4fe1\u53f7\u7535\u5e73\u8fdb\u884c\u6570\u5b57\u7f16\u7801\u7684\u65b9\u6cd5\u3002\u901a\u8fc7\u9ad8\u5206\u8fa8\u7387\u8ba1\u6570\u5668\u7684\u4f7f\u7528\uff0c\u65b9\u6ce2\u7684\u5360\u7a7a\u6bd4\u88ab\u8c03\u5236\u7528\u6765\u5bf9\u4e00\u4e2a\u5177\u4f53\u6a21\u62df\u4fe1\u53f7\u7684\u7535\u5e73\u8fdb\u884c\u7f16\u7801\u3002PWM \u5177\u6709\u4ee5\u4e0b\u7279\u70b9\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u652f\u6301\u8109\u51b2\uff08\u8109\u51b2\u4e2a\u6570\u53ef\u914d\uff09\u3001\u5468\u671f\u548c\u4e92\u8865\u5bf9\u8f93\u51fa\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"\u652f\u6301\u6355\u6349\u8f93\u5165\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"\u5e26\u53ef\u7f16\u7a0b\u6b7b\u533a\u53d1\u751f\u5668\uff0c\u6b7b\u533a\u65f6\u95f4\u53ef\u63a7\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"0-24M/100M \u8f93\u51fa\u9891\u7387\u8303\u56f4\u30010%-100% \u5360\u7a7a\u6bd4\u53ef\u8c03\u3001\u6700\u5c0f\u5206\u8fa8\u7387 1/65536\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"\u652f\u6301 PWM \u8f93\u51fa\u548c\u6355\u6349\u8f93\u5165\u4ea7\u751f\u4e2d\u65ad\uff1b"}),"\n",(0,l.jsx)(r.li,{children:"\u652f\u6301 PWM \u7ec4\u6a21\u5f0f\uff0c\u540c\u7ec4\u5185\u5404\u4e2a\u901a\u9053\u8d77\u59cb\u76f8\u4f4d\u53ef\u914d\u7f6e\u3002"}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"\u6a21\u5757\u914d\u7f6e",children:"\u6a21\u5757\u914d\u7f6e"}),"\n",(0,l.jsx)(r.p,{children:"\u914d\u7f6e\u8def\u5f84\u5982\u4e0b:"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{children:"Kernel Setup ---\x3e\r\n    Drivers Setup ---\x3e\r\n        SoC HAL Drivers ---\x3e\r\n            pwm devices ---\x3e\r\n                [*] enable pwm driver\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u6e90\u7801\u7ed3\u6784",children:"\u6e90\u7801\u7ed3\u6784"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-c",children:"rtos-hal/\r\n|--hal/source/pwm/hal_pwm.c    // hal\u5c42\u63a5\u53e3\u4ee3\u7801\r\n|--include/hal/sunxi_hal_pwm.h // \u5934\u6587\u4ef6\n"})}),"\n",(0,l.jsx)(r.h2,{id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",children:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e"}),"\n",(0,l.jsx)(r.p,{children:"\u5934\u6587\u4ef6"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-c",children:"#include <sunxi_hal_pwm.h>\n"})}),"\n",(0,l.jsx)(r.h3,{id:"\u8fd4\u56de\u503c\u679a\u4e3e",children:"\u8fd4\u56de\u503c\u679a\u4e3e"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-c",children:"typedef enum {\r\n\tHAL_PWM_STATUS_ERROR_PARAMETER = -3,\r\n\tHAL_PWM_STATUS_ERROR_CHANNEL = -2,\r\n\tHAL_PWM_STATUS_ERROR = -1,\r\n\tHAL_PWM_STATUS_OK = 0\r\n} hal_pwm_status_t;\n"})}),"\n",(0,l.jsx)(r.h3,{id:"pwm-\u521d\u59cb\u5316\u63a5\u53e3",children:"PWM \u521d\u59cb\u5316\u63a5\u53e3"}),"\n",(0,l.jsx)(r.p,{children:"PWM \u6a21\u5757\u521d\u59cb\u5316\uff0c\u4e3b\u8981\u5b8c\u6210 clk \u521d\u59cb\u5316"}),"\n",(0,l.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-c",children:"pwm_status_t hal_pwm_init(void)\n"})}),"\n",(0,l.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,l.jsx)(r.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,l.jsx)(r.h3,{id:"pwm-\u901a\u9053\u914d\u7f6e\u63a5\u53e3",children:"PWM \u901a\u9053\u914d\u7f6e\u63a5\u53e3"}),"\n",(0,l.jsx)(r.p,{children:"\u914d\u7f6e PWM \u6a21\u5757\u67d0\u4e2a\u901a\u9053\uff0c\u5305\u62ec\u5468\u671f\u3001\u5360\u7a7a\u6bd4\u548c\u6781\u6027"}),"\n",(0,l.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-c",children:"pwm_status_t hal_pwm_control(int channel, struct pwm_config *config_pwm)\n"})}),"\n",(0,l.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"channel \u4ee3\u8868\u901a\u9053\u53f7"}),"\n",(0,l.jsx)(r.li,{children:"config_pwm \u4ee3\u8868\u8be5\u901a\u9053\u7684\u914d\u7f6e\u53c2\u6570"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,l.jsx)(r.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,l.jsx)(r.h3,{id:"pwm-\u901a\u9053\u4f7f\u80fd\u63a5\u53e3",children:"PWM \u901a\u9053\u4f7f\u80fd\u63a5\u53e3"}),"\n",(0,l.jsx)(r.p,{children:"\u4f7f\u80fd PWM \u6a21\u5757\u67d0\u4e2a\u901a\u9053"}),"\n",(0,l.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-c",children:"void hal_pwm_enable_controller(uint32_t channel_in)\n"})}),"\n",(0,l.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"channel_in \u4ee3\u8868\u901a\u9053\u53f7"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u65e0"}),"\n"]}),"\n",(0,l.jsx)(r.h3,{id:"pwm-\u53bb\u521d\u59cb\u5316\u63a5\u53e3",children:"PWM \u53bb\u521d\u59cb\u5316\u63a5\u53e3"}),"\n",(0,l.jsx)(r.p,{children:"PWM \u6a21\u5757\u53bb\u521d\u59cb\u5316\uff0c\u4e3b\u8981\u5173\u95ed clk"}),"\n",(0,l.jsx)(r.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-c",children:"pwm_status_t hal_pwm_deinit(void)\n"})}),"\n",(0,l.jsx)(r.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"\u65e0"}),"\n"]}),"\n",(0,l.jsx)(r.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,l.jsxs)(r.ul,{children:["\n",(0,l.jsx)(r.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,l.jsx)(r.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,l.jsx)(r.h2,{id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",children:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b"}),"\n",(0,l.jsx)(r.pre,{children:(0,l.jsx)(r.code,{className:"language-c",children:'#include <stdio.h>\r\n#include <stdlib.h>\r\n#include <stdint.h>\r\n#include <string.h>\r\n#include <unistd.h>\r\n\r\n#include <hal_log.h>\r\n#include <hal_cmd.h>\r\n#include <sunxi_hal_pwm.h>\r\n\r\n#if defined(CONFIG_ARCH_DSP)\r\n#include <delay.h>\r\n#define sleep(sec) msleep(sec * 1000)\r\n#endif\r\n\r\n#ifndef printfFromISR\r\n#define printfFromISR printf\r\n#endif\r\n\r\nstatic int cmd_test_pwm(int argc, char **argv)\r\n{\r\n\r\n    struct pwm_config *config;\r\n    uint8_t port;\r\n    //uint8_t ns;\r\n    int period, duty;\r\n\r\n    if (argc < 4)\r\n    {\r\n        hal_log_info("Usage: pwm port | duty | period\\n");\r\n        return -1;\r\n    }\r\n\r\n    hal_log_info("Run pwm hal layer test case\\n");\r\n\r\n    port = strtol(argv[1], NULL, 0);\r\n    hal_log_info("port = %d", port);\r\n    duty = strtoul(argv[2], NULL, 0);\r\n    period = strtoul(argv[3], NULL, 0);\r\n\r\n    config = (struct pwm_config *)malloc(sizeof(struct pwm_config));\r\n\r\n    config->duty_ns   = duty;\r\n    config->period_ns = period;\r\n    config->polarity  = PWM_POLARITY_NORMAL;\r\n    hal_log_info("duty_ns = %d \\n", config->duty_ns);\r\n    hal_log_info("period_ns = %d \\n", config->period_ns);\r\n    hal_log_info("polarity = %d \\n", config->polarity);\r\n\r\n    hal_pwm_init();\r\n\r\n    hal_pwm_control(port, config);\r\n\r\n    hal_log_info("control pwm test finish\\n");\r\n\r\n    return 0;\r\n}\r\n\r\nFINSH_FUNCTION_EXPORT_CMD(cmd_test_pwm, hal_pwm, pwm hal APIs tests)\r\n\r\nstatic int cmd_release_pwm_channel(int argc, char **argv)\r\n{\r\n\r\n    struct pwm_config *config;\r\n    uint8_t port;\r\n    uint8_t ns;\r\n    ulong period, duty;\r\n\r\n    if (argc < 2)\r\n    {\r\n        hal_log_info("Usage: pwm port\\n");\r\n        return -1;\r\n    }\r\n\r\n    hal_log_info("Run close pwm channel test case\\n");\r\n\r\n    port = strtol(argv[1], NULL, 0);\r\n    hal_log_info("port = %d", port);\r\n\r\n    hal_pwm_release(port);\r\n\r\n    hal_log_info("release pwm channel finish\\n");\r\n\r\n    return 0;\r\n}\r\n\r\nFINSH_FUNCTION_EXPORT_CMD(cmd_release_pwm_channel, hal_pwm_close, release pwm channel hal APIs tests)\r\n\r\nstatic void pwm_cap_callback(void* param)\r\n{\r\n\thal_pwm_cap_info *info = (hal_pwm_cap_info *)param;\r\n\r\n\tprintfFromISR("pwm%d capture callback, cnt is %d, period is %d, duty is %d\\n", info->channel, info->cnt, info->period, info->duty);\r\n}\r\n\r\nhal_pwm_status_t pwm_capture_init(uint32_t channel)\r\n{\r\n\r\n\thal_pwm_cap_enable(channel, pwm_cap_callback);\r\n\r\n\treturn HAL_PWM_STATUS_OK;\r\n}\r\n\r\nhal_pwm_status_t pwm_capture_deinit(uint32_t channel)\r\n{\r\n\thal_pwm_cap_disable(channel);\r\n\r\n\treturn HAL_PWM_STATUS_OK;\r\n}\r\n\r\nvoid cmd_pwm_capture_help(void)\r\n{\r\n\tprintf("pwm capture test, stop capture after 10s\\n");\r\n\tprintf("usage: pwm_capture_test<channel>\\n");\r\n\tprintf("\\t<channel>: 0 ~ 15\\n");\r\n\tprintf("eg: pwm_capture_test 0, pwm0 capture function\\n");\r\n}\r\n\r\nint cmd_pwm_capture(int argc, char *argv[])\r\n{\r\n\tint count = 0;\r\n\r\n\tif (argc != 2 || atoi(argv[1]) > 15) {\r\n\t\tcmd_pwm_capture_help();\r\n\t\treturn -1;\r\n\t}\r\n\r\n\t/* capture setting */\r\n\tpwm_capture_init(atoi(argv[1]));\r\n\r\n\tfor(count = 0; count < 10; count++) {\r\n\t\tsleep(1);\r\n\t}\r\n\r\n\t/* disable */\r\n\tpwm_capture_deinit(atoi(argv[1]));\r\n\r\n\tprintf("[%s]: pwm stop capture ssd\\n", __func__);\r\n\r\n\treturn 0;\r\n}\r\n\r\nFINSH_FUNCTION_EXPORT_CMD(cmd_pwm_capture, pwm_capture_test, pwm capture test)\n'})})]})}function h(n={}){const{wrapper:r}={...(0,i.a)(),...n.components};return r?(0,l.jsx)(r,{...n,children:(0,l.jsx)(p,{...n})}):p(n)}},11151:(n,r,e)=>{e.d(r,{Z:()=>a,a:()=>c});var l=e(67294);const i={},t=l.createContext(i);function c(n){const r=l.useContext(t);return l.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function a(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:c(n.components),l.createElement(t.Provider,{value:r},n.children)}}}]);