"use strict";(self.webpackChunkavaota_docs=self.webpackChunkavaota_docs||[]).push([[5324],{53742:(n,r,e)=>{e.r(r),e.d(r,{assets:()=>c,contentTitle:()=>t,default:()=>h,frontMatter:()=>l,metadata:()=>d,toc:()=>a});var i=e(85893),s=e(11151);const l={},t="WS2812 RGB LED",d={id:"linux-manual/peripheral-driver/ledc",title:"WS2812 RGB LED",description:"\u5728 Avaota SBC \u7684\u5f00\u53d1\u677f\u4e2d\uff0c\u901a\u5e38\u4f1a\u6709\u51e0\u4e2a WS2812 RGB LED \u706f\u3002\u4f8b\u5982 Avaota A1 \u7684\u5982\u4e0b\u4f4d\u7f6e\uff1a",source:"@site/docs/linux-manual/peripheral-driver/ledc.md",sourceDirName:"linux-manual/peripheral-driver",slug:"/linux-manual/peripheral-driver/ledc",permalink:"/en-US/linux-manual/peripheral-driver/ledc",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"linuxManualSidebar",previous:{title:"EEPROM",permalink:"/en-US/linux-manual/peripheral-driver/eeprom"},next:{title:"SPI \u5c4f\u5e55\u9a71\u52a8 LVGL",permalink:"/en-US/linux-manual/peripheral-driver/lvgl"}},c={},a=[{value:"WS2812 \u9a71\u52a8\u4ecb\u7ecd",id:"ws2812-\u9a71\u52a8\u4ecb\u7ecd",level:2},{value:"WS2812 \u9a71\u52a8\u914d\u7f6e\u8bf4\u660e",id:"ws2812-\u9a71\u52a8\u914d\u7f6e\u8bf4\u660e",level:2},{value:"WS2812 \u4f7f\u7528\u8bf4\u660e",id:"ws2812-\u4f7f\u7528\u8bf4\u660e",level:3},{value:"\u5b9e\u73b0\u4e03\u5f69\u6d41\u6c34\u706f",id:"\u5b9e\u73b0\u4e03\u5f69\u6d41\u6c34\u706f",level:3},{value:"C \u8bed\u8a00\u5b9e\u73b0",id:"c-\u8bed\u8a00\u5b9e\u73b0",level:4},{value:"Python \u5b9e\u73b0",id:"python-\u5b9e\u73b0",level:4}];function o(n){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.h1,{id:"ws2812-rgb-led",children:"WS2812 RGB LED"}),"\n",(0,i.jsx)(r.p,{children:"\u5728 Avaota SBC \u7684\u5f00\u53d1\u677f\u4e2d\uff0c\u901a\u5e38\u4f1a\u6709\u51e0\u4e2a WS2812 RGB LED \u706f\u3002\u4f8b\u5982 Avaota A1 \u7684\u5982\u4e0b\u4f4d\u7f6e\uff1a"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.img,{alt:"image-20240531204921506",src:e(13311).Z+"",width:"584",height:"353"})}),"\n",(0,i.jsx)(r.p,{children:"\u5bf9\u4e8e AvaotaOS\uff0c\u63d0\u4f9b\u4e86\u786c\u4ef6\u7684 LEDC\uff08Light Emitting Diode Controller\uff09\uff0c\u53d1\u5149\u4e8c\u6781\u7ba1\u63a7\u5236\u5668\u4f5c\u4e3aWS2812 RGB LED \u706f\u7684\u63a7\u5236\u5668\u3002\u6bcf\u4e2a LED \u7684\u4e09\u57fa\u8272\u5747\u53ef\u5b9e\u73b0 256 \u7ea7\u4eae\u5ea6\u663e\u793a\uff0c\u56e0\u6b64\u6574\u4e2a LED \u53ef\u5b8c\u6210 256\u02c63\uff08\u5373 16777216\uff09\u79cd\u989c\u8272\u7684\u5168\u771f\u8272\u5f69\u663e\u793a\u3002\u6a21\u5757\u652f\u6301\u6700\u59271024\u9897\u5916\u63a7 LED\u7ea7\u8054\u3002"}),"\n",(0,i.jsx)(r.h2,{id:"ws2812-\u9a71\u52a8\u4ecb\u7ecd",children:"WS2812 \u9a71\u52a8\u4ecb\u7ecd"}),"\n",(0,i.jsx)(r.p,{children:"LED \u5178\u578b\u7535\u8def\u5982\u56fe\u6240\u793a\uff0c\u5176\u4e2d DI \u8868\u793a\u63a7\u5236\u6570\u636e\u8f93\u5165\u811a\uff0cDO \u8868\u793a\u63a7\u5236\u6570\u636e\u8f93\u51fa\u811a\u3002DI \u7aef\u63a5\u6536\u4ece\u63a7\u5236\u5668\u4f20\u8fc7\u6765\u7684\u6570\u636e\uff0c\u6bcf\u4e2a LED \u5185\u90e8\u7684\u6570\u636e\u9501\u5b58\u5668\u4f1a\u5b58\u50a8 24bit \u6570\u636e\uff0c\u5269\u4f59\u7684\u6570\u636e\u7ecf\u8fc7\u5185\u90e8\u6574\u5f62\u5904\u7406\u7535\u8def\u6574\u5f62\u653e\u5927\u540e\u901a\u8fc7 DO \u7aef\u53e3\u5f00\u59cb\u8f6c\u53d1\u8f93\u51fa\u7ed9\u4e0b\u4e00\u4e2a\u7ea7\u8054\u7684 LED\u3002\u56e0\u6b64\uff0c\u6bcf\u7ecf\u8fc7\u4e00\u4e2aLED\uff0c\u6570\u636e\u51cf\u5c11 24bit\u3002"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.img,{alt:"image-20230324173621026",src:e(69954).Z+"",width:"1389",height:"307"})}),"\n",(0,i.jsx)(r.p,{children:"LED\u5178\u578b\u7535\u8def\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5176\u4e2d DI \u8868\u793a\u63a7\u5236\u6570\u636e\u8f93\u5165\u811a\uff0cDO \u8868\u793a\u63a7\u5236\u6570\u636e\u8f93\u51fa\u811a\u3002DI \u7aef\u63a5\u53d7\u4ece\u63a7\u5236\u5668\u4f20\u8f93\u8fc7\u6765\u7684\u6570\u636e\uff0c\u6bcf\u4e2a LED \u5185\u90e8\u7684\u6570\u636e\u9501\u5b58\u5668\u4f1a\u5b58\u50a8 24bit (\u5206\u522b\u5bf9\u5e94 R,G,B \u4e09\u79cd\u989c\u8272)\u6570\u636e\uff0c\u5269\u4f59\u7684\u6570\u636e\u7ecf\u8fc7\u5185\u90e8\u6574\u5f62\u5904\u7406\u7535\u8def\u6574\u5f62\u653e\u5927\u540e\u901a\u8fc7 DO \u7aef\u53e3\u5f00\u59cb\u8f6c\u53d1\u8f93\u51fa\u7ed9\u4e0b\u4e00\u4e2a\u7ea7\u8054\u7684 LED \u3002\u56e0\u6b64\uff0c\u6bcf\u7ecf\u8fc7\u4e00\u4e2a LED \uff0c\u6570\u636e\u51cf\u5c11 24bit\u3002"}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.img,{alt:"image-20240329003829327",src:e(76560).Z+"",width:"514",height:"139"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.img,{alt:"image-20230324173635697",src:e(65493).Z+"",width:"1320",height:"373"})}),"\n",(0,i.jsx)(r.h2,{id:"ws2812-\u9a71\u52a8\u914d\u7f6e\u8bf4\u660e",children:"WS2812 \u9a71\u52a8\u914d\u7f6e\u8bf4\u660e"}),"\n",(0,i.jsx)(r.p,{children:"\u914d\u7f6e\u9a71\u52a8\uff0c\u9ed8\u8ba4 Avaota OS \u5df2\u7ecf\u52fe\u9009\u8be5\u9a71\u52a8\u3002\u5982\u679c\u672a\u52fe\u9009\u8bf7\u914d\u7f6e"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"LED Drivers ->\r\n\t<*> LEDC Support for Allwinner SoCs\n"})}),"\n",(0,i.jsx)(r.p,{children:(0,i.jsx)(r.img,{alt:"image-20240329004108251",src:e(33845).Z+"",width:"1083",height:"280"})}),"\n",(0,i.jsx)(r.p,{children:"\u914d\u7f6e\u8bbe\u5907\u6811\uff0c\u9996\u5148\u9700\u8981\u914d\u7f6e PIO \u8282\u70b9\uff0c\u914d\u7f6e LEDC \u4f7f\u7528\u7684 GPIO"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:'&pio {\r\n\tledc_pins_a: ledc@0 {\r\n\t\tpins = "PH19";\r\n\t\tfunction = "ledc";\r\n\t\tdrive-strength = <10>;\r\n\t};\r\n\r\n\tledc_pins_b: ledc@1 {\r\n\t\tpins = "PH19";\r\n\t\tfunction = "gpio_in";\r\n\t};\r\n};\n'})}),"\n",(0,i.jsx)(r.p,{children:"\u7136\u540e\u914d\u7f6e LEDC \u6a21\u5757\u7684\u6570\u503c"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:'&ledc  {\r\n\tpinctrl-names = "default", "sleep";\r\n\tpinctrl-0 = <&ledc_pins_a>;\r\n\tpinctrl-1 = <&ledc_pins_b>;\r\n\tled_count = <4>;\r\n\toutput_mode = "GRB";\r\n\treset_ns = <84>;\r\n\tt1h_ns = <800>;\r\n\tt1l_ns = <320>;\r\n\tt0h_ns = <300>;\r\n\tt0l_ns = <800>;\r\n\twait_time0_ns = <84>;\r\n\twait_time1_ns = <84>;\r\n\twait_data_time_ns = <600000>;\r\n\tstatus = "okay";\r\n};\n'})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"pinctrl-names"}),": \u7528\u4e8e\u8868\u793a 0 \u548c 1 \u7684 pinctrl \u54ea\u4e2a\u662f\u9ed8\u8ba4\u548c\u4f11\u7720\u72b6\u6001\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"pinctrl-0"}),": \u5f15\u811a\u914d\u7f6e\uff0c\u8fd9\u91cc\u662f\u9ed8\u8ba4\u4f7f\u7528\u7684\u65f6\u5019\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"pinctrl-1"}),": \u540c\u4e0a\uff0c\u8fd9\u91cc\u662f\u4f11\u7720\u65f6\u7684\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"led_count"}),": LED \u706f\u7684\u6570\u76ee\uff0c\u6839\u636e\u786c\u4ef6\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"output_mode"}),": LED \u706f\u8f93\u51fa\u6a21\u5f0f\uff0c\u6839\u636e LED \u706f\u7684 datasheet \u8fdb\u884c\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"reset_ns"}),": LED \u706f reset \u65f6\u95f4\u63a7\u5236\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"t1h_ns"}),": 1 \u7801\u9ad8\u7535\u5e73\u65f6\u95f4\uff0c\u6839\u636e LED \u706f\u7684 datasheet \u8fdb\u884c\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"t1l_ns"}),": 1 \u7801\u4f4e\u7535\u5e73\u65f6\u95f4\uff0c\u6839\u636e LED \u706f\u7684 datasheet \u8fdb\u884c\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"t0h_ns"}),": 0 \u7801\u9ad8\u7535\u5e73\u65f6\u95f4\uff0c\u6839\u636e LED \u706f\u7684 datasheet \u8fdb\u884c\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"t0l_ns"}),": 0 \u7801\u4f4e\u7535\u5e73\u65f6\u95f4\uff0c\u6839\u636e LED \u706f\u7684 datasheet \u8fdb\u884c\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"wait_time0_ns"}),": \u4e24\u4e2a LED \u6570\u636e\u4e4b\u95f4\u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u6839\u636e LED \u706f\u7684 datasheet \u8fdb\u884c\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"wait_time1_ns"}),": \u5e27\u6570\u636e\u4e4b\u95f4\u7684\u7b49\u5f85\u65f6\u95f4\uff0c\u6839\u636e LED \u706f\u7684 datasheet \u8fdb\u884c\u914d\u7f6e\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"wait_data_time_ns"}),": \u5185\u90e8 FIFO \u7b49\u5f85\u6570\u636e\u65f6\u95f4\uff0c\u8d85\u8fc7\u65f6\u95f4\u89e6\u53d1\u5f02\u5e38\u4e2d\u65ad\u3002"]}),"\n",(0,i.jsxs)(r.li,{children:[(0,i.jsx)(r.code,{children:"status"}),": \u8bbe\u5907\u72b6\u6001\u3002"]}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"ws2812-\u4f7f\u7528\u8bf4\u660e",children:"WS2812 \u4f7f\u7528\u8bf4\u660e"}),"\n",(0,i.jsxs)(r.p,{children:["\u9a71\u52a8\u4f1a\u5728 ",(0,i.jsx)(r.code,{children:"/sys/class/leds"})," \u6ce8\u518c\u6bcf\u4e2aLED\u5bf9\u5e94\u7684\u8bbe\u5907\u76ee\u5f55"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-text",children:"/sys/class/leds/sunxi_led0r // \u7ea2\u8272\r\n/sys/class/leds/sunxi_led0g // \u7eff\u8272\r\n/sys/class/leds/sunxi_led0b // \u84dd\u8272\n"})}),"\n",(0,i.jsxs)(r.p,{children:["\u5176\u4e2d ",(0,i.jsx)(r.code,{children:"0"})," \u8868\u793aLED\u7684\u7f16\u53f7\uff0c\u5982\u679c\u662f 1 \u53f7 LED \u5219\u662f"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-text",children:"/sys/class/leds/sunxi_led1r\r\n/sys/class/leds/sunxi_led1g\r\n/sys/class/leds/sunxi_led1b\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u9700\u8981\u8c03\u8282\u7b2c 0 \u4e2aLED\u7684\u989c\u8272\u4e3a\u767d\u5149\u4e14\u6700\u4eae\uff0c\u64cd\u4f5c\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-text",children:"echo 255 > /sys/class/leds/sunxi_led0r/brightness\r\necho 255 > /sys/class/leds/sunxi_led0g/brightness\r\necho 255 > /sys/class/leds/sunxi_led0b/brightness\n"})}),"\n",(0,i.jsx)(r.h3,{id:"\u5b9e\u73b0\u4e03\u5f69\u6d41\u6c34\u706f",children:"\u5b9e\u73b0\u4e03\u5f69\u6d41\u6c34\u706f"}),"\n",(0,i.jsx)(r.h4,{id:"c-\u8bed\u8a00\u5b9e\u73b0",children:"C \u8bed\u8a00\u5b9e\u73b0"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-c",children:'#include <fcntl.h>\r\n#include <stdint.h>\r\n#include <stdio.h>\r\n#include <stdlib.h>\r\n#include <string.h>\r\n#include <sys/times.h>\r\n#include <sys/types.h>\r\n#include <unistd.h>\r\n\r\n// \u4f7f\u7528RGB \u5206\u91cf\u5408\u6210\u989c\u8272\u503c\r\n#define MERAGECOLOR(G, R, B) (((uint32_t)G << 16) | ((uint16_t)R << 8) | B)\r\n#define PIXEL_NUM 4\r\n\r\nint fd[PIXEL_NUM][3];// \u5b58\u653e\u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u7ec4\r\n\r\nvoid init_leds() {\r\n    char path[100];\r\n\r\n    // \u521d\u59cb\u5316LED\u6587\u4ef6\u63cf\u8ff0\u7b26\r\n    for (int i = 0; i < PIXEL_NUM; ++i) {\r\n        snprintf(path, sizeof(path), "/sys/class/leds/sunxi_led%d%c/brightness", i, \'r\');\r\n        fd[i][0] = open(path, O_WRONLY);\r\n        if (fd[i][0] == -1) {\r\n            printf("Failed to open file for LED %d, color %c\\n", i, \'r\');\r\n        }\r\n        snprintf(path, sizeof(path), "/sys/class/leds/sunxi_led%d%c/brightness", i, \'g\');\r\n        fd[i][1] = open(path, O_WRONLY);\r\n        if (fd[i][1] == -1) {\r\n            printf("Failed to open file for LED %d, color %c\\n", i, \'g\');\r\n        }\r\n        snprintf(path, sizeof(path), "/sys/class/leds/sunxi_led%d%c/brightness", i, \'b\');\r\n        fd[i][2] = open(path, O_WRONLY);\r\n        if (fd[i][2] == -1) {\r\n            printf("Failed to open file for LED %d, color %c\\n", i, \'b\');\r\n        }\r\n    }\r\n}\r\n\r\nvoid sunxi_set_led_brightness(int led_id, uint8_t r, uint8_t g, uint8_t b) {\r\n    if (led_id < 0 || led_id >= PIXEL_NUM) {\r\n        printf("Invalid LED ID\\n");\r\n        return;\r\n    }\r\n\r\n    dprintf(fd[led_id][0], "%d", r);\r\n    dprintf(fd[led_id][1], "%d", g);\r\n    dprintf(fd[led_id][2], "%d", b);\r\n}\r\n\r\nvoid close_leds() {\r\n    // \u5173\u95edLED\u6587\u4ef6\u63cf\u8ff0\u7b26\r\n    for (int i = 0; i < PIXEL_NUM; ++i) {\r\n        for (int j = 0; j < 3; ++j) {\r\n            if (fd[i][j] != -1) {\r\n                close(fd[i][j]);\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// \u751f\u6210\u989c\u8272\r\nuint32_t WS281x_Wheel(uint8_t wheelPos) {\r\n    wheelPos = 255 - wheelPos;\r\n    if (wheelPos < 85) {\r\n        return MERAGECOLOR(255 - wheelPos * 3, 0, wheelPos * 3);\r\n    }\r\n    if (wheelPos < 170) {\r\n        wheelPos -= 85;\r\n        return MERAGECOLOR(0, wheelPos * 3, 255 - wheelPos * 3);\r\n    }\r\n    wheelPos -= 170;\r\n    return MERAGECOLOR(wheelPos * 3, 255 - wheelPos * 3, 0);\r\n}\r\n\r\n// \u4eae\u5ea6\u8bbe\u7f6e\r\nvoid WS281xLSet(uint32_t id, uint32_t rgb, float k) {\r\n    uint8_t r, g, b;\r\n    float h, s, v;\r\n    uint8_t cmax, cmin, cdes;\r\n\r\n    r = (uint8_t) (rgb >> 16);\r\n    g = (uint8_t) (rgb >> 8);\r\n    b = (uint8_t) (rgb);\r\n\r\n    cmax = r > g ? r : g;\r\n    if (b > cmax)\r\n        cmax = b;\r\n    cmin = r < g ? r : g;\r\n    if (b < cmin)\r\n        cmin = b;\r\n    cdes = cmax - cmin;\r\n\r\n    v = cmax / 255.0f;\r\n    s = cmax == 0 ? 0 : cdes / (float) cmax;\r\n    h = 0;\r\n\r\n    if (cmax == r && g >= b)\r\n        h = ((g - b) * 60.0f / cdes) + 0;\r\n    else if (cmax == r && g < b)\r\n        h = ((g - b) * 60.0f / cdes) + 360;\r\n    else if (cmax == g)\r\n        h = ((b - r) * 60.0f / cdes) + 120;\r\n    else\r\n        h = ((r - g) * 60.0f / cdes) + 240;\r\n\r\n    v *= k;\r\n\r\n    float f, p, q, t;\r\n    float rf, gf, bf;\r\n    int i = ((int) (h / 60) % 6);\r\n    f = (h / 60) - i;\r\n    p = v * (1 - s);\r\n    q = v * (1 - f * s);\r\n    t = v * (1 - (1 - f) * s);\r\n    switch (i) {\r\n        case 0:\r\n            rf = v;\r\n            gf = t;\r\n            bf = p;\r\n            break;\r\n        case 1:\r\n            rf = q;\r\n            gf = v;\r\n            bf = p;\r\n            break;\r\n        case 2:\r\n            rf = p;\r\n            gf = v;\r\n            bf = t;\r\n            break;\r\n        case 3:\r\n            rf = p;\r\n            gf = q;\r\n            bf = v;\r\n            break;\r\n        case 4:\r\n            rf = t;\r\n            gf = p;\r\n            bf = v;\r\n            break;\r\n        case 5:\r\n            rf = v;\r\n            gf = p;\r\n            bf = q;\r\n            break;\r\n        default:\r\n            break;\r\n    }\r\n\r\n    r = (uint8_t) (rf * 255.0);\r\n    g = (uint8_t) (gf * 255.0);\r\n    b = (uint8_t) (bf * 255.0);\r\n\r\n    sunxi_set_led_brightness(id, r, g, b);\r\n}\r\n\r\n// \u6d4b\u8bd5 LEDC\r\nint main() {\r\n    int i = 0, j = 0, err;\r\n    int mode = 0;\r\n    uint8_t R = 0, G = 0, B = 0;\r\n\r\n    init_leds();\r\n\r\n    while (1) {\r\n        for (j = 0; j < 256; j++) {\r\n            for (i = 0; i < PIXEL_NUM; i++) {\r\n                WS281xLSet(i, WS281x_Wheel(((i * 256 / PIXEL_NUM) + j) & 255), 0.1);\r\n            }\r\n            usleep(1000);\r\n        }\r\n        usleep(10000);\r\n    }\r\n\r\n    close_leds();\r\n\r\n    return 1;\r\n}\n'})}),"\n",(0,i.jsx)(r.h4,{id:"python-\u5b9e\u73b0",children:"Python \u5b9e\u73b0"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{className:"language-python",children:'import os\r\nimport time\r\nimport math\r\n\r\nPIXEL_NUM = 4\r\nfd = [[None, None, None] for _ in range(PIXEL_NUM)]  # \u6587\u4ef6\u63cf\u8ff0\u7b26\u6570\u7ec4\r\n\r\ndef init_leds():\r\n    global fd\r\n    path = ""\r\n\r\n    # \u521d\u59cb\u5316LED\u6587\u4ef6\u63cf\u8ff0\u7b26\r\n    for i in range(PIXEL_NUM):\r\n        path = f"/sys/class/leds/sunxi_led{i}{\'r\'}/brightness"\r\n        fd[i][0] = os.open(path, os.O_WRONLY)\r\n        if fd[i][0] == -1:\r\n            print(f"Failed to open file for LED {i}, color {\'r\'}")\r\n        \r\n        path = f"/sys/class/leds/sunxi_led{i}{\'g\'}/brightness"\r\n        fd[i][1] = os.open(path, os.O_WRONLY)\r\n        if fd[i][1] == -1:\r\n            print(f"Failed to open file for LED {i}, color {\'g\'}")\r\n\r\n        path = f"/sys/class/leds/sunxi_led{i}{\'b\'}/brightness"\r\n        fd[i][2] = os.open(path, os.O_WRONLY)\r\n        if fd[i][2] == -1:\r\n            print(f"Failed to open file for LED {i}, color {\'b\'}")\r\n\r\ndef sunxi_set_led_brightness(led_id, r, g, b):\r\n    if led_id < 0 or led_id >= PIXEL_NUM:\r\n        print("Invalid LED ID")\r\n        return\r\n\r\n    os.write(fd[led_id][0], str(r).encode())\r\n    os.write(fd[led_id][1], str(g).encode())\r\n    os.write(fd[led_id][2], str(b).encode())\r\n\r\ndef close_leds():\r\n    # \u5173\u95edLED\u6587\u4ef6\u63cf\u8ff0\u7b26\r\n    global fd\r\n    for i in range(PIXEL_NUM):\r\n        for j in range(3):\r\n            if fd[i][j] is not None:\r\n                os.close(fd[i][j])\r\n\r\ndef ws281x_wheel(wheel_pos):\r\n    wheel_pos = 255 - wheel_pos\r\n    if wheel_pos < 85:\r\n        return merge_color(255 - wheel_pos * 3, 0, wheel_pos * 3)\r\n    if wheel_pos < 170:\r\n        wheel_pos -= 85\r\n        return merge_color(0, wheel_pos * 3, 255 - wheel_pos * 3)\r\n    wheel_pos -= 170\r\n    return merge_color(wheel_pos * 3, 255 - wheel_pos * 3, 0)\r\n\r\ndef merge_color(r, g, b):\r\n    return (r << 16) | (g << 8) | b\r\n\r\ndef ws281x_lset(id, rgb, k):\r\n    r = (rgb >> 16) & 0xFF\r\n    g = (rgb >> 8) & 0xFF\r\n    b = rgb & 0xFF\r\n\r\n    cmax = max(r, g, b)\r\n    cmin = min(r, g, b)\r\n    cdes = cmax - cmin\r\n\r\n    v = cmax / 255.0\r\n    s = cmax / 255.0 if cmax == 0 else cdes / cmax\r\n\r\n    if cmax == r and g >= b:\r\n        h = (g - b) * 60.0 / cdes + 0\r\n    elif cmax == r and g < b:\r\n        h = (g - b) * 60.0 / cdes + 360\r\n    elif cmax == g:\r\n        h = (b - r) * 60.0 / cdes + 120\r\n    else:\r\n        h = (r - g) * 60.0 / cdes + 240\r\n\r\n    v *= k\r\n\r\n    i = math.floor(h / 60) % 6\r\n    f = h / 60 - i\r\n    p = v * (1 - s)\r\n    q = v * (1 - f * s)\r\n    t = v * (1 - (1 - f) * s)\r\n\r\n    if i == 0:\r\n        rf, gf, bf = v, t, p\r\n    elif i == 1:\r\n        rf, gf, bf = q, v, p\r\n    elif i == 2:\r\n        rf, gf, bf = p, v, t\r\n    elif i == 3:\r\n        rf, gf, bf = p, q, v\r\n    elif i == 4:\r\n        rf, gf, bf = t, p, v\r\n    else:\r\n        rf, gf, bf = v, p, q\r\n\r\n    r = int(rf * 255.0)\r\n    g = int(gf * 255.0)\r\n    b = int(bf * 255.0)\r\n\r\n    sunxi_set_led_brightness(id, r, g, b)\r\n\r\ndef main():\r\n    init_leds()\r\n    try:\r\n        while True:\r\n            for j in range(256):\r\n                for i in range(PIXEL_NUM):\r\n                    ws281x_lset(i, ws281x_wheel(int((float(i) * 256.0 / float(PIXEL_NUM) + j)) & 255), 0.1)\r\n                time.sleep(0.01)  # \u63a7\u5236LED\u53d8\u5316\u901f\u5ea6\r\n            time.sleep(0.1)\r\n    finally:\r\n        close_leds()\r\n\r\nif __name__ == "__main__":\r\n    main()\n'})})]})}function h(n={}){const{wrapper:r}={...(0,s.a)(),...n.components};return r?(0,i.jsx)(r,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},69954:(n,r,e)=>{e.d(r,{Z:()=>i});const i=e.p+"assets/images/image-20230324173621026-ac0e3c03c865c1e554f379e90a768037-ac0e3c03c865c1e554f379e90a768037.png"},65493:(n,r,e)=>{e.d(r,{Z:()=>i});const i=e.p+"assets/images/image-20230324173635697-4ea6c216b677d8916d33c59dd86e12eb-4ea6c216b677d8916d33c59dd86e12eb.png"},76560:(n,r,e)=>{e.d(r,{Z:()=>i});const i=e.p+"assets/images/image-20240329003829327-de68a8ff0cbf28b5c9fd3237fa257dc5-de68a8ff0cbf28b5c9fd3237fa257dc5.png"},33845:(n,r,e)=>{e.d(r,{Z:()=>i});const i=e.p+"assets/images/image-20240329004108251-62035080125c5c2a937e142cd4aaaed3-62035080125c5c2a937e142cd4aaaed3.png"},13311:(n,r,e)=>{e.d(r,{Z:()=>i});const i=e.p+"assets/images/image-20240531204921506-2afc83e6c2f78315dbb02eb0d414cd9d.png"},11151:(n,r,e)=>{e.d(r,{Z:()=>d,a:()=>t});var i=e(67294);const s={},l=i.createContext(s);function t(n){const r=i.useContext(l);return i.useMemo((function(){return"function"==typeof n?n(r):{...r,...n}}),[r,n])}function d(n){let r;return r=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:t(n.components),i.createElement(l.Provider,{value:r},n.children)}}}]);