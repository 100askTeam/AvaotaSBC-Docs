"use strict";(self.webpackChunkavaota_docs=self.webpackChunkavaota_docs||[]).push([[6956],{80816:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>d,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>c,toc:()=>a});var r=t(85893),i=t(11151);const l={},s="MSGBOX - \u5f02\u6784\u901a\u8baf",c={id:"linux-manual/amp-docs/hal/msgbox",title:"MSGBOX - \u5f02\u6784\u901a\u8baf",description:"msgbox \u7528\u6765\u5b9e\u73b0\u591a CPU \u4e4b\u95f4\u901a\u8baf\uff0c\u5728\u4e00\u4e9b IC \u5185\u90e8\u53ef\u80fd\u540c\u65f6\u5b58\u5728\u591a\u79cd\u6838\u5fc3\u7528\u6765\u5b9e\u73b0\u591a\u79cd\u4e0d\u540c\u529f\u80fd\uff0c\u8fd9\u4e9b\u4e0d\u540c\u6838\u5fc3\u8fd0\u884c\u4e0d\u540c\u67b6\u6784\u3001\u4e0d\u540c\u7cfb\u7edf\uff0c\u9700\u8981\u901a\u8fc7 MSGBOX \u7528\u6765\u5b9e\u73b0\u8fd9\u4e9b\u4e0d\u540c\u7cfb\u7edf\u95f4\u901a\u8baf\u3002",source:"@site/docs/linux-manual/amp-docs/hal/msgbox.md",sourceDirName:"linux-manual/amp-docs/hal",slug:"/linux-manual/amp-docs/hal/msgbox",permalink:"/en-US/linux-manual/amp-docs/hal/msgbox",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"linuxManualSidebar",previous:{title:"LEDC - RGB LED",permalink:"/en-US/linux-manual/amp-docs/hal/ledc"},next:{title:"PWM - \u8109\u51b2\u5bbd\u5ea6\u8c03\u5236",permalink:"/en-US/linux-manual/amp-docs/hal/pwm"}},d={},a=[{value:"\u6a21\u5757\u4ecb\u7ecd",id:"\u6a21\u5757\u4ecb\u7ecd",level:2},{value:"\u6a21\u5757\u914d\u7f6e",id:"\u6a21\u5757\u914d\u7f6e",level:2},{value:"\u6e90\u7801\u7ed3\u6784",id:"\u6e90\u7801\u7ed3\u6784",level:2},{value:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",level:2},{value:"\u521d\u59cb\u5316\u63a5\u53e3",id:"\u521d\u59cb\u5316\u63a5\u53e3",level:3},{value:"\u901a\u9053\u7533\u8bf7\u63a5\u53e3",id:"\u901a\u9053\u7533\u8bf7\u63a5\u53e3",level:3},{value:"\u6570\u636e\u53d1\u9001\u63a5\u53e3",id:"\u6570\u636e\u53d1\u9001\u63a5\u53e3",level:3},{value:"\u901a\u9053\u91ca\u653e\u63a5\u53e3",id:"\u901a\u9053\u91ca\u653e\u63a5\u53e3",level:3},{value:"MSGBOX \u7533\u8bf7\u6d41\u7a0b",id:"msgbox-\u7533\u8bf7\u6d41\u7a0b",level:3},{value:"MSGBOX \u63a5\u6536\u6d41\u7a0b",id:"msgbox-\u63a5\u6536\u6d41\u7a0b",level:3},{value:"MSGBOX \u53d1\u9001\u6d41\u7a0b",id:"msgbox-\u53d1\u9001\u6d41\u7a0b",level:3},{value:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",level:2}];function o(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,i.a)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h1,{id:"msgbox---\u5f02\u6784\u901a\u8baf",children:"MSGBOX - \u5f02\u6784\u901a\u8baf"}),"\n",(0,r.jsx)(e.p,{children:"msgbox \u7528\u6765\u5b9e\u73b0\u591a CPU \u4e4b\u95f4\u901a\u8baf\uff0c\u5728\u4e00\u4e9b IC \u5185\u90e8\u53ef\u80fd\u540c\u65f6\u5b58\u5728\u591a\u79cd\u6838\u5fc3\u7528\u6765\u5b9e\u73b0\u591a\u79cd\u4e0d\u540c\u529f\u80fd\uff0c\u8fd9\u4e9b\u4e0d\u540c\u6838\u5fc3\u8fd0\u884c\u4e0d\u540c\u67b6\u6784\u3001\u4e0d\u540c\u7cfb\u7edf\uff0c\u9700\u8981\u901a\u8fc7 MSGBOX \u7528\u6765\u5b9e\u73b0\u8fd9\u4e9b\u4e0d\u540c\u7cfb\u7edf\u95f4\u901a\u8baf\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u6a21\u5757\u4ecb\u7ecd",children:"\u6a21\u5757\u4ecb\u7ecd"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"msgbox \u4e3a\u4e00\u4e2a\u53cc\u7aef fifo \u7ed3\u6784\uff0ccpu0 \u4ece\u4e00\u7aef\u5199\uff0ccpu1 \u4ece\u4e00\u7aef\u8bfb\u3002"}),"\n",(0,r.jsx)(e.li,{children:"rpmsg \u4e3a linux \u7528\u6765\u5b9e\u73b0\u901a\u8baf\u7684\u4e00\u79cd\u6846\u67b6"}),"\n",(0,r.jsx)(e.li,{children:"msgbox \u4e3a\u7247\u4e0a\u5904\u7406\u5668\u4e4b\u95f4\u63d0\u4f9b\u4e86\u4e2d\u65ad\u901a\u8baf\u673a\u5236"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u6a21\u5757\u914d\u7f6e",children:"\u6a21\u5757\u914d\u7f6e"}),"\n",(0,r.jsx)(e.p,{children:"\u914d\u7f6e\u8def\u5f84\u5982\u4e0b:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{children:"Kernel Setup ---\x3e\r\n    Drivers Setup ---\x3e\r\n        SoC HAL Drivers ---\x3e\r\n            msgbox devices ---\x3e\r\n                [*] enable msgbox driver\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6e90\u7801\u7ed3\u6784",children:"\u6e90\u7801\u7ed3\u6784"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"msgbox/\r\n    \u251c\u2500\u2500 msgbox_amp            // msgbox AMP \u5b9e\u73b0\r\n    \u2502\xa0\xa0 \u251c\u2500\u2500 Makefile\r\n    \u2502\xa0\xa0 \u2514\u2500\u2500 msgbox_amp.c        \r\n    \u251c\u2500\u2500 platform              // \u5e73\u53f0\u5bc4\u5b58\u5668\u5b9a\u4e49\r\n    \u2502\xa0\xa0 \u251c\u2500\u2500 msgbox-sun20iw2.h\r\n    \u2514\u2500\u2500 platform-msgbox.h     // \u516c\u5171\u5934\u6587\u4ef6\n"})}),"\n",(0,r.jsx)(e.h2,{id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",children:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e"}),"\n",(0,r.jsx)(e.p,{children:"\u5934\u6587\u4ef6"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"#include <hal_msgbox.h>\n"})}),"\n",(0,r.jsx)(e.h3,{id:"\u521d\u59cb\u5316\u63a5\u53e3",children:"\u521d\u59cb\u5316\u63a5\u53e3"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"int32_t hal_msgbox_init(void);\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u65e0"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,r.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u901a\u9053\u7533\u8bf7\u63a5\u53e3",children:"\u901a\u9053\u7533\u8bf7\u63a5\u53e3"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"uint32_t hal_msgbox_alloc_channel(struct msg_endpoint *edp, int32_t remote, int32_t read, int32_t write);\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"edp\uff1amsgbox\u7684\u7aef\u70b9"}),"\n",(0,r.jsx)(e.li,{children:"remote\uff1a\u8fdc\u7aef\u6838\u5fc3id"}),"\n",(0,r.jsx)(e.li,{children:"read\uff1a\u8bfb\u901a\u9053"}),"\n",(0,r.jsx)(e.li,{children:"write\uff1a\u5199\u901a\u9053"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,r.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u6570\u636e\u53d1\u9001\u63a5\u53e3",children:"\u6570\u636e\u53d1\u9001\u63a5\u53e3"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"uint32_t hal_msgbox_channel_send(struct msg_endpoint *edp, uint8_t *bf, uint32_t len);\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"edp\uff1amsgbox\u7684\u7aef\u70b9"}),"\n",(0,r.jsx)(e.li,{children:"bf\uff1a\u6570\u636ebuffer"}),"\n",(0,r.jsx)(e.li,{children:"len\uff1abuffer\u957f\u5ea6"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,r.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"\u901a\u9053\u91ca\u653e\u63a5\u53e3",children:"\u901a\u9053\u91ca\u653e\u63a5\u53e3"}),"\n",(0,r.jsx)(e.p,{children:"\u51fd\u6570\u539f\u578b\uff1a"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:"void hal_msgbox_free_channel(struct msg_endpoint *edp);\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u53c2\u6570\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"edp\uff1amsgbox\u7684\u7aef\u70b9"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u8fd4\u56de\u503c\uff1a"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"0\uff1a\u6210\u529f"}),"\n",(0,r.jsx)(e.li,{children:"\u8d1f\u6570\uff1a\u5931\u8d25"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"msgbox-\u7533\u8bf7\u6d41\u7a0b",children:"MSGBOX \u7533\u8bf7\u6d41\u7a0b"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u4f7f\u7528hal_msgbox_alloc_channel\u63a5\u53e3\u7533\u8bf7 msgbox \u901a\u9053"}),"\n",(0,r.jsx)(e.li,{children:"\u586b\u5145msg_endpoint\u63a5\u6536\u56de\u8c03\uff0c\u8fd9\u4e2a\u4f1a\u5728 msgbox \u7684\u4e2d\u65ad\u51fd\u6570\u91cc\u8c03\u7528"}),"\n",(0,r.jsx)(e.li,{children:"\u901a\u8fc7hal_msgbox_channel_send\u8fdb\u884c\u6570\u636e\u53d1\u9001"}),"\n",(0,r.jsx)(e.li,{children:"\u63a5\u6536\u901a\u8fc7\u4e2d\u65ad\u7684\u65b9\u5f0f\u8fdb\u884c\u63a5\u6536\uff0c\u4f1a\u8c03\u7528msg_endpoint\u7684\u56de\u8c03\uff0c\u65e0\u9700\u4e3b\u52a8\u8c03\u7528"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"msgbox-\u63a5\u6536\u6d41\u7a0b",children:"MSGBOX \u63a5\u6536\u6d41\u7a0b"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u5728\u63a5\u6536\u51fd\u6570\u91cc\u4f1a\u9996\u5148\u904d\u5386\u6240\u6709\u7684msg_endpoint\uff0c\u5224\u65ad\u5f53\u524d\u7ec8\u7aef\u662f\u5426\u6709\u4e2d\u65ad\u53d1\u9001"}),"\n",(0,r.jsx)(e.li,{children:"irq_msgbox_channel_handler\u91cc\u4f1a\u8bfb\u53d6\u5f53\u524dmsg_endpoint\u7684\u5bc4\u5b58\u5668\uff0c\u6765\u5224\u65ad\u662f\u5426\u6709\u4e2d\u65ad\uff0c\u5982\u679c\u6709\uff0c\u5219\u8bfb\u53d6\u6570\u636e"}),"\n",(0,r.jsx)(e.li,{children:"\u9000\u51fa\u4e2d\u65ad"}),"\n"]}),"\n",(0,r.jsx)(e.h3,{id:"msgbox-\u53d1\u9001\u6d41\u7a0b",children:"MSGBOX \u53d1\u9001\u6d41\u7a0b"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"\u8c03\u7528hal_msgbox_channel_send\u63a5\u53e3\u8fdb\u884c\u6570\u636e\u53d1\u9001"}),"\n",(0,r.jsx)(e.li,{children:"msgbox_channel_send_data\u4f1a\u5224\u65ad\u662f\u8fdc\u7aef\u5904\u7406\u5668\u662f\u54ea\u4e2a\uff0c\u5e76\u4e14\u8ba1\u7b97 local->remote \u7684\u7cfb\u6570 N \u662f\u591a\u5c11\uff0c\u8fd9\u4e2a\u7cfb\u6570\u56de\u5b58\u653e\u5728 to_coef_n \u7684\u8868\u683c\u91cc"}),"\n",(0,r.jsx)(e.li,{children:"\u8ba1\u7b97\u5b8c\u6210\u540e\u5f80\u8fdc\u7aef\u7684 msgbox \u7684 fifo \u4e2d\u5199\u6570\u636e"}),"\n",(0,r.jsx)(e.li,{children:"\u53d1\u9001\u5b8c\u6210"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b",children:"\u6a21\u5757\u4f7f\u7528\u8303\u4f8b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-c",children:'#include <FreeRTOS.h>\r\n#include <queue.h>\r\n#include <stdio.h>\r\n#include <stdlib.h>\r\n#include <stdint.h>\r\n#include <unistd.h>\r\n#include <string.h>\r\n#include <awlog.h>\r\n#include <hal_msgbox.h>\r\n\r\n#include <console.h>\r\n\r\n#define RECEIVE_QUEUE_LENGTH 16\r\n#define RECEIVE_QUEUE_WAIT_MS 100\r\n\r\nstruct msgbox_demo {\r\n\tint remote_id;\r\n\tint read_ch;\r\n\tint write_ch;\r\n\tQueueHandle_t recv_queue;\r\n};\r\n\r\nstatic void print_help_msg(void)\r\n{\r\n\tprintf("\\n");\r\n\tprintf("USAGE:\\n");\r\n\tprintf("  hal_msgbox <REQUIRED_ARGUMENTS> [OPTIONS]\\n");\r\n\tprintf("\\n");\r\n\tprintf("REQUIRED_ARGUMENTS:\\n");\r\n\tprintf("  -E REMOTE_ID: specify remote id\\n");\r\n\tprintf("  -R READ_CH  : specify read channel\\n");\r\n\tprintf("  -W WRITE_CH : specify write channel\\n");\r\n\tprintf("OPTIONS:\\n");\r\n\tprintf("  -s MESSAGE  : send MESSAGE\\n");\r\n\tprintf("  -r          : receive messages\\n");\r\n\tprintf("  -t TIMEOUT  : exit in TIMEOUT seconds when receive\\n");\r\n\tprintf("e.g. (communicate with remote 0, use read channel 3 and write channel 3):\\n");\r\n\tprintf("  hal_msgbox -E 0 -R 3 -W 3 -s \\"hello\\" : send string \\"hello\\"\\n");\r\n\tprintf("  hal_msgbox -E 0 -R 3 -W 3 -r           : receive messages (default in 10 seconds)\\n");\r\n\tprintf("  hal_msgbox -E 0 -R 3 -W 3 -r -t 20     : receive messages in 20 seconds\\n");\r\n\tprintf("\\n");\r\n}\r\n\r\nstatic int recv_callback(unsigned long data, void *private_data)\r\n{\r\n\tBaseType_t taskwoken = pdFALSE;\r\n\tprintf("Receive callback (data: 0x%lx)\\n", data);\r\n\tstruct msgbox_demo *demo = private_data;\r\n\tBaseType_t ret = xQueueSendFromISR(demo->recv_queue, &data, &taskwoken);\r\n\tif (ret == errQUEUE_FULL) {\r\n\t\tprintf("recv_queue is full\\n");\r\n\t\treturn -1;\r\n\t}\r\n\tif (ret == pdPASS) {\r\n\t\tportYIELD_FROM_ISR(taskwoken);\r\n\t}\r\n\treturn 0;\r\n}\r\n\r\nstatic int cmd_hal_msgbox(int argc, char *argv[])\r\n{\r\n\tint ret = 0;\r\n\tint c;\r\n\r\n\tstruct msgbox_demo demo= {\r\n\t\t.remote_id = -1,\r\n\t\t.read_ch = -1,\r\n\t\t.write_ch = -1,\r\n\t\t.recv_queue = NULL,\r\n\t};\r\n\tstruct msg_endpoint ept;\r\n\r\n\tTickType_t start_ticks, current_ticks;\r\n\tint do_send = 0;\r\n\tconst char *data_send= NULL;\r\n\tint do_recv = 0;\r\n\tint timeout_sec = 10;\r\n\tuint32_t data_recv;\r\n\r\n\tif (argc <= 1) {\r\n\t\tprint_help_msg();\r\n\t\tret = -1;\r\n\t\tgoto out;\r\n\t}\r\n\r\n\twhile ((c = getopt(argc, argv, "hs:rt:E:W:R:")) != -1) {\r\n\t\tswitch (c) {\r\n\t\tcase \'h\' :\r\n\t\t\tprint_help_msg();\r\n\t\t\tret = 0;\r\n\t\t\tgoto out;\r\n\t\tcase \'E\':\r\n\t\t\tdemo.remote_id = atoi(optarg);\r\n\t\t\tbreak;\r\n\t\tcase \'R\':\r\n\t\t\tdemo.read_ch = atoi(optarg);\r\n\t\t\tbreak;\r\n\t\tcase \'W\':\r\n\t\t\tdemo.write_ch = atoi(optarg);\r\n\t\t\tbreak;\r\n\t\tcase \'s\':\r\n\t\t\tdo_send = 1;\r\n\t\t\tdata_send = optarg;\r\n\t\t\tbreak;\r\n\t\tcase \'r\':\r\n\t\t\tdo_recv = 1;\r\n\t\t\tbreak;\r\n\t\tcase \'t\':\r\n\t\t\ttimeout_sec = atoi(optarg);\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tprint_help_msg();\r\n\t\t\tret = -1;\r\n\t\t\tgoto out;\r\n\t\t}\r\n\t}\r\n\r\n\tif (demo.remote_id < 0 || demo.read_ch < 0 || demo.write_ch < 0) {\r\n\t\tprintf("Error. Please specify remote id, read channel and write channel\\n");\r\n\t\tprint_help_msg();\r\n\t\tret = -1;\r\n\t\tgoto out;\r\n\t}\r\n\r\n\tprintf("remote id: %d, write channel: %d, read channel: %d\\n",\r\n\t\t\tdemo.remote_id, demo.write_ch, demo.read_ch);\r\n\r\n\tif (do_recv) {\r\n\t\tdemo.recv_queue = xQueueCreate(RECEIVE_QUEUE_LENGTH, sizeof(uint32_t));\r\n\t\tif (!demo.recv_queue) {\r\n\t\t\tprintf("Failed to create receive queue\\n");\r\n\t\t\tret = -1;\r\n\t\t\tgoto out;\r\n\t\t}\r\n\t\tept.rec = (void *)recv_callback;\r\n\t\tept.private = &demo;\r\n\t}\r\n\r\n\tret = hal_msgbox_alloc_channel(&ept, demo.remote_id, demo.read_ch, demo.write_ch);\r\n\tif (ret != 0) {\r\n\t\tprintf("Failed to allocate msgbox channel\\n");\r\n\t\tgoto delete_recv_queue;\r\n\t}\r\n\r\n\tif (do_send) {\r\n\t\tret = hal_msgbox_channel_send(&ept, (unsigned char *)data_send, strlen(data_send));\r\n\t\tif (ret != 0) {\r\n\t\t\tprintf("Failed to send message\\n");\r\n\t\t\tgoto free_channel;\r\n\t\t}\r\n\t}\r\n\r\n\tif (do_recv) {\r\n\t\tprintf("hal_msgbox will exit in %d seconds\\n", timeout_sec);\r\n\t\tstart_ticks = xTaskGetTickCount();\r\n\t\tprintf("start_ticks: %u\\n", start_ticks);\r\n\r\n\t\twhile (1) {\r\n\t\t\tif (pdTRUE == xQueueReceive(demo.recv_queue, &data_recv,\r\n\t\t\t\t\t\tRECEIVE_QUEUE_WAIT_MS / portTICK_PERIOD_MS)) {\r\n\t\t\t\tprintf("Received from queue: 0x%x\\n", data_recv);\r\n\t\t\t}\r\n\t\t\tcurrent_ticks = xTaskGetTickCount();\r\n\t\t\tif ((current_ticks - start_ticks) * portTICK_PERIOD_MS\r\n\t\t\t\t\t>= timeout_sec * 1000) {\r\n\t\t\t\tprintf("current_ticks: %u\\n", current_ticks);\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tprintf("hal_msgbox exited\\n");\r\n\tret = 0;\r\n\r\nfree_channel:\r\n\thal_msgbox_free_channel(&ept);\r\ndelete_recv_queue:\r\n\tif (do_recv) {\r\n\t\tvQueueDelete(demo.recv_queue);\r\n\t}\r\nout:\r\n\treturn ret;\r\n}\r\n\r\nFINSH_FUNCTION_EXPORT_CMD(cmd_hal_msgbox, hal_msgbox, hal msgbox);\n'})})]})}function h(n={}){const{wrapper:e}={...(0,i.a)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(o,{...n})}):o(n)}},11151:(n,e,t)=>{t.d(e,{Z:()=>c,a:()=>s});var r=t(67294);const i={},l=r.createContext(i);function s(n){const e=r.useContext(l);return r.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function c(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:s(n.components),r.createElement(l.Provider,{value:e},n.children)}}}]);