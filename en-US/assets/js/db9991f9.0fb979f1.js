"use strict";(self.webpackChunkavaota_docs=self.webpackChunkavaota_docs||[]).push([[4957],{83858:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>d,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var r=s(85893),t=s(11151);const i={},d="SPI - \u540c\u6b65\u4e32\u884c\u5916\u8bbe\u63a5\u53e3",l={id:"linux-manual/sdk-develop/bsp-driver/spi",title:"SPI - \u540c\u6b65\u4e32\u884c\u5916\u8bbe\u63a5\u53e3",description:"SPI\u662f\u4e00\u79cd\u9ad8\u901f\u3001\u9ad8\u6548\u7387\u7684\u4e32\u884c\u5916\u56f4\u8bbe\u5907\u63a5\u53e3\u3002\u7531Motorola\u516c\u53f8\u63d0\u51fa\uff0c\u662f\u4e00\u79cd\u9ad8\u901f\u3001\u5168\u53cc\u5de5\u3001\u540c\u6b65\u901a\u4fe1\u603b\u7ebf\u3002SPI\u4ee5\u4e3b\u4ece\u65b9\u5f0f\u5de5\u4f5c\uff0c\u901a\u5e38\u662f\u6709\u4e00\u4e2a\u4e3b\u8bbe\u5907\u548c\u4e00\u4e2a\u6216\u591a\u4e2a\u4ece\u8bbe\u5907\uff0c\u65e0\u5e94\u7b54\u673a\u5236\u3002",source:"@site/docs/linux-manual/sdk-develop/bsp-driver/spi.md",sourceDirName:"linux-manual/sdk-develop/bsp-driver",slug:"/linux-manual/sdk-develop/bsp-driver/spi",permalink:"/en-US/linux-manual/sdk-develop/bsp-driver/spi",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"linuxManualSidebar",previous:{title:"Security ID - \u82af\u7247ID",permalink:"/en-US/linux-manual/sdk-develop/bsp-driver/sid"},next:{title:"Timer - \u5b9a\u65f6\u5668",permalink:"/en-US/linux-manual/sdk-develop/bsp-driver/timer"}},a={},c=[{value:"\u6a21\u5757\u914d\u7f6e",id:"\u6a21\u5757\u914d\u7f6e",level:2},{value:"\u9a71\u52a8\u914d\u7f6e",id:"\u9a71\u52a8\u914d\u7f6e",level:3},{value:"\u8bbe\u5907\u6811\u914d\u7f6e",id:"\u8bbe\u5907\u6811\u914d\u7f6e",level:3},{value:"\u6a21\u5757\u9a71\u52a8",id:"\u6a21\u5757\u9a71\u52a8",level:2},{value:"SPI \u5185\u6838\u6846\u67b6",id:"spi-\u5185\u6838\u6846\u67b6",level:3},{value:"\u7528\u6237\u7a7a\u95f4",id:"\u7528\u6237\u7a7a\u95f4",level:4},{value:"\u5185\u6838\u7a7a\u95f4",id:"\u5185\u6838\u7a7a\u95f4",level:4},{value:"SPI\u9a71\u52a8\u6838\u5fc3\u5c42\uff08SPI Core\uff09",id:"spi\u9a71\u52a8\u6838\u5fc3\u5c42spi-core",level:5},{value:"SPI\u8bbe\u5907\u9a71\u52a8\u5c42\uff08SPI Device Driver\uff09",id:"spi\u8bbe\u5907\u9a71\u52a8\u5c42spi-device-driver",level:5},{value:"SPI\u63a7\u5236\u5668\u9a71\u52a8\u5c42\uff08SPI Master Driver\uff09",id:"spi\u63a7\u5236\u5668\u9a71\u52a8\u5c42spi-master-driver",level:5},{value:"\u786c\u4ef6",id:"\u786c\u4ef6",level:4},{value:"\u9a71\u52a8\u6846\u67b6",id:"\u9a71\u52a8\u6846\u67b6",level:3},{value:"Master",id:"master",level:4},{value:"Flash",id:"flash",level:4},{value:"Slave",id:"slave",level:4},{value:"DBI",id:"dbi",level:4},{value:"BIT",id:"bit",level:4},{value:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",level:3},{value:"\u8bbe\u5907\u6ce8\u518c\u63a5\u53e3",id:"\u8bbe\u5907\u6ce8\u518c\u63a5\u53e3",level:4},{value:"spi_register_driver",id:"spi_register_driver",level:5},{value:"spi_unregister_driver",id:"spi_unregister_driver",level:5},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b",level:5},{value:"\u6570\u636e\u4f20\u8f93\u63a5\u53e3",id:"\u6570\u636e\u4f20\u8f93\u63a5\u53e3",level:4},{value:"spi_message_init",id:"spi_message_init",level:5},{value:"spi_message_add_tail",id:"spi_message_add_tail",level:5},{value:"spi_sync",id:"spi_sync",level:5},{value:"spi_async",id:"spi_async",level:5},{value:"spi_slave_abort",id:"spi_slave_abort",level:5},{value:"\u4f7f\u7528\u793a\u4f8b",id:"\u4f7f\u7528\u793a\u4f8b-1",level:5},{value:"\u4f7f\u7528\u8303\u4f8b",id:"\u4f7f\u7528\u8303\u4f8b",level:2},{value:"Master \u6a21\u5f0f",id:"master-\u6a21\u5f0f",level:3},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5",level:4},{value:"\u793a\u4f8b\u4ee3\u7801",id:"\u793a\u4f8b\u4ee3\u7801",level:4},{value:"Slave \u6a21\u5f0f",id:"slave-\u6a21\u5f0f",level:3},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5-1",level:4},{value:"Slave \u9a71\u52a8\u793a\u4f8b\u4ee3\u7801",id:"slave-\u9a71\u52a8\u793a\u4f8b\u4ee3\u7801",level:4},{value:"Flash \u6a21\u5f0f",id:"flash-\u6a21\u5f0f",level:3},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5-2",level:4},{value:"DBI \u6a21\u5f0f",id:"dbi-\u6a21\u5f0f",level:3},{value:"BIT \u6a21\u5f0f",id:"bit-\u6a21\u5f0f",level:3},{value:"\u6d4b\u8bd5",id:"\u6d4b\u8bd5-3",level:4},{value:"\u9a71\u52a8\u8c03\u8bd5",id:"\u9a71\u52a8\u8c03\u8bd5",level:2},{value:"\u8c03\u8bd5\u8282\u70b9",id:"\u8c03\u8bd5\u8282\u70b9",level:3},{value:"FAQ",id:"faq",level:2},{value:"\u5982\u4f55\u5f3a\u5236\u4f7f\u7528CPU\u4f20\u8f93",id:"\u5982\u4f55\u5f3a\u5236\u4f7f\u7528cpu\u4f20\u8f93",level:3}];function _(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"spi---\u540c\u6b65\u4e32\u884c\u5916\u8bbe\u63a5\u53e3",children:"SPI - \u540c\u6b65\u4e32\u884c\u5916\u8bbe\u63a5\u53e3"}),"\n",(0,r.jsx)(n.p,{children:"SPI\u662f\u4e00\u79cd\u9ad8\u901f\u3001\u9ad8\u6548\u7387\u7684\u4e32\u884c\u5916\u56f4\u8bbe\u5907\u63a5\u53e3\u3002\u7531Motorola\u516c\u53f8\u63d0\u51fa\uff0c\u662f\u4e00\u79cd\u9ad8\u901f\u3001\u5168\u53cc\u5de5\u3001\u540c\u6b65\u901a\u4fe1\u603b\u7ebf\u3002SPI\u4ee5\u4e3b\u4ece\u65b9\u5f0f\u5de5\u4f5c\uff0c\u901a\u5e38\u662f\u6709\u4e00\u4e2a\u4e3b\u8bbe\u5907\u548c\u4e00\u4e2a\u6216\u591a\u4e2a\u4ece\u8bbe\u5907\uff0c\u65e0\u5e94\u7b54\u673a\u5236\u3002"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5168\u53cc\u5de5\u540c\u6b65\u4e32\u884c\u63a5\u53e3"}),"\n",(0,r.jsx)(n.li,{children:"Master/Slave\u6a21\u5f0f\u53ef\u914d\u7f6e"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301\u6700\u5927100MHz\u65f6\u949f\u9891\u7387"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301SPI Mode0/1/2/3"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301\u591a\u7247\u9009"}),"\n",(0,r.jsx)(n.li,{children:"\u7247\u9009\u548c\u65f6\u949f\u7684\u6781\u6027\u548c\u76f8\u4f4d\u53ef\u914d\u7f6e"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301CPU(\u4e2d\u65ad)\u6216DMA\u6a21\u5f0f\u4f20\u8f93"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301TX/RX FIFO\u7f13\u5b58"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301Standard Single/Dual/Quad\u6570\u636e\u6a21\u5f0f\uff08Slave\u6a21\u5f0f\u4e0d\u652f\u6301Dual/Quad\uff09"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301BIT\u6a21\u5f0f\uff0c\u7528\u4e8e3Wire\u573a\u666f\uff0c\u652f\u6301\u53ef\u7f16\u7a0b0~32bits\u5e27\u957f\u5ea6\uff08\u4ec5\u652f\u6301Master\u6a21\u5f0f\uff0c\u4e14\u4e0d\u652f\u6301DMA\u548cFIFO\u529f\u80fd\uff09"}),"\n",(0,r.jsx)(n.li,{children:"\u652f\u6301DBI\u6a21\u5f0f\uff0c\u7528\u4e8e\u663e\u793a\u8bbe\u5907\u573a\u666f\uff0c\u7528\u4e8e\u4f20\u8f93\u89c6\u9891\u6570\u636e"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6a21\u5757\u914d\u7f6e",children:"\u6a21\u5757\u914d\u7f6e"}),"\n",(0,r.jsx)(n.h3,{id:"\u9a71\u52a8\u914d\u7f6e",children:"\u9a71\u52a8\u914d\u7f6e"}),"\n",(0,r.jsx)(n.p,{children:"\u9a71\u52a8\u4f4d\u4e8e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"SPI NG Drivers ->\r\n\t<*> SPI NG Driver Support for Allwinner SoCs\r\n\t[ ]   Support atomic xfer function\r\n\t< >   SPI Slave Test Driver\r\n\t< >   SPI Camera Test Driver\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240330103657973",src:s(59758).Z+"",width:"1082",height:"282"})}),"\n",(0,r.jsx)(n.h3,{id:"\u8bbe\u5907\u6811\u914d\u7f6e",children:"\u8bbe\u5907\u6811\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'spi0: spi@4025000 {\r\n\t#address-cells = <1>;\r\n\t#size-cells = <0>;\r\n\tcompatible = "allwinner,sunxi-spi-v1.3";\t\t// \u5177\u4f53\u7684\u8bbe\u5907\uff0c\u7528\u4e8e\u9a71\u52a8\u548c\u8bbe\u5907\u7684\u7ed1\u5b9a\r\n\treg = <0x0 0x04025000 0x0 0x1000>;\t\t\t\t// \u6a21\u5757\u5bc4\u5b58\u5668\u5730\u5740\r\n\tinterrupts = <GIC_SPI 16 IRQ_TYPE_LEVEL_HIGH>;\t// \u603b\u7ebf\u4e2d\u65ad\u53f7\u3001\u4e2d\u65ad\u7c7b\u578b\r\n\tclocks = <&ccu CLK_PLL_PERI0_300M>, <&ccu CLK_SPI0>, <&ccu CLK_BUS_SPI0>;\t// \u8bbe\u5907\u4f7f\u7528\u7684\u65f6\u949f\r\n\tclock-names = "pll", "mod", "bus";\t\t\t\t// \u8bbe\u5907\u4f7f\u7528\u7684\u65f6\u949f\u540d\u79f0\r\n\tresets = <&ccu RST_BUS_SPI0>;\t\t\t\t\t// \u8bbe\u5907\u7684reset\u65f6\u949f\r\n\tdmas = <&dma 22>, <&dma 22>;\t\t\t\t\t// \u63a7\u5236\u5668\u4f7f\u7528\u7684dma\u901a\u9053\u53f7\r\n\tdma-names = "tx", "rx";\t\t\t\t\t\t\t// \u63a7\u5236\u5668\u4f7f\u7528\u901a\u9053\u53f7\u5bf9\u5e94\u7684\u540d\u5b57\r\n\tclock-frequency = <100000000>;\t\t\t\t\t// \u63a7\u5236\u5668\u652f\u6301\u7684\u6700\u5927\u65f6\u949f\u9891\u7387\uff08\u901a\u5e38\u4e3a100MHz\uff09\r\n\tsunxi,spi-num-cs = <1>;\t\t\t\t\t\t\t// \u63a7\u5236\u5668\u652f\u6301\u7684\u6700\u5927\u7247\u9009\u6570\u91cf\uff08\u4e00\u822cCS0\u9ed8\u8ba4\u5f15\u51fa\uff0cCS1~3\u6839\u636eIC\u5e73\u53f0\u51b3\u5b9a\uff09\r\n\tstatus = "disabled";\t\t\t\t\t\t\t// \u63a7\u5236\u5668\u662f\u5426\u4f7f\u80fd\r\n};\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u4e3a\u4e86\u5728SPI\u603b\u7ebf\u9a71\u52a8\u4ee3\u7801\u4e2d\u533a\u5206\u6bcf\u4e00\u4e2aSPI\u63a7\u5236\u5668\uff0c\u9700\u8981\u5728\u8bbe\u5907\u6811\u4e2d\u4e3a\u6bcf\u4e2aSPI\u63a7\u5236\u5668\u6307\u5b9a\u522b\u540d\uff1a"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"aliases {\r\n\tspi0 = &spi0;\r\n};\n"})}),"\n",(0,r.jsxs)(n.p,{children:['\u522b\u540d\u5f62\u5f0f\u4e3a\u5b57\u7b26\u4e32 "spi" \u52a0\u8fde\u7eed\u7f16\u53f7\u7684\u6570\u5b57\uff0c\u5728 SPI \u603b\u7ebf\u9a71\u52a8\u7a0b\u5e8f\u4e2d\u53ef\u4ee5\u901a\u8fc7 ',(0,r.jsx)(n.code,{children:"of_alias_get_id"})," \u51fd\u6570\u83b7\u53d6\u5bf9\u5e94SPI\u63a7\u5236\u5668\u7684\u6570\u5b57\u7f16\u53f7\uff0c\u4ece\u800c\u533a\u522b\u6bcf\u4e00\u4e2aSPI\u63a7\u5236\u5668\u3002"]}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u8bbe\u5907\u7aef\uff0c\u914d\u7f6e\u4e86 SPI \u7684\u5f15\u811a\uff0c\u914d\u7f6e\u4f4d\u4e8e ",(0,r.jsx)(n.code,{children:"pio"})," \u8282\u70b9\u4e0b"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'&pio {\r\n\tspi0_pins_default: spi0@0 {\r\n        pins = "PC12", "PC2", "PC4"; /* clk, mosi, miso */\r\n        function = "spi0";\r\n        drive-strength = <10>;\r\n    };\r\n\r\n    spi0_pins_cs: spi0@1 {\r\n        pins = "PC3";\r\n        function = "spi0";\r\n        drive-strength = <10>;\r\n        bias-pull-up;   /* cs, hold, wp should be pulled up */\r\n    };\r\n\r\n    spi0_pins_sleep: spi0@2 {\r\n        pins = "PC12", "PC2", "PC4", "PC3";\r\n        function = "gpio_in";\r\n        drive-strength = <10>;\r\n    };\r\n};\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u914d\u7f6e\u8bbe\u5907\u8282\u70b9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'&spi0 {\r\n\tpinctrl-0 = <&spi0_pins_default &spi0_pins_cs>;\r\n\tpinctrl-1 = <&spi0_pins_sleep>;\r\n\tpinctrl-names = "default", "sleep";\r\n\tsunxi,spi-bus-mode = <SUNXI_SPI_BUS_NOR>;\r\n\tsunxi,spi-cs-mode = <SUNXI_SPI_CS_SOFT>;\r\n\tstatus = "okay";\r\n\r\n\tspi_board0 {\r\n\t\tdevice_type = "spi_board0";\r\n\t\tcompatible = "spi-nor";\r\n\t\tspi-max-frequency = <100000000>;\r\n\t\tm25p,fast-read = <1>;\r\n\t\t/*individual_lock;*/\r\n\t\treg = <0x0>; //CS0\r\n\t\tspi-rx-bus-width = <4>;\r\n\t\tspi-tx-bus-width = <4>;\r\n\t\tstatus = "okay";\r\n\t};\r\n};\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sunxi,spi-num-cs"}),"\uff1a\u5b9a\u4e49\u8be5 SPI \u63a7\u5236\u5668\u6700\u591a\u652f\u6301\u591a\u5c11\u4e2a\u7247\u9009\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sunxi,spi-bus-mode"}),"\uff1a\u5b9a\u4e49 SPI \u63a7\u5236\u5668\u6240\u5904\u7684\u72b6\u6001\uff0c\u53ef\u914d\u7f6e\u4e3a\u5982\u4e0b\u51e0\u79cd\u6a21\u5f0f\u3002","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SUNXI_SPI_BUS_MASTER"}),"\uff1a\u5904\u4e8e Master \u6a21\u5f0f\uff0c\u5916\u63a5 SPI Device\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SUNXI_SPI_BUS_SLAVE"}),"\uff1a\u5904\u4e8e Slave \u6a21\u5f0f\uff0c\u88ab\u5176\u4ed6 Master \u8bbf\u95ee\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SUNXI_SPI_BUS_DBI"}),"\uff1a\u5904\u4e8e DBI \u6a21\u5f0f\uff0c\u5916\u63a5 DBI \u5c4f\u5e55\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SUNXI_SPI_BUS_BIT"}),"\uff1a\u5904\u4e8e BIT \u6a21\u5f0f\uff0c\u4f7f\u7528 3Wire \u65b9\u5f0f\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SUNXI_SPI_BUS_NOR"}),"\uff1a\u5904\u4e8e NOR \u6a21\u5f0f\uff0c\u7528\u4e8e\u5916\u63a5 SPI Nor Flash \u7684\u60c5\u51b5\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SUNXI_SPI_BUS_NAND"}),"\uff1a\u5904\u4e8e NAND \u6a21\u5f0f\uff0c\u7528\u4e8e\u5916\u63a5 SPI Nand Flash \u7684\u60c5\u51b5\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sunxi,spi-cs-mode"}),"\uff1a\u5b9a\u4e49 SPI \u63a7\u5236\u5668\u5bf9\u7247\u9009\u7684\u63a7\u5236\u65b9\u5f0f\uff0c\u53ef\u914d\u7f6e\u4e3a\u5982\u4e0b\u51e0\u79cd\u6a21\u5f0f\u3002","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SUNXI_SPI_CS_AUTO"}),"\uff1a\u786c\u4ef6\u81ea\u52a8\u63a7\u5236\uff0c\u4e0d\u9700\u8981\u9a71\u52a8\u6216\u8f6f\u4ef6\u4ecb\u5165\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"SUNXI_SPI_CS_SOFT"}),"\uff1a\u8f6f\u4ef6\u624b\u52a8\u63a7\u5236\uff0c\u7531\u9a71\u52a8\u5b8c\u6210\u76f8\u5173\u64cd\u4f5c\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\u5f53 ",(0,r.jsx)(n.code,{children:"sunxi,spi-bus-mode"})," \u914d\u7f6e\u4e3a",(0,r.jsx)(n.code,{children:"SUNXI_SPI_BUS_NOR"}),"/",(0,r.jsx)(n.code,{children:"SUNXI_SPI_BUS_NAND"}),"\u65f6\uff0c",(0,r.jsx)(n.code,{children:"sunxi,spi-cs-mode"}),"\u4f1a\u5f3a\u5236\u4f7f\u7528",(0,r.jsx)(n.code,{children:"SUNXI_SPI_CS_SOFT"}),"\u6a21\u5f0f\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"spi-max-frequency"})," \u662f\u8be5SPI\u5916\u8bbe\u7684\u6700\u5927\u8f93\u51fa\u65f6\u949f\u9891\u7387\uff0c\u914d\u7f6e\u65f6\u4e0d\u53ef\u8d85\u8fc7dtsi\u4e2d\u914d\u7f6e\u7684SPI\u63a7\u5236\u5668\u6700\u5927\u65f6\u949f\u9891\u7387"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"\u6a21\u5757\u9a71\u52a8",children:"\u6a21\u5757\u9a71\u52a8"}),"\n",(0,r.jsxs)(n.p,{children:["SPI \u603b\u7ebf\u9a71\u52a8\u4f4d\u4e8e ",(0,r.jsx)(n.code,{children:"drivers/spi-ng"})," \u4e0b"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"\u251c\u2500\u2500 bit\r\n\u2502   \u251c\u2500\u2500 spi-sunxi-bit.h\t\t# bit\u6a21\u5f0f\u5934\u6587\u4ef6\uff0c\u5305\u62ecBIT\u6a21\u5f0f\u6240\u4f7f\u7528\u7684\u5bc4\u5b58\u5668\u4fe1\u606f\r\n\u2502   \u2514\u2500\u2500 spi-sunxi-bit.c\t\t# bit\u6a21\u5f0f\u6e90\u6587\u4ef6\uff0c\u5305\u62ecBIT\u6a21\u5f0f\u529f\u80fd\u914d\u7f6e\u7684\u5bc4\u5b58\u5668\u8bfb\u5199\u914d\u7f6e\u7b49\u5b9e\u73b0\r\n\u251c\u2500\u2500 dbi\r\n\u2502   \u251c\u2500\u2500 spi-sunxi-dbi-api.h\t# dbi\u6a21\u5f0fAPI\u5934\u6587\u4ef6\uff0c\u63d0\u4f9b\u5bf9\u5e94API\u7ed9\u4e0a\u5c42\u9a71\u52a8\u8c03\u7528\r\n\u2502   \u251c\u2500\u2500 spi-sunxi-dbi.h\t\t# dbi\u6a21\u5f0f\u5934\u6587\u4ef6\uff0c\u5305\u62ecDBI\u6a21\u5f0f\u6240\u4f7f\u7528\u7684\u5bc4\u5b58\u5668\u4fe1\u606f\r\n\u2502   \u2514\u2500\u2500 spi-sunxi-dbi.c\t\t# dbi\u6a21\u5f0f\u6e90\u6587\u4ef6\uff0c\u5305\u62ecDBI\u6a21\u5f0f\u529f\u80fd\u914d\u7f6e\u7684\u5bc4\u5b58\u5668\u8bfb\u5199\u914d\u7f6e\u7b49\u5b9e\u73b0\r\n\u251c\u2500\u2500 spi-sunxi-debug.h\t\t# debug\u76f8\u5173\u5b9a\u4e49\uff0c\u5305\u62ec\u6253\u5370\u5bc4\u5b58\u5668\u548c\u6570\u636e\u7684\u63a5\u53e3\r\n\u251c\u2500\u2500 spi-sunxi.h\t\t\t\t# \u5934\u6587\u4ef6\uff0c\u5305\u62ecLinux\u6846\u67b6\u79cd\u7684spi_controller\u5b9a\u4e49\u548cBYTE\u6a21\u5f0f\u7684\u5404\u4e2a\u5bc4\u5b58\u5668\u4fe1\u606f\r\n\u251c\u2500\u2500 spi-sunxi.c\t\t\t\t# \u9a71\u52a8\u6e90\u6587\u4ef6\uff0c\u5305\u62ecLinux\u6846\u67b6\u8981\u6c42\u5b9e\u73b0\u7684\u63a7\u5236\u5668\u63a5\u53e3\u548cMaster/Slave\u4e24\u79cd\u6a21\u5f0f\u7684\u5177\u4f53\u5b9e\u73b0\r\n\u2514\u2500\u2500 spi-sunxi-slave-test.c\t# AW SPI\u4ece\u6a21\u5f0f\u8bbe\u5907\u9a71\u52a8\u793a\u4f8b\uff0c\u6a21\u62df\u4e00\u4e2a\u53ef\u8bfb\u5199\u7684\u5185\u5b58\u8bbe\u5907\uff0c\u7c7b\u4f3c\u4e8eEEPROM\n"})}),"\n",(0,r.jsx)(n.h3,{id:"spi-\u5185\u6838\u6846\u67b6",children:"SPI \u5185\u6838\u6846\u67b6"}),"\n",(0,r.jsx)(n.p,{children:"Linux\u4e2dSPI\u4f53\u7cfb\u7ed3\u6784\u5206\u4e3a\u4e09\u4e2a\u5c42\u6b21"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240330104418565",src:s(62047).Z+"",width:"594",height:"513"})}),"\n",(0,r.jsx)(n.h4,{id:"\u7528\u6237\u7a7a\u95f4",children:"\u7528\u6237\u7a7a\u95f4"}),"\n",(0,r.jsx)(n.p,{children:"\u5305\u62ec\u6240\u6709\u4f7f\u7528SPI\u8bbe\u5907\u7684\u5e94\u7528\u7a0b\u5e8f\uff0c\u5728\u8fd9\u4e00\u5c42\u7528\u6237\u53ef\u4ee5\u6839\u636e\u81ea\u5df1\u7684\u5b9e\u9645\u9700\u6c42\uff0c\u5c06spi\u8bbe\u5907\u8fdb\u884c\u4e00\u4e9b\u7279\u6b8a\u7684\u5904\u7406\uff0c\u6b64\u65f6\u63a7\u5236\u5668\u9a71\u52a8\u7a0b\u5e8f\u5e76\u4e0d\u6e05\u695a\u548c\u5173\u6ce8\u8bbe\u5907\u7684\u5177\u4f53\u529f\u80fd\uff0cSPI\u8bbe\u5907\u7684\u5177\u4f53\u529f\u80fd\u662f\u7531\u7528\u6237\u5c42\u7a0b\u5e8f\u5b8c\u6210\u7684\u3002\u4f8b\u5982\uff0c\u548cMTD\u5c42\u4ea4\u4e92\u4ee5\u4fbf\u628aSPI\u63a5\u53e3\u7684\u5b58\u50a8\u8bbe\u5907\u5b9e\u73b0\u4e3a\u67d0\u4e2a\u6587\u4ef6\u7cfb\u7edf\uff0c\u548cTTY\u5b50\u7cfb\u7edf\u4ea4\u4e92\u628aSPI\u8bbe\u5907\u5b9e\u73b0\u4e3a\u4e00\u4e2aTTY\u8bbe\u5907\uff0c\u548c\u7f51\u7edc\u5b50\u7cfb\u7edf\u4ea4\u4e92\u4ee5\u4fbf\u628a\u4e00\u4e2aSPI\u8bbe\u5907\u5b9e\u73b0\u4e3a\u4e00\u4e2a\u7f51\u7edc\u8bbe\u5907\uff0c\u7b49\u7b49\u3002\u5f53\u7136\uff0c\u5982\u679c\u662f\u4e00\u4e2a\u4e13\u6709\u7684SPI\u8bbe\u5907\uff0c\u6211\u4eec\u4e5f\u53ef\u4ee5\u6309\u8bbe\u5907\u7684\u534f\u8bae\u8981\u6c42\uff0c\u5b9e\u73b0\u81ea\u5df1\u7684\u4e13\u6709\u534f\u8bae\u9a71\u52a8\u3002\u540c\u65f6\u8fd9\u90e8\u5206\u6211\u4eec\u4e0d\u7528\u5173\u6ce8\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u5185\u6838\u7a7a\u95f4",children:"\u5185\u6838\u7a7a\u95f4"}),"\n",(0,r.jsx)(n.p,{children:"\u5185\u6838\u7a7a\u95f4\u6211\u4eec\u540c\u6837\u7684\u4f1a\u5206\u4e3a\u4e00\u4e0b\u4e09\u90e8\u5206\uff1a"}),"\n",(0,r.jsx)(n.h5,{id:"spi\u9a71\u52a8\u6838\u5fc3\u5c42spi-core",children:"SPI\u9a71\u52a8\u6838\u5fc3\u5c42\uff08SPI Core\uff09"}),"\n",(0,r.jsx)(n.p,{children:"SPI Core\u662fLinux\u5185\u6838\u7528\u6765\u7ef4\u62a4\u548c\u7ba1\u7406spi\u7684\u6838\u5fc3\u90e8\u5206\uff0cSPI Core\u63d0\u4f9b\u64cd\u4f5c\u63a5\u53e3\u51fd\u6570\uff0c\u5141\u8bb8\u4e00\u4e2aspi master\uff0cspi driver\u548cspi device\u521d\u59cb\u5316\u65f6\u5728SPI Core\u4e2d\u8fdb\u884c\u6ce8\u518c\uff0c\u4ee5\u53ca\u9000\u51fa\u65f6\u8fdb\u884c\u6ce8\u9500\u3002"}),"\n",(0,r.jsx)(n.h5,{id:"spi\u8bbe\u5907\u9a71\u52a8\u5c42spi-device-driver",children:"SPI\u8bbe\u5907\u9a71\u52a8\u5c42\uff08SPI Device Driver\uff09"}),"\n",(0,r.jsx)(n.p,{children:"SPI Driver\u662f\u5bf9\u5e94\u4e8espi\u8bbe\u5907\u7aef\u7684\u9a71\u52a8\u7a0b\u5e8f\uff0c\u901a\u8fc7\u63a5\u53e3\u51fd\u6570\u5411SPI Core\u8fdb\u884c\u6ce8\u518c\uff0cSPI Driver\u7684\u4f5c\u7528\u662f\u5c06spi\u8bbe\u5907\u6302\u63a5\u5230spi\u603b\u7ebf\u4e0a\u3002"}),"\n",(0,r.jsx)(n.h5,{id:"spi\u63a7\u5236\u5668\u9a71\u52a8\u5c42spi-master-driver",children:"SPI\u63a7\u5236\u5668\u9a71\u52a8\u5c42\uff08SPI Master Driver\uff09"}),"\n",(0,r.jsx)(n.p,{children:"SPI Master\u9488\u5bf9\u4e0d\u540c\u7c7b\u578b\u7684spi\u63a7\u5236\u5668\u786c\u4ef6\uff0c\u5b9e\u73b0spi\u603b\u7ebf\u7684\u786c\u4ef6\u8bbf\u95ee\u64cd\u4f5c\u3002SPI Master\u901a\u8fc7\u63a5\u53e3\u51fd\u6570\u5411SPI Core\u6ce8\u518c\u4e00\u4e2a\u63a7\u5236\u5668\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"\u786c\u4ef6",children:"\u786c\u4ef6"}),"\n",(0,r.jsx)(n.p,{children:"\u8fd9\u4e00\u5c42\u662f\u5b9e\u9645\u7684\u7269\u7406\u5668\u4ef6\uff0c\u5176\u4e2d\u5305\u62ec\u6211\u4eec\u7684spi\u63a7\u5236\u5668\u4ee5\u53ca\u4e0e\u63a7\u5236\u5668\u76f8\u8fde\u7684\u5404\u4e2aspi\u5b50\u8bbe\u5907\uff0c\u901a\u8fc7spi\u603b\u7ebf\u80fd\u591f\u4e0ecpu\u8fdb\u884c\u6570\u636e\u7684\u4ea4\u4e92\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u9a71\u52a8\u6846\u67b6",children:"\u9a71\u52a8\u6846\u67b6"}),"\n",(0,r.jsx)(n.p,{children:"\u6839\u636eSPI\u63a7\u5236\u5668\u96c6\u6210\u4e86BYTE/BIT/DBI\u4e09\u4e2aIP\u7684\u7279\u6027\uff0c\u5c06\u9a71\u52a8\u52063\u4e2aIP\u57df\u548c5\u4e2a\u529f\u80fd\u903b\u8f91\u5757\uff1a"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"master/slave/flash/dbi/bit"}),"\u3002\u5176\u4e2dBIT/DBI\u4e3a\u4e00\u4e00\u5bf9\u5e94\u5173\u7cfb\uff0cBYTE\u5219\u5bf9\u5e94Master/Flash/Slave\u4e09\u4e2a\u4e0d\u540c\u529f\u80fd\u903b\u8f91\u5757\u3002"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240330104541071",src:s(14236).Z+"",width:"487",height:"312"})}),"\n",(0,r.jsx)(n.h4,{id:"master",children:"Master"}),"\n",(0,r.jsx)(n.p,{children:"\u8be5\u6a21\u5f0f\u5c5e\u4e8eBYTE\u6a21\u5f0f\u7684\u4e00\u79cd\uff0c\u6570\u636e\u7684\u6700\u5c0f\u5355\u4f4d\u4e3aBYTE\uff0c\u5373\u4e00\u6b21\u53d1\u9001\u4f1a\u4ea7\u751f8\u4e2aCLK\u5c06\u4e00\u4e2aByte\u6570\u636e\u5168\u90e8\u53d1\u9001\u51fa\u53bb\u3002\u652f\u6301Single/Dual/Quad\u4e09\u79cd\u6a21\u5f0f\uff0c\u5e38\u89c1\u7684\u4f7f\u7528\u5e38\u89c1\u4e3a\u901a\u7528SPI\u5916\u8bbe\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"flash",children:"Flash"}),"\n",(0,r.jsx)(n.p,{children:"\u8be5\u6a21\u5f0f\u5c5e\u4e8eBYTE\u6a21\u5f0f\u7684\u4e00\u79cd\uff0c\u4f46\u9a71\u52a8\u4e13\u95e8\u9488\u5bf9Nor/Nand Flash\u4f20\u8f93\u8fc7\u7a0b\u505a\u4e86\u4f18\u5316\uff0c\u5f53\u5916\u8bbe\u8fde\u63a5\u7684\u662fFlash\u7684\u60c5\u51b5\u4e0b\uff0c\u53ef\u4ee5\u63d0\u9ad8\u8bfb\u5199\u6027\u80fd\u3002\u652f\u63011-1-1\uff0c1-1-2\uff0c1-1-4\u4e09\u79cdSPI-Flash\u6a21\u5f0f\u3002\u53ea\u80fd\u4f7f\u7528\u4e8eSPI-Flash\u5916\u8bbe\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"slave",children:"Slave"}),"\n",(0,r.jsx)(n.p,{children:"\u8be5\u6a21\u5f0f\u5c5e\u4e8eBYTE\u6a21\u5f0f\u7684\u4e00\u79cd\uff0c\u4f46\u6b64\u65f6\u63a7\u5236\u5668\u5904\u4e8e\u4ece\u673a\u6a21\u5f0f\u4e0b\uff0c\u7b49\u5f85\u5176\u4ed6Master\u7684\u8bbf\u95ee\uff0c\u5728\u8be5\u6a21\u5f0f\u4e0b\u4ec5\u652f\u6301\u4f7f\u7528Single Mode\u8fdb\u884c\u6570\u636e\u4f20\u8f93\u3002\r\n\u9488\u5bf9\u6570\u636e\u540c\u6b65\u7684\u95ee\u9898\uff0c\u589e\u52a0ready\u811a\u7684sync\u673a\u5236\uff0c\u8be5\u673a\u5236\u4e3a\u7eaf\u8f6f\u4ef6\u903b\u8f91\uff0c\u9700\u8981\u5bf9\u65b9\u7684Master\u7aef\u7684\u9002\u914d\u652f\u6301\uff0c\u624d\u80fd\u6b63\u5e38\u4f7f\u7528\u3002\u82e5\u4e0d\u7528ready\u540c\u6b65\u673a\u5236\uff0c\u5219\u9700\u8981\u4e0a\u5c42\u5e94\u7528\u5728\u4f20\u8f93\u65f6\u8fdb\u884c\u76f8\u5e94\u7684delay\u7b49\u5f85\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"dbi",children:"DBI"}),"\n",(0,r.jsx)(n.p,{children:"\u8be5\u6a21\u5f0f\u4e13\u95e8\u9488\u5bf9SPI\u663e\u793a\u5916\u8bbe\u8bbe\u8ba1\uff0c\u4f7f\u7528DBI\u534f\u8bae\u3002\u652f\u63013\u7ebf\u6216\u56db\u7ebf\u4f20\u8f93\uff0c\u4e14\u540c\u65f6\u517c\u5bb9\u591a\u79cd\u89c6\u9891\u6570\u636e\u683c\u5f0f\u3002"}),"\n",(0,r.jsx)(n.h4,{id:"bit",children:"BIT"}),"\n",(0,r.jsx)(n.p,{children:"\u8be5\u6a21\u5f0f\u4e13\u95e8\u9488\u5bf9\u7279\u6b8a\u5916\u8bbe\u8bbe\u8ba1\uff0c\u6570\u636e\u7684\u6700\u5c0f\u5355\u4f4d\u4e3aBIT\uff0c\u5373\u53ef\u4ee5\u5c06\u6570\u636e\u5206\u6210\u5355\u4e2aBit\u5728MOSI/MISO\u4e0a\u8fdb\u884c\u53d1\u9001\u6216\u63a5\u53d7\uff0c\u4e00\u4e2aCLK\u5bf9\u5e94\u4e00\u4e2abit\uff0c\u957f\u5ea6\u4e3a0~32\u53ef\u7f16\u7a0b\u3002\u5e38\u89c1\u7684\u4f7f\u7528\u573a\u666f\u4e3a3Wire\u6a21\u5f0f\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e",children:"\u6a21\u5757\u63a5\u53e3\u8bf4\u660e"}),"\n",(0,r.jsx)(n.h4,{id:"\u8bbe\u5907\u6ce8\u518c\u63a5\u53e3",children:"\u8bbe\u5907\u6ce8\u518c\u63a5\u53e3"}),"\n",(0,r.jsxs)(n.p,{children:["\u5728 Linux \u5185\u6838\u4e2d\uff0c",(0,r.jsx)(n.code,{children:"spi_register_driver"})," \u548c ",(0,r.jsx)(n.code,{children:"spi_unregister_driver"})," \u662f\u7528\u4e8e\u6ce8\u518c\u548c\u6ce8\u9500 SPI \u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u7684\u51fd\u6570\u3002\u4ee5\u4e0b\u662f\u5b83\u4eec\u7684\u7b80\u8981\u7528\u6cd5\uff1a"]}),"\n",(0,r.jsx)(n.h5,{id:"spi_register_driver",children:"spi_register_driver"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"int spi_register_driver(struct spi_driver *sdrv);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u529f\u80fd"}),"\uff1a\u6ce8\u518c\u4e00\u4e2a SPI \u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sdrv"}),"\uff1a\u6307\u5411\u8981\u6ce8\u518c\u7684 ",(0,r.jsx)(n.code,{children:"struct spi_driver"})," \u7ed3\u6784\u4f53\u7684\u6307\u9488\uff0c\u5305\u542b\u4e86\u9a71\u52a8\u7a0b\u5e8f\u7684\u5404\u79cd\u56de\u8c03\u51fd\u6570\u548c\u4fe1\u606f\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a\u6210\u529f\u6ce8\u518c\u8fd4\u56de 0\uff0c\u5931\u8d25\u8fd4\u56de\u8d1f\u6570\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h5,{id:"spi_unregister_driver",children:"spi_unregister_driver"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"void spi_unregister_driver(struct spi_driver *sdrv);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u529f\u80fd"}),"\uff1a\u6ce8\u9500\u4e4b\u524d\u6ce8\u518c\u7684 SPI \u8bbe\u5907\u9a71\u52a8\u7a0b\u5e8f\u3002"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sdrv"}),"\uff1a\u6307\u5411\u5df2\u6ce8\u518c\u7684 ",(0,r.jsx)(n.code,{children:"struct spi_driver"})," \u7ed3\u6784\u4f53\u7684\u6307\u9488\u3002"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a\u65e0\u3002"]}),"\n"]}),"\n",(0,r.jsx)(n.h5,{id:"\u4f7f\u7528\u793a\u4f8b",children:"\u4f7f\u7528\u793a\u4f8b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'static int my_spi_probe(struct spi_device *spi) {\r\n    // \u5728\u6b64\u5904\u5904\u7406 SPI \u8bbe\u5907\u7684\u521d\u59cb\u5316\u7b49\u64cd\u4f5c\r\n    return 0;\r\n}\r\n\r\nstatic int my_spi_remove(struct spi_device *spi) {\r\n    // \u5728\u6b64\u5904\u5904\u7406 SPI \u8bbe\u5907\u7684\u79fb\u9664\u7b49\u64cd\u4f5c\r\n    return 0;\r\n}\r\n\r\nstatic struct spi_driver my_spi_driver = {\r\n    .driver = {\r\n        .name = "my_spi_device",\r\n        .owner = THIS_MODULE,\r\n    },\r\n    .probe = my_spi_probe,\r\n    .remove = my_spi_remove,\r\n};\r\n\r\nstatic int __init my_spi_init(void) {\r\n    return spi_register_driver(&my_spi_driver);\r\n}\r\n\r\nstatic void __exit my_spi_exit(void) {\r\n    spi_unregister_driver(&my_spi_driver);\r\n}\r\n\r\nmodule_init(my_spi_init);\r\nmodule_exit(my_spi_exit);\r\n\r\nMODULE_LICENSE("GPL");\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u5728\u4e0a\u9762\u7684\u793a\u4f8b\u4e2d\uff0c\u9996\u5148\u5b9a\u4e49\u4e86\u4e00\u4e2a ",(0,r.jsx)(n.code,{children:"struct spi_driver"})," \u7ed3\u6784\u4f53 ",(0,r.jsx)(n.code,{children:"my_spi_driver"}),"\uff0c\u5305\u542b\u4e86\u9a71\u52a8\u7a0b\u5e8f\u7684\u540d\u79f0\u3001probe \u51fd\u6570\u548c remove \u51fd\u6570\u3002\u7136\u540e\u5728\u6a21\u5757\u521d\u59cb\u5316\u51fd\u6570\u4e2d\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"spi_register_driver"})," \u6ce8\u518c\u8be5\u9a71\u52a8\u7a0b\u5e8f\uff0c\u5728\u6a21\u5757\u9000\u51fa\u51fd\u6570\u4e2d\u8c03\u7528 ",(0,r.jsx)(n.code,{children:"spi_unregister_driver"})," \u6ce8\u9500\u8be5\u9a71\u52a8\u7a0b\u5e8f\u3002"]}),"\n",(0,r.jsx)(n.h4,{id:"\u6570\u636e\u4f20\u8f93\u63a5\u53e3",children:"\u6570\u636e\u4f20\u8f93\u63a5\u53e3"}),"\n",(0,r.jsxs)(n.p,{children:["SPI \u8bbe\u5907\u9a71\u52a8\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"struct spi_message"})," \u5411SPI\u603b\u7ebf\u8bf7\u6c42\u8bfb\u5199I/O\u3002\u4e00\u4e2a ",(0,r.jsx)(n.code,{children:"spi_message"})," \u4e2d\u5305\u542b\u4e86\u4e00\u4e2a\u64cd\u4f5c\u5e8f\u5217\uff0c\u6bcf\u4e00\u4e2a\u64cd\u4f5c\u79f0\u4f5c ",(0,r.jsx)(n.code,{children:"spi_transfer"}),"\uff0c\u8fd9\u6837\u65b9\u4fbfSPI\u603b\u7ebf\u9a71\u52a8\u4e2d\u4e32\u884c\u7684\u6267\u884c\u4e00\u4e2a\u4e2a\u539f\u5b50\u7684\u5e8f\u5217\u3002\u5185\u6838\u7ebf\u7a0b\u4f7f\u7528\u961f\u5217\u5b9e\u73b0\u4e86\u5f02\u6b65\u4f20\u8f93\u7684\u529f\u80fd\uff0c\u5bf9\u4e8e\u540c\u4e00\u4e2a\u6570\u636e\u4f20\u8f93\u7684\u53d1\u8d77\u8005\uff0c\u65e2\u7136\u5f02\u6b65\u65b9\u5f0f\u65e0\u9700\u7b49\u5f85\u6570\u636e\u4f20\u8f93\u5b8c\u6210\u5373\u53ef\u8fd4\u56de\uff0c\u8fd4\u56de\u540e\uff0c\u8be5\u53d1\u8d77\u8005\u53ef\u4ee5\u7acb\u523b\u53c8\u53d1\u8d77\u4e00\u4e2amessage\uff0c\u800c\u8fd9\u65f6\u4e0a\u4e00\u4e2amessage\u8fd8\u6ca1\u6709\u5904\u7406\u5b8c\u3002 \u5bf9\u4e8e\u53e6\u5916\u4e00\u4e2a\u4e0d\u540c\u7684\u53d1\u8d77\u8005\u6765\u8bf4\uff0c\u4e5f\u6709\u53ef\u80fd\u540c\u65f6\u53d1\u8d77\u4e00\u6b21message\u4f20\u8f93\u8bf7\u6c42\u3002"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"struct spi_transfer {\r\n\tconst void\t*tx_buf;\r\n\tvoid\t\t*rx_buf;\r\n\tunsigned\tlen;\r\n\r\n\tdma_addr_t\ttx_dma;\r\n\tdma_addr_t\trx_dma;\r\n\r\n\tunsigned\tcs_change:1;\r\n\tu8\t\tbits_per_word;\r\n\tu16\t\tdelay_usecs;\r\n\tu32\t\tspeed_hz;\r\n\r\n\tstruct list_head transfer_list;\r\n};\r\n\r\nstruct spi_message {\r\n\tstruct list_head\ttransfers;\r\n\tstruct spi_device\t*spi;\r\n\tunsigned\t\tis_dma_mapped:1;\r\n\tvoid\t\t\t(*complete)(void *context);\r\n\tvoid\t\t\t*context;\r\n\tunsigned\t\tactual_length;\r\n\tint\t\t\tstatus;\r\n\tstruct list_head\tqueue;\r\n\tvoid\t\t\t*state;\r\n};\n"})}),"\n",(0,r.jsx)(n.h5,{id:"spi_message_init",children:"spi_message_init"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"void spi_message_init(struct spi_message *msg);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u529f\u80fd"}),"\uff1a\u521d\u59cb\u5316spi_message\u7ed3\u6784\u4f53"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"msg"}),"\uff1a\u6307\u5411\u8981\u521d\u59cb\u5316\u7684spi_message\u7ed3\u6784\u4f53\u7684\u6307\u9488"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a\u65e0"]}),"\n"]}),"\n",(0,r.jsx)(n.h5,{id:"spi_message_add_tail",children:"spi_message_add_tail"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"void spi_message_add_tail(struct spi_transfer *t, struct spi_message *m);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u529f\u80fd"}),"\uff1a\u5c06\u4e00\u4e2aspi_transfer\u7ed3\u6784\u4f53\u6dfb\u52a0\u5230spi_message\u7684\u672b\u5c3e"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"t"}),"\uff1a\u6307\u5411\u8981\u6dfb\u52a0\u7684spi_transfer\u7ed3\u6784\u4f53\u7684\u6307\u9488"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"m"}),"\uff1a\u6307\u5411\u76ee\u6807spi_message\u7ed3\u6784\u4f53\u7684\u6307\u9488"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a\u65e0"]}),"\n"]}),"\n",(0,r.jsx)(n.h5,{id:"spi_sync",children:"spi_sync"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"int spi_sync(struct spi_device *spi, struct spi_message *message);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u529f\u80fd"}),"\uff1a\u540c\u6b65\u53d1\u9001\u5e76\u63a5\u6536SPI\u6d88\u606f"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"spi"}),"\uff1a\u6307\u5411\u5bf9\u5e94SPI\u8bbe\u5907\u7684spi_device\u7ed3\u6784\u4f53\u7684\u6307\u9488"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"message"}),"\uff1a\u6307\u5411\u8981\u53d1\u9001\u7684spi_message\u7ed3\u6784\u4f53\u7684\u6307\u9488"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a\u6210\u529f\u8fd4\u56de0\uff0c\u5931\u8d25\u8fd4\u56de\u8d1f\u6570\u9519\u8bef\u7801"]}),"\n"]}),"\n",(0,r.jsx)(n.h5,{id:"spi_async",children:"spi_async"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"int spi_async(struct spi_device *spi, struct spi_message *message);\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u529f\u80fd"}),"\uff1a\u5f02\u6b65\u53d1\u9001\u5e76\u63a5\u6536SPI\u6d88\u606f"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"spi"}),"\uff1a\u6307\u5411\u5bf9\u5e94SPI\u8bbe\u5907\u7684spi_device\u7ed3\u6784\u4f53\u7684\u6307\u9488"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"message"}),"\uff1a\u6307\u5411\u8981\u53d1\u9001\u7684spi_message\u7ed3\u6784\u4f53\u7684\u6307\u9488"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a\u6210\u529f\u8fd4\u56de0\uff0c\u5931\u8d25\u8fd4\u56de\u8d1f\u6570\u9519\u8bef\u7801"]}),"\n"]}),"\n",(0,r.jsx)(n.h5,{id:"spi_slave_abort",children:"spi_slave_abort"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"int spi_slave_abort(struct spi_device \\*spi)\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u529f\u80fd"}),"\uff1a\u4e2d\u6b62\u5f53\u524d\u6b63\u5728\u8fdb\u884c\u7684SPI\u4f20\u8f93"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u53c2\u6570"}),"\uff1a","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"spi"}),"\uff1a\u6307\u5411\u5bf9\u5e94SPI\u8bbe\u5907\u7684spi_device\u7ed3\u6784\u4f53\u7684\u6307\u9488"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"\u8fd4\u56de\u503c"}),"\uff1a\u6210\u529f\u8fd4\u56de0\uff0c\u5931\u8d25\u8fd4\u56de\u8d1f\u6570\u9519\u8bef\u7801"]}),"\n"]}),"\n",(0,r.jsx)(n.h5,{id:"\u4f7f\u7528\u793a\u4f8b-1",children:"\u4f7f\u7528\u793a\u4f8b"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"#include <linux/spi/spi.h>\r\n\r\nvoid spi_example_usage(struct spi_device *spi) {\r\n    struct spi_message message;\r\n    struct spi_transfer xfer;\r\n    u8 tx_buf[4] = {0xAA, 0xBB, 0xCC, 0xDD};\r\n    u8 rx_buf[4];\r\n\r\n    // \u521d\u59cb\u5316spi_message\r\n    spi_message_init(&message);\r\n\r\n    // \u914d\u7f6espi_transfer\r\n    memset(&xfer, 0, sizeof(struct spi_transfer));\r\n    xfer.tx_buf = tx_buf;\r\n    xfer.rx_buf = rx_buf;\r\n    xfer.len = sizeof(tx_buf);\r\n\r\n    // \u6dfb\u52a0spi_transfer\u5230spi_message\r\n    spi_message_add_tail(&message, &xfer);\r\n\r\n    // \u540c\u6b65\u6267\u884cspi_message\r\n    int ret_sync = spi_sync(spi, &message);\r\n    if (ret_sync == 0) {\r\n        // SPI\u6d88\u606f\u6210\u529f\u53d1\u9001\u5e76\u63a5\u6536\u5b8c\u6210\r\n        // \u5904\u7406\u63a5\u6536\u5230\u7684\u6570\u636e\r\n    } else {\r\n        // \u53d1\u9001\u6216\u63a5\u6536\u5931\u8d25\r\n        // \u5904\u7406\u9519\u8bef\u60c5\u51b5\r\n    }\r\n\r\n    // \u5f02\u6b65\u6267\u884cspi_message\r\n    int ret_async = spi_async(spi, &message);\r\n    if (ret_async == 0) {\r\n        // \u5f02\u6b65\u53d1\u9001\u6210\u529f\r\n        // \u4e0d\u7b49\u5f85\u4f20\u8f93\u5b8c\u6210\uff0c\u5728\u5f02\u6b65\u4f20\u8f93\u5b8c\u6210\u65f6\u4f1a\u8c03\u7528\u56de\u8c03\u51fd\u6570\u5904\u7406\u6570\u636e\r\n    } else {\r\n        // \u5f02\u6b65\u53d1\u9001\u5931\u8d25\r\n        // \u5904\u7406\u9519\u8bef\u60c5\u51b5\r\n    }\r\n\r\n    // \u53d6\u6d88\u5f53\u524dSPI\u4ece\u8bbe\u5907\u7684\u4f20\u8f93\u64cd\u4f5c\r\n    int ret_abort = spi_slave_abort(spi);\r\n    if (ret_abort == 0) {\r\n        // \u53d6\u6d88\u6210\u529f\r\n    } else {\r\n        // \u53d6\u6d88\u5931\u8d25\r\n        // \u5904\u7406\u9519\u8bef\u60c5\u51b5\r\n    }\r\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"\u4f7f\u7528\u8303\u4f8b",children:"\u4f7f\u7528\u8303\u4f8b"}),"\n",(0,r.jsx)(n.h3,{id:"master-\u6a21\u5f0f",children:"Master \u6a21\u5f0f"}),"\n",(0,r.jsx)(n.p,{children:"\u5728 Master \u6a21\u5f0f\u4e0b\uff0c\u4e00\u822c\u4f7f\u7528 spidev \u4f5c\u4e3a\u9a71\u52a8"}),"\n",(0,r.jsx)(n.p,{children:"\u5728 menuconfig \u4e2d\u6253\u5f00 SPIDEV"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"CONFIG_SPI_SPIDEV\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u8bbe\u5907\u6811\u4e2d\u589e\u52a0 SPI DEV \u8bbe\u5907"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'&spi1 {\r\n\tsunxi,spi-bus-mode = <SUNXI_SPI_BUS_MASTER>;\r\n\tsunxi,spi-cs-mode = <SUNXI_SPI_CS_AUTO>;\r\n\tstatus = "okay";\r\n\r\n\tspidev0 {\r\n\t\tcompatible = "rohm,dh2228fv";\r\n\t\treg = <0x0>;\r\n\t\tspi-max-frequency = <100000000>;\r\n\t\tspi-rx-bus-width = <0x1>;\r\n\t\tspi-tx-bus-width = <0x1>;\r\n\t\tstatus = "okay";\r\n\t};\r\n};\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u6d4b\u8bd5",children:"\u6d4b\u8bd5"}),"\n",(0,r.jsxs)(n.p,{children:["\u4e3a\u4e86\u6d4b\u8bd5 SPI DEV\uff0c\u8fd9\u91cc\u4f7f\u7528\u7684\u662f ",(0,r.jsx)(n.code,{children:"spidev_test"}),"\uff0c\u786c\u4ef6\u4e0a\u4f7f\u7528\u56de\u73af\u81ea\u53d1\u81ea\u6536\u8fdb\u884c\u6d4b\u8bd5\uff0c\u9700\u5c06SPI\u7684 ",(0,r.jsx)(n.code,{children:"MOSI/MISO"})," \u5f15\u811a\u77ed\u63a5"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'# spidev_test -h\r\nUsage: spidev_test [-DsbdlHOLC3vpNR24SI]\r\n  -D --device   device to use (default /dev/spidev1.1)\r\n  -s --speed    max speed (Hz)\r\n  -d --delay    delay (usec)\r\n  -b --bpw      bits per word\r\n  -i --input    input data from a file (e.g. "test.bin")\r\n  -o --output   output data to a file (e.g. "results.bin")\r\n  -l --loop     loopback\r\n  -H --cpha     clock phase\r\n  -O --cpol     clock polarity\r\n  -L --lsb      least significant bit first\r\n  -C --cs-high  chip select active high\r\n  -3 --3wire    SI/SO signals shared\r\n  -v --verbose  Verbose (show tx buffer)\r\n  -p            Send data (e.g. "1234\\xde\\xad")\r\n  -N --no-cs    no chip select\r\n  -R --ready    slave pulls low to pause\r\n  -2 --dual     dual transfer\r\n  -4 --quad     quad transfer\r\n  -S --size     transfer size\r\n  -I --iter     iterations\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CPU\u6a21\u5f0f\u6536\u53d1\u6d4b\u8bd5"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4f4e\u4e8eFIFO\u5927\u5c0f\u6570\u636e\u91cf\u7684\u4f20\u8f93\uff0c\u5c06\u4f1a\u4f7f\u7528CPU\u8fdb\u884c\u642c\u8fd0"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# spidev-test -D /dev/spidev3.0 -s 100000000 -S 32 -I 1 -v\r\nspi mode: 0x0\r\nbits per word: 8\r\nmax speed: 100000000 Hz (100000 kHz)\r\nTX | 52 5D 4D 8A 1A A3 56 DA DF D1 1E 26 9A 41 01 84 0B 4C FC F0 12 F7 34 87 D2 F7 7E 11 DC 35 45 2F  |R]M...V....&.A...L....4...~..5E/|\r\nRX | 52 5D 4D 8A 1A A3 56 DA DF D1 1E 26 9A 41 01 84 0B 4C FC F0 12 F7 34 87 D2 F7 7E 11 DC 35 45 2F  |R]M...V....&.A...L....4...~..5E/|\r\ntotal size   : 32 B\r\ntotal time   : 55.33 us\r\naverange rate: 0.55 MB/s\r\naverange time: 55.33 us\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"DMA\u6a21\u5f0f\u6536\u53d1\u6d4b\u8bd5"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u8d85\u8fc7FIFO\u5927\u5c0f\u6570\u636e\u91cf\u7684\u4f20\u8f93\uff0c\u5c06\u4f1a\u4f7f\u7528DMA\u8fdb\u884c\u642c\u8fd0"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# spidev-test -D /dev/spidev3.0 -s 10000000 -S 1024 -I 1\r\nspi mode: 0x0\r\nbits per word: 8\r\nmax speed: 10000000 Hz (10000 kHz)\r\ntotal size   : 1.00 KB\r\ntotal time   : 985.00 us\r\naverange rate: 0.99 MB/s\r\naverange time: 985.00 us\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6027\u80fd\u6d4b\u8bd5"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# spidev-test -D /dev/spidev3.0 -s 100000000 -S 4096 -I 1024\r\nspi mode: 0x0\r\nbits per word: 8\r\nmax speed: 100000000 Hz (100000 kHz)\r\ntotal size   : 4.00 MB\r\ntotal time   : 391.14 ms\r\naverange rate: 10.23 MB/s\r\naverange time: 381.97 us\n"})}),"\n",(0,r.jsx)(n.p,{children:"100MHz\u4e0b\u7684\u7406\u8bba\u503c\u4e3a12.5MB/s\uff0c\u5f53\u524dMaster\u9a71\u52a8\u80fd\u8fbe\u523081.84%\u7684\u6027\u80fd"}),"\n",(0,r.jsx)(n.h4,{id:"\u793a\u4f8b\u4ee3\u7801",children:"\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'#include <stdio.h>\r\n#include <stdlib.h>\r\n#include <string.h>\r\n#include <fcntl.h>\r\n#include <unistd.h>\r\n#include <sys/ioctl.h>\r\n#include <linux/spi/spidev.h>\r\n\r\n#define SPI_DEVICE "/dev/spidev0.0"\r\n#define MODE_SPI_MODE_0 (0 | 0)\r\n#define BITS_PER_WORD 8\r\n#define SPEED_HZ 1000000\r\n\r\nint main()\r\n{\r\n    int fd;\r\n    int ret;\r\n    struct spi_ioc_transfer tr = {\r\n        .tx_buf = (unsigned long)NULL,\r\n        .rx_buf = (unsigned long)NULL,\r\n        .len = 4,\r\n        .speed_hz = SPEED_HZ,\r\n        .delay_usecs = 0,\r\n        .bits_per_word = BITS_PER_WORD,\r\n    };\r\n    unsigned char tx_buf[4] = {0xAA, 0xBB, 0xCC, 0xDD};\r\n    unsigned char rx_buf[4];\r\n\r\n    // \u6253\u5f00SPI\u8bbe\u5907\u6587\u4ef6\r\n    fd = open(SPI_DEVICE, O_RDWR);\r\n    if (fd < 0) {\r\n        perror("Error opening SPI device");\r\n        return -1;\r\n    }\r\n\r\n    // \u8bbe\u7f6eSPI\u6a21\u5f0f\u3001\u4f4d\u6570\u548c\u901f\u5ea6\r\n    ret = ioctl(fd, SPI_IOC_WR_MODE, &MODE_SPI_MODE_0);\r\n    if (ret == -1) {\r\n        perror("Error setting SPI mode");\r\n        close(fd);\r\n        return -1;\r\n    }\r\n\r\n    // \u8bbe\u7f6e\u4f20\u8f93\u53c2\u6570\r\n    tr.tx_buf = (unsigned long)tx_buf;\r\n    tr.rx_buf = (unsigned long)rx_buf;\r\n\r\n    // \u53d1\u9001\u548c\u63a5\u6536\u6570\u636e\r\n    ret = ioctl(fd, SPI_IOC_MESSAGE(1), &tr);\r\n    if (ret < 1) {\r\n        perror("Error during SPI transfer");\r\n        close(fd);\r\n        return -1;\r\n    }\r\n\r\n    // \u6253\u5370\u63a5\u6536\u5230\u7684\u6570\u636e\r\n    printf("Received data: 0x%02X 0x%02X 0x%02X 0x%02X\\n", rx_buf[0], rx_buf[1], rx_buf[2], rx_buf[3]);\r\n\r\n    // \u5173\u95edSPI\u8bbe\u5907\u6587\u4ef6\r\n    close(fd);\r\n\r\n    return 0;\r\n}\n'})}),"\n",(0,r.jsx)(n.h3,{id:"slave-\u6a21\u5f0f",children:"Slave \u6a21\u5f0f"}),"\n",(0,r.jsxs)(n.p,{children:["\u786c\u4ef6\u4e0a\u5c06 ",(0,r.jsx)(n.code,{children:"Master"})," \u7684 ",(0,r.jsx)(n.code,{children:"CS/CLK/MISO/MOSI"})," \u4e0e ",(0,r.jsx)(n.code,{children:"Slave"})," \u7684 ",(0,r.jsx)(n.code,{children:"CS/CLK/MISO/MOSI"})," \u6309\u987a\u5e8f\u4f9d\u6b21\u8fde\u63a5\u3002\u6ce8\u610fMaster\u7684MOSI\u63a5Slave\u7684MOSI\uff0cMaster\u7684MISO\u63a5Slave\u7684MISO\uff0c\u5982\u679c\u63a5\u9519\u4f1a\u5bfc\u81f4\u6570\u636e\u6536\u53d1\u5f02\u5e38\u3002"]}),"\n",(0,r.jsx)(n.p,{children:"\u7136\u540e\u6253\u5f00\u914d\u7f6e"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"CONFIG_AW_SPI_SLAVETEST\n"})}),"\n",(0,r.jsx)(n.p,{children:"\u914d\u7f6e Slave \u8bbe\u5907\u6811"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'&spi2 {\r\n\tclock-frequency = <10000000>;\r\n\tpinctrl-names = "default", "sleep";\r\n\tsunxi,spi-bus-mode = <SUNXI_SPI_BUS_SLAVE>;\r\n\tsunxi,spi-cs-mode = <SUNXI_SPI_CS_AUTO>;\r\n\tstatus = "okay";\r\n\r\n\tslave {\r\n\t\tcompatible = "sunxi,spislave";\r\n\t\treg = <0x0>;\r\n\t\tspi-max-frequency = <10000000>;\r\n\t\tslave-cachesize = <4096>;\r\n\t\tstatus = "okay";\r\n\t};\r\n};\n'})}),"\n",(0,r.jsx)(n.p,{children:"\u540c\u65f6\u914d\u7f6e\u6d4b\u8bd5\u4f7f\u7528\u7684 Master \u8bbe\u5907\u6811"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'&spi1 {\r\n\tsunxi,spi-bus-mode = <SUNXI_SPI_BUS_MASTER>;\r\n\tsunxi,spi-cs-mode = <SUNXI_SPI_CS_AUTO>;\r\n\tstatus = "okay";\r\n\r\n\tspidev0 {\r\n\t\tcompatible = "rohm,dh2228fv";\r\n\t\treg = <0x0>;\r\n\t\tspi-max-frequency = <100000000>;\r\n\t\tspi-rx-bus-width = <0x1>;\r\n\t\tspi-tx-bus-width = <0x1>;\r\n\t\tstatus = "okay";\r\n\t};\r\n};\n'})}),"\n",(0,r.jsxs)(n.p,{children:["\u82e5\u8981\u4f7f\u7528 ",(0,r.jsx)(n.code,{children:"Ready"})," \u540c\u6b65\u529f\u80fd\uff0c\u9700\u8981\u5728 ",(0,r.jsx)(n.code,{children:"Master/Slave"})," \u4e24\u8fb9\u6dfb\u52a0\u7528\u4e8e\u540c\u6b65\u7684\u5f15\u811a\uff0c\u914d\u7f6e\u5982\u4e0b\uff1a"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Master"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'&spi1 {\r\n\tsunxi,spi-bus-mode = <SUNXI_SPI_BUS_MASTER>;\r\n\tready-gpio = <&pio PC 15 GPIO_ACTIVE_LOW>;\r\n\tsunxi,spi-cs-mode = <SUNXI_SPI_CS_AUTO>;\r\n\tstatus = "okay";\r\n\r\n\tspidev0 {\r\n\t\tcompatible = "rohm,dh2228fv";\r\n\t\treg = <0x0>;\r\n\t\tspi-max-frequency = <100000000>;\r\n\t\tspi-rx-bus-width = <0x1>;\r\n\t\tspi-tx-bus-width = <0x1>;\r\n\t\tstatus = "okay";\r\n\t};\r\n};\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Slave"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'&spi2 {\r\n\tclock-frequency = <10000000>;\r\n\tpinctrl-names = "default", "sleep";\r\n\tsunxi,spi-bus-mode = <SUNXI_SPI_BUS_SLAVE>;\r\n\tready-gpio = <&pio PC 15 GPIO_ACTIVE_LOW>;\r\n\tsunxi,spi-cs-mode = <SUNXI_SPI_CS_AUTO>;\r\n\tstatus = "okay";\r\n\r\n\tslave {\r\n\t\tcompatible = "sunxi,spislave";\r\n\t\treg = <0x0>;\r\n\t\tspi-max-frequency = <10000000>;\r\n\t\tslave-cachesize = <4096>;\r\n\t\tstatus = "okay";\r\n\t};\r\n};\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u6d4b\u8bd5-1",children:"\u6d4b\u8bd5"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u52a0\u8f7dSlave\u8bbe\u5907\u9a71\u52a8"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# insmod spi-sunxi-slave-test.ko\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Slave\u6d4b\u8bd5\u5de5\u5177\u4f7f\u7528\u65b9\u6cd5"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# spislave-test -h\r\nUsage: ./spislave-test [-DsbdlHOLC3vpNR24SI]\r\n  -D --device   device to use (default /dev/spidev1.1)\r\n  -s --speed    max speed (Hz)\r\n  -H --cpha     clock phase\r\n  -O --cpol     clock polarity\r\n  -L --lsb      least significant bit first\r\n  -C --cs-high  chip select active high\r\n  -R --ready    slave pulls low to pause\r\n  -v --verbose  Verbose (show tx buffer)\r\n  -a --addr     operation address\r\n  -S --size     transfer size\r\n  -I --iter     iterations\r\n  -d --delay    delay time between package\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CPU\u6a21\u5f0f\u6536\u53d1\u6d4b\u8bd5"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u82e5\u4f7f\u7528 ready \u5f15\u811a\u540c\u6b65\u65b9\u6848\u5219\u52a0\u4e0a-R\u53c2\u6570\uff0c\u5426\u5219\u4f7f\u7528-d\u53c2\u6570\u6307\u5b9a\u9700\u8981master\u9700\u8981\u4e3b\u52a8\u7b49\u5f85\u7684\u65f6\u95f4\uff0c\u5207\u8bb0\u4e8c\u8005\u4e0d\u53ef\u540c\u65f6\u4f7f\u7528"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'# ./spislave-test -D /dev/spidev3.0 -a 0 -S 32 -I 1 -R -v # ready\u540c\u6b65\u6a21\u5f0f\r\n# ./spislave-test -D /dev/spidev3.0 -a 0 -S 32 -I 1 -d 5000 -v # delay\u7b49\u5f85\u6a21\u5f0f\r\nspi mode: 0x80\r\nmax speed: 10000000 Hz (10000 kHz)\r\nop addr : 0\r\nop size : 32\r\npackage head : { 0x01 0x00 0x00 0x00 0x20 }\r\npackage head : { 0x03 0x00 0x00 0x00 0x20 }\r\nTX | A0 07 B0 44 47 9E CD 15 AC 0E CC 85 E8 CF 46 D4 16 F9 4B F8 3F 5A F7 A0 91 22 02 10 B1 BD B6 51  |...DG.........F...K.?Z...".....Q|\r\nRX | A0 07 B0 44 47 9E CD 15 AC 0E CC 85 E8 CF 46 D4 16 F9 4B F8 3F 5A F7 A0 91 22 02 10 B1 BD B6 51  |...DG.........F...K.?Z...".....Q|\r\n\r\n# hexdump  /sys/class/spi_slave/spi1/spi1.0/sunxi-slave-test\r\n0000000 07a0 44b0 9e47 15cd 0eac 85cc cfe8 d446\r\n0000010 f916 f84b 5a3f a0f7 2291 1002 bdb1 51b6\r\n0000020 ffff ffff ffff ffff ffff ffff ffff ffff\r\n*\r\n0001000\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6027\u80fd\u6d4b\u8bd5"}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# ./spislave-test -D /dev/spidev3.0 -R -s 10000000 -a 0 -S 2048 -I 1024\r\nspi mode: 0x80\r\nmax speed: 10000000 Hz (10000 kHz)\r\nop addr : 0\r\nop size : 2048\r\ntotal size   : 4.00 MB\r\ntotal time   : 4.90 s\r\naverange rate: 0.82 MB/s\r\naverange time: 4788.93 us\n"})}),"\n",(0,r.jsx)(n.h4,{id:"slave-\u9a71\u52a8\u793a\u4f8b\u4ee3\u7801",children:"Slave \u9a71\u52a8\u793a\u4f8b\u4ee3\u7801"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'// SPDX-License-Identifier: GPL-2.0-or-later\r\n/* Copyright(c) 2020 - 2023 Allwinner Technology Co.,Ltd. All rights reserved. */\r\n/*\r\n * Copyright (C) 2022 Allwinner.\r\n *\r\n * SUNXI SPI Slave test Driver\r\n *\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License as\r\n * published by the Free Software Foundation; either version 2 of\r\n * the License, or (at your option) any later version.\r\n *\r\n * 2022.09.30 JingyanLiang <jingyanliang@allwinnertech.com>\r\n * Create driver file\r\n *\r\n * assuming /dev/spidev1.0 corresponds to the SPI master on the remote\r\n * system and /sys/class/spi_slave/spi2/spi2.0/ corresponds to the SPI\r\n * Slave on the current system\r\n *\r\n * Usage for master command :\r\n *   # ./spislave-test -D /dev/spidev1.0 -R -s 10000000 -a 0 -S 2048\r\n *\r\n * Dump the slave data in memroy :\r\n *   # hexdump /sys/class/spi_slave/spi2/spi2.0/sunxi-slave-test\r\n *\r\n * Abort the slave transfer in user space manually :\r\n *  # echo > /sys/class/spi_slave/spi2/spi2.0/abort\r\n */\r\n\r\n#include <sunxi-log.h>\r\n#include <linux/version.h>\r\n#include <linux/module.h>\r\n#include <linux/of.h>\r\n#include <linux/device.h>\r\n#include <linux/sysfs.h>\r\n#include <linux/spinlock.h>\r\n#include <linux/completion.h>\r\n#include <linux/spi/spi.h>\r\n\r\n#include "spi-sunxi-debug.h"\r\n\r\n#define SALVE_CACHE_MAX (16 * PAGE_SIZE)\r\n\r\n#define PKT_HEAD_LEN 6\r\n#define OP_MASK\t\t0\r\n#define BITS_MASK\t1\r\n#define ADDR_MASK_0\t2\r\n#define ADDR_MASK_1\t3\r\n#define LEN_MASK_0\t4\r\n#define LEN_MASK_1\t5\r\n\r\n#define SUNXI_OP_WR\t\t0x01\r\n#define SUNXI_OP_RD\t\t0x02\r\n#define SUNXI_OP_WR_RD\t0x03\r\n#define SUNXI_OP_HEAD\t0xff /* Only used in kernel space */\r\n\r\nenum sunxi_spi_slave_status {\r\n\tSUNXI_SPI_SLAVE_IDLE = 0,\r\n\tSUNXI_SPI_SLAVE_RUNNING,\r\n\tSUNXI_SPI_SLAVE_RETRY,\r\n\tSUNXI_SPI_SLAVE_STOP,\r\n};\r\n\r\nstruct sunxi_spi_slave_head {\r\n\tu8 op_code;\r\n\tu8 bits;\r\n\tu16 addr;\r\n\tu16 len;\r\n};\r\n\r\nstruct sunxi_spi_slave_frame {\r\n\tu8 data[PKT_HEAD_LEN];\r\n\tstruct sunxi_spi_slave_head pkt_head;\r\n\tu8 *tx_buf;\r\n\tu8 *rx_buf;\r\n};\r\n\r\nstruct sunxi_spi_slave_cache {\r\n\tspinlock_t buffer_lock; /* cache buffer access lock */\r\n\tu8 *buffer;\r\n\tu32 size;\r\n};\r\n\r\nstruct sunxi_spi_slave_test {\r\n\tstruct spi_device *spi;\r\n\tstruct completion finished;\r\n\tstruct spi_transfer xfer;\r\n\tstruct spi_message msg;\r\n\tstruct sunxi_spi_slave_frame frame;\r\n\tstruct sunxi_spi_slave_cache cache;\r\n\tstruct bin_attribute bin;\r\n\tenum sunxi_spi_slave_status status;\r\n};\r\n\r\nstatic int sunxi_spi_slave_test_submit(struct sunxi_spi_slave_test *slave);\r\n\r\nstatic bool sunxi_spi_slave_has_ptk_head(struct sunxi_spi_slave_head *head)\r\n{\r\n\tif (head->op_code || head->bits || head->addr || head->len)\r\n\t\treturn true;\r\n\r\n\treturn false;\r\n}\r\n\r\nstatic void sunxi_spi_slave_head_data_parse(unsigned char *data, struct sunxi_spi_slave_head *head)\r\n{\r\n\thead->op_code = data[OP_MASK];\r\n\thead->bits = data[BITS_MASK];\r\n\thead->addr = (data[ADDR_MASK_0] << 8) | data[ADDR_MASK_1];\r\n\thead->len = (data[LEN_MASK_0] << 8) | data[LEN_MASK_1];\r\n}\r\n\r\nstatic void sunxi_spi_slave_head_data_clear(unsigned char *data, int len)\r\n{\r\n\tmemset(data, 0, len);\r\n}\r\n\r\nstatic int sunxi_spi_slave_set_cache_data(struct sunxi_spi_slave_test *slave,\r\n\t\t\t\t\t\t\t\t\tstruct sunxi_spi_slave_head *head, u8 *buf)\r\n{\r\n\tstruct device *dev = &slave->spi->dev;\r\n\tstruct sunxi_spi_slave_cache *cache = &slave->cache;\r\n\tint real_size = head->len;\r\n\r\n\tif (cache->size < head->addr) {\r\n\t\tsunxi_err(dev, "Set data addr over range\\n");\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tif (cache->size < head->addr + head->len) {\r\n\t\treal_size = cache->size - head->addr;\r\n\t\tsunxi_err(dev, "Write size %d over range, some of data will be lost, real size to write is %d\\n",\r\n\t\t\t\thead->len, real_size);\r\n\t}\r\n\r\n\tspin_lock(&cache->buffer_lock);\r\n\tmemcpy(cache->buffer + head->addr, buf, real_size);\r\n\tspin_unlock(&cache->buffer_lock);\r\n\r\n\treturn 0;\r\n}\r\n\r\nstatic int sunxi_spi_slave_get_cache_data(struct sunxi_spi_slave_test *slave,\r\n\t\t\t\t\t\t\t\t\t\tstruct sunxi_spi_slave_head *head, u8 *buf)\r\n{\r\n\tstruct device *dev = &slave->spi->dev;\r\n\tstruct sunxi_spi_slave_cache *cache = &slave->cache;\r\n\tint real_size = head->len;\r\n\r\n\tif (cache->size < head->addr) {\r\n\t\tsunxi_err(dev, "Get data addr over range\\n");\r\n\t\treturn 0;\r\n\t}\r\n\r\n\tif (cache->size < head->addr + head->len) {\r\n\t\treal_size = cache->size - head->addr;\r\n\t\tsunxi_err(dev, "Read size %d over range, some of data will be lost, real size to read is %d\\n",\r\n\t\t\thead->len, real_size);\r\n\t}\r\n\r\n\tspin_lock(&cache->buffer_lock);\r\n\tmemcpy(buf, cache->buffer + head->addr, real_size);\r\n\tspin_unlock(&cache->buffer_lock);\r\n\r\n\treturn 0;\r\n}\r\n\r\nstatic void sunxi_spi_slave_test_complete(void *arg)\r\n{\r\n\tstruct sunxi_spi_slave_test *slave = (struct sunxi_spi_slave_test *)arg;\r\n\tstruct device *dev = &slave->spi->dev;\r\n\tstruct sunxi_spi_slave_head *pkt_head = &slave->frame.pkt_head;\r\n\tint ret;\r\n\r\n\tret = slave->msg.status;\r\n\tif (ret) {\r\n\t\tswitch (slave->status) {\r\n\t\tcase SUNXI_SPI_SLAVE_RETRY:\r\n\t\t\tsunxi_info(dev, "slave transfer retry\\n");\r\n\t\t\tsunxi_spi_slave_head_data_clear(slave->frame.data, sizeof(slave->frame.data));\r\n\t\t\tgoto retry;\r\n\t\t\tbreak;\r\n\t\tcase SUNXI_SPI_SLAVE_STOP:\r\n\t\t\tsunxi_info(dev, "slave transfer stop\\n");\r\n\t\t\tgoto terminate;\r\n\t\t\tbreak;\r\n\t\tcase SUNXI_SPI_SLAVE_IDLE:\r\n\t\tcase SUNXI_SPI_SLAVE_RUNNING:\r\n\t\tdefault:\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tswitch (pkt_head->op_code) {\r\n\tcase SUNXI_OP_HEAD:\r\n\t\tsunxi_debug(dev, "sunxi slave get package head\\n");\r\n\t\tbreak;\r\n\tcase SUNXI_OP_WR:\r\n\t\tsunxi_debug(dev, "slave recv data from master done\\n");\r\n\t\tsunxi_spi_slave_set_cache_data(slave, pkt_head, slave->xfer.rx_buf);\r\n\t\tdevm_kfree(dev, slave->xfer.rx_buf);\r\n\t\tslave->xfer.rx_buf = NULL;\r\n\t\tslave->frame.rx_buf = NULL;\r\n\t\tbreak;\r\n\tcase SUNXI_OP_RD:\r\n\t\tsunxi_debug(dev, "slave send data to master done\\n");\r\n\t\tdevm_kfree(dev, slave->xfer.tx_buf);\r\n\t\tslave->xfer.tx_buf = NULL;\r\n\t\tslave->frame.tx_buf = NULL;\r\n\t\tbreak;\r\n\tcase SUNXI_OP_WR_RD:\r\n\t\tsunxi_debug(dev, "slave recv/send data from/to master done\\n");\r\n\t\tsunxi_spi_slave_set_cache_data(slave, pkt_head, slave->xfer.rx_buf);\r\n\t\tdevm_kfree(dev, slave->xfer.rx_buf);\r\n\t\tslave->xfer.rx_buf = NULL;\r\n\t\tslave->frame.rx_buf = NULL;\r\n\t\tdevm_kfree(dev, slave->xfer.tx_buf);\r\n\t\tslave->xfer.tx_buf = NULL;\r\n\t\tslave->frame.tx_buf = NULL;\r\n\t\tbreak;\r\n\tdefault:\r\n\t\tsunxi_debug(dev, "sunxi slave get op_code filed\\n");\r\n\t\tsunxi_spi_slave_head_data_clear(slave->frame.data, sizeof(slave->frame.data));\r\n\t\tbreak;\r\n\t}\r\n\r\nretry:\r\n\tspi_transfer_del(&slave->xfer);\r\n\tmemset(&slave->xfer, 0, sizeof(slave->xfer));\r\n\r\n\tret = sunxi_spi_slave_test_submit(slave);\r\n\tif (ret)\r\n\t\tgoto terminate;\r\n\r\n\treturn ;\r\n\r\nterminate:\r\n\tslave->status = SUNXI_SPI_SLAVE_IDLE;\r\n\tsunxi_info(dev, "slave transfer terminate\\n");\r\n\tcomplete(&slave->finished);\r\n}\r\n\r\nstatic int sunxi_spi_slave_test_submit(struct sunxi_spi_slave_test *slave)\r\n{\r\n\tstruct sunxi_spi_slave_head *pkt_head = &slave->frame.pkt_head;\r\n\tstruct device *dev = &slave->spi->dev;\r\n\tint ret = 0;\r\n\r\n\tslave->status = SUNXI_SPI_SLAVE_RUNNING;\r\n\r\n\tsunxi_spi_slave_head_data_parse(slave->frame.data, pkt_head);\r\n\r\n\tif (!sunxi_spi_slave_has_ptk_head(pkt_head)) {\r\n\t\tsunxi_debug(dev, "No Package head, wait revice from master\\n");\r\n\t\tpkt_head->op_code = SUNXI_OP_HEAD;\r\n\t\tslave->xfer.rx_buf = slave->frame.data;\r\n\t\tslave->xfer.len = sizeof(slave->frame.data);\r\n\t} else {\r\n\t\tsunxi_spi_slave_head_data_clear(slave->frame.data, sizeof(slave->frame.data));\r\n\t\tsunxi_debug(dev, "op=0x%x bits=%d addr=0x%x len=0x%x\\n", pkt_head->op_code, pkt_head->bits, pkt_head->addr, pkt_head->len);\r\n\r\n\t\tswitch (pkt_head->op_code) {\r\n\t\tcase SUNXI_OP_WR:\r\n\t\t\tslave->frame.rx_buf = devm_kzalloc(&slave->spi->dev, pkt_head->len, GFP_KERNEL);\r\n\t\t\tslave->xfer.rx_buf = slave->frame.rx_buf;\r\n\t\t\tslave->xfer.rx_nbits = pkt_head->bits;\r\n\t\t\tslave->xfer.tx_buf = NULL;\r\n\t\t\tslave->xfer.len = pkt_head->len;\r\n\t\t\tsunxi_debug(dev, "slave recv data from master prepare\\n");\r\n\t\t\tbreak;\r\n\t\tcase SUNXI_OP_RD:\r\n\t\t\tslave->frame.tx_buf = devm_kzalloc(&slave->spi->dev, pkt_head->len, GFP_KERNEL);\r\n\t\t\tslave->xfer.tx_buf = slave->frame.tx_buf;\r\n\t\t\tslave->xfer.tx_nbits = pkt_head->bits;\r\n\t\t\tslave->xfer.rx_buf = NULL;\r\n\t\t\tslave->xfer.len = pkt_head->len;\r\n\t\t\tsunxi_spi_slave_get_cache_data(slave, pkt_head, (u8 *)slave->xfer.tx_buf);\r\n\t\t\tsunxi_debug(dev, "slave send data to master prepare\\n");\r\n\t\t\tbreak;\r\n\t\tcase SUNXI_OP_WR_RD:\r\n\t\t\tif (pkt_head->bits != SPI_NBITS_SINGLE) {\r\n\t\t\t\tsunxi_err(dev, "full duplex only support single(1-bit) mode\\n");\r\n\t\t\t\tret = -EINVAL;\r\n\t\t\t} else {\r\n\t\t\t\tslave->frame.rx_buf = devm_kzalloc(&slave->spi->dev, pkt_head->len, GFP_KERNEL);\r\n\t\t\t\tslave->xfer.rx_buf = slave->frame.rx_buf;\r\n\t\t\t\tslave->xfer.rx_nbits = pkt_head->bits;\r\n\t\t\t\tslave->frame.tx_buf = devm_kzalloc(&slave->spi->dev, pkt_head->len, GFP_KERNEL);\r\n\t\t\t\tslave->xfer.tx_buf = slave->frame.tx_buf;\r\n\t\t\t\tslave->xfer.tx_nbits = pkt_head->bits;\r\n\t\t\t\tslave->xfer.len = pkt_head->len;\r\n\t\t\t\tsunxi_spi_slave_get_cache_data(slave, pkt_head, (u8 *)slave->xfer.tx_buf);\r\n\t\t\t\tsunxi_debug(dev, "slave recv/send data from/to master prepare\\n");\r\n\t\t\t}\r\n\t\t\tbreak;\r\n\t\tdefault:\r\n\t\t\tsunxi_err(dev, "unknown op code %d, wait revice from master\\n", pkt_head->op_code);\r\n\t\t\tret = -EINVAL;\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tif (ret < 0) {\r\n\t\tsunxi_spi_slave_head_data_clear(slave->frame.data, sizeof(slave->frame.data));\r\n\t\tpkt_head->op_code = SUNXI_OP_HEAD;\r\n\t\tslave->xfer.rx_buf = slave->frame.data;\r\n\t\tslave->xfer.len = sizeof(slave->frame.data);\r\n\t}\r\n\r\n\tspi_message_init_with_transfers(&slave->msg, &slave->xfer, 1);\r\n\tslave->msg.complete = sunxi_spi_slave_test_complete;\r\n\tslave->msg.context = slave;\r\n\r\n\tret = spi_async(slave->spi, &slave->msg);\r\n\tif (ret)\r\n\t\tsunxi_err(dev, "spi_async failed %d\\n", ret);\r\n\r\n\treturn ret;\r\n}\r\n\r\nstatic ssize_t sunxi_spi_slave_bin_read(struct file *filp, struct kobject *kobj,\r\n\t\tstruct bin_attribute *attr, char *buf, loff_t off, size_t count)\r\n{\r\n\tstruct sunxi_spi_slave_test *slave = dev_get_drvdata(kobj_to_dev(kobj));\r\n\r\n\tspin_lock(&slave->cache.buffer_lock);\r\n\tmemcpy(buf, &slave->cache.buffer[off], count);\r\n\tspin_unlock(&slave->cache.buffer_lock);\r\n\r\n\treturn count;\r\n}\r\n\r\nstatic ssize_t sunxi_spi_slave_bin_write(struct file *filp, struct kobject *kobj,\r\n\t\tstruct bin_attribute *attr, char *buf, loff_t off, size_t count)\r\n{\r\n\tstruct sunxi_spi_slave_test *slave = dev_get_drvdata(kobj_to_dev(kobj));\r\n\r\n\tspin_lock(&slave->cache.buffer_lock);\r\n\tmemcpy(&slave->cache.buffer[off], buf, count);\r\n\tspin_unlock(&slave->cache.buffer_lock);\r\n\r\n\treturn count;\r\n}\r\n\r\nint sunxi_spi_init_slave_data(struct sunxi_spi_slave_test *slave, u8 pattern)\r\n{\r\n\tmemset(slave->cache.buffer, pattern, slave->cache.size);\r\n\treturn 0;\r\n}\r\n\r\nstatic ssize_t sunxi_slave_abort_store(struct device *dev, struct device_attribute *attr, const char *buf, size_t count)\r\n{\r\n\tstruct spi_device *spi = to_spi_device(dev);\r\n\tstruct sunxi_spi_slave_test *slave = spi_get_drvdata(spi);\r\n\r\n\tsunxi_info(dev, "slave transfer abort\\n");\r\n\r\n\tslave->status = SUNXI_SPI_SLAVE_RETRY;\r\n\tspi_slave_abort(spi);\r\n\r\n\treturn count;\r\n}\r\n\r\nstatic ssize_t sunxi_slave_submit_store(struct device *dev, struct device_attribute *attr, const char *buf, size_t count)\r\n{\r\n\tstruct spi_device *spi = to_spi_device(dev);\r\n\tstruct sunxi_spi_slave_test *slave = spi_get_drvdata(spi);\r\n\r\n\tif (slave->status != SUNXI_SPI_SLAVE_IDLE) {\r\n\t\tsunxi_warn(dev, "slave transfer isn\'t idle\\n");\r\n\t\treturn count;\r\n\t}\r\n\r\n\tsunxi_info(dev, "slave transfer submit\\n");\r\n\r\n\tsunxi_spi_slave_test_submit(slave);\r\n\r\n\treturn count;\r\n}\r\n\r\nstatic struct device_attribute sunxi_spi_slave_debug_attr[] = {\r\n\t__ATTR(abort, 0200, NULL, sunxi_slave_abort_store),\r\n\t__ATTR(submit, 0200, NULL, sunxi_slave_submit_store),\r\n};\r\n\r\nstatic void sunxi_spi_slave_create_sysfs(struct sunxi_spi_slave_test *slave)\r\n{\r\n\tint i;\r\n\r\n\tfor (i = 0; i < ARRAY_SIZE(sunxi_spi_slave_debug_attr); i++)\r\n\t\tdevice_create_file(&slave->spi->dev, &sunxi_spi_slave_debug_attr[i]);\r\n}\r\n\r\nstatic void sunxi_spi_slave_remove_sysfs(struct sunxi_spi_slave_test *slave)\r\n{\r\n\tint i;\r\n\r\n\tfor (i = 0; i < ARRAY_SIZE(sunxi_spi_slave_debug_attr); i++)\r\n\t\tdevice_remove_file(&slave->spi->dev, &sunxi_spi_slave_debug_attr[i]);\r\n}\r\n\r\nstatic int sunxi_spi_slave_test_probe(struct spi_device *spi)\r\n{\r\n\tstruct sunxi_spi_slave_test *slave;\r\n\tstruct device *dev = &spi->dev;\r\n\tint ret;\r\n\r\n\tslave = devm_kzalloc(dev, sizeof(*slave), GFP_KERNEL);\r\n\tif (!slave)\r\n\t\treturn -ENOMEM;\r\n\r\n\tslave->spi = spi;\r\n\tinit_completion(&slave->finished);\r\n\tspin_lock_init(&slave->cache.buffer_lock);\r\n\r\n\tret = of_property_read_u32(spi->dev.of_node, "slave-cachesize", &slave->cache.size);\r\n\tif (ret) {\r\n\t\tslave->cache.size = SALVE_CACHE_MAX;\r\n\t\tsunxi_warn(dev, "failed to get slave-cachesize, use default value %d\\n", slave->cache.size);\r\n\t} else if (slave->cache.size > SALVE_CACHE_MAX) {\r\n\t\tslave->cache.size = SALVE_CACHE_MAX;\r\n\t\tsunxi_err(dev, "slave-cachesize too big, use default value %d\\n", slave->cache.size);\r\n\t}\r\n\r\n\tslave->cache.buffer = devm_kzalloc(dev, slave->cache.size, GFP_KERNEL);\r\n\tif (!slave->cache.buffer)\r\n\t\treturn -ENOMEM;\r\n\r\n\tsunxi_info(dev, "slave cachesize %d\\n", slave->cache.size);\r\n\r\n\tsunxi_spi_init_slave_data(slave, 0xff);\r\n\r\n\tspi_set_drvdata(spi, slave);\r\n\r\n\tsysfs_bin_attr_init(&slave->bin);\r\n\tslave->bin.attr.name = "sunxi-slave-test";\r\n\tslave->bin.attr.mode = S_IRUSR | S_IWUSR;\r\n\tslave->bin.read = sunxi_spi_slave_bin_read;\r\n\tslave->bin.write = sunxi_spi_slave_bin_write;\r\n\tslave->bin.size = slave->cache.size;\r\n\tret = sysfs_create_bin_file(&spi->dev.kobj, &slave->bin);\r\n\tif (ret)\r\n\t\treturn ret;\r\n\r\n\tsunxi_spi_slave_create_sysfs(slave);\r\n\r\n\treturn sunxi_spi_slave_test_submit(slave);\r\n}\r\n\r\n#if (LINUX_VERSION_CODE >= KERNEL_VERSION(5, 18, 0))\r\nstatic void sunxi_spi_slave_test_remove(struct spi_device *spi)\r\n#else\r\nstatic int sunxi_spi_slave_test_remove(struct spi_device *spi)\r\n#endif\r\n{\r\n\tstruct sunxi_spi_slave_test *slave = spi_get_drvdata(spi);\r\n\r\n\tslave->status = SUNXI_SPI_SLAVE_STOP;\r\n\tspi_slave_abort(spi);\r\n\twait_for_completion(&slave->finished);\r\n\tsysfs_remove_bin_file(&spi->dev.kobj, &slave->bin);\r\n\tsunxi_spi_slave_remove_sysfs(slave);\r\n\r\n#if (LINUX_VERSION_CODE >= KERNEL_VERSION(5, 18, 0))\r\n#else\r\n\treturn 0;\r\n#endif\r\n}\r\n\r\nstatic const struct spi_device_id sunxi_spislave_ids[] = {\r\n\t{ .name = "spislave" },\r\n\t{},\r\n};\r\nMODULE_DEVICE_TABLE(spi, sunxi_spislave_ids);\r\n\r\nstatic const struct of_device_id sunxi_spislave_dt_ids[] = {\r\n\t{ .compatible = "sunxi,spislave" },\r\n\t{},\r\n};\r\nMODULE_DEVICE_TABLE(of, sunxi_spislave_dt_ids);\r\n\r\nstatic struct spi_driver sunxi_spi_slave_test_driver = {\r\n\t.driver = {\r\n\t\t.name\t= "sunxi-spi-slave",\r\n\t\t.owner\t= THIS_MODULE,\r\n\t\t.of_match_table = sunxi_spislave_dt_ids,\r\n\t},\r\n\t.probe  = sunxi_spi_slave_test_probe,\r\n\t.remove = sunxi_spi_slave_test_remove,\r\n\t.id_table   = sunxi_spislave_ids,\r\n};\r\nmodule_spi_driver(sunxi_spi_slave_test_driver);\r\n\r\nMODULE_AUTHOR("jingyanliang <jingyanliang@allwinnertech.com>");\r\nMODULE_DESCRIPTION("SUNXI SPI slave test driver");\r\nMODULE_VERSION("1.2.0");\r\nMODULE_LICENSE("GPL");\r\nMODULE_ALIAS("spi:sunxi-slave-test");\n'})}),"\n",(0,r.jsx)(n.p,{children:"Slave\u9a71\u52a8\u53ea\u662f\u4e00\u4e2a\u4f7f\u7528\u793a\u4f8b\uff0c\u5176\u529f\u80fd\u662f\u6a21\u62df\u4e86\u4e00\u4e2a\u5185\u5b58\u8bbe\u5907\uff0c\u53ef\u4ee5\u88abMaster\u8fdb\u884c\u8bbf\u95ee\uff0c\u8fdb\u884c\u6570\u636e\u4f20\u8f93\uff0c\u9a8c\u8bc1\u65b9\u6cd5\u5373\u662fMaster\u5bf9Slave\u8bbe\u5907\u8fdb\u884c\u5199\u6570\u636e\uff0c\u518d\u56de\u8bfb\uff0c\u6570\u636e\u4e00\u81f4\u5373\u6d4b\u8bd5\u6210\u529f\u3002"}),"\n",(0,r.jsx)(n.h3,{id:"flash-\u6a21\u5f0f",children:"Flash \u6a21\u5f0f"}),"\n",(0,r.jsx)(n.p,{children:"\u5bf9\u4e8e\u5916\u6302\u4f5c\u4e3a Flash \u7684 NOR\u3001NAND \u8bbe\u5907\uff0c\u4f7f\u7528\u7684\u662f Flash \u6a21\u5f0f\u3002\u5bf9\u4e8e NOR/NAND \u7684\u9a71\u52a8\u914d\u7f6e\u8bf7\u67e5\u770b\u5bf9\u5e94\u6587\u6863\uff0c\u8fd9\u91cc\u53ea\u6ce8\u91cd SPI \u7684\u914d\u7f6e\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'&spi0 {\r\n\tclock-frequency = <100000000>;\r\n\tpinctrl-0 = <&spi0_pins_default &spi0_pins_cs>;\r\n\tpinctrl-1 = <&spi0_pins_sleep>;\r\n\tpinctrl-names = "default", "sleep";\r\n\tsunxi,spi-num-cs = <1>;\r\n\tsunxi,spi-bus-mode = <SUNXI_SPI_BUS_NOR>;\r\n\tsunxi,spi-cs-mode = <SUNXI_SPI_CS_SOFT>;\r\n\tstatus = "okay";\r\n\r\n\tspi_board0 {\r\n\t\tdevice_type = "spi_board0";\r\n\t\tcompatible = "spi-nor";\r\n\t\tspi-max-frequency = <100000000>;\r\n\t\tm25p,fast-read = <1>;\r\n\t\t/*individual_lock;*/\r\n\t\treg = <0x0>;\r\n\t\tspi-rx-bus-width=<0x04>;\r\n\t\tspi-tx-bus-width=<0x04>;\r\n\t\tstatus="disabled";\r\n\t};\r\n\r\n\tspi-nand@0 {\r\n\t\tcompatible = "spi-nand";\r\n\t\tspi-max-frequency=<100000000>;\r\n\t\treg = <0x0>;\r\n\t\tspi-rx-bus-width=<0x04>;\r\n\t\tspi-tx-bus-width=<0x04>;\r\n\t\tstatus="okay";\r\n\t};\r\n};\n'})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"spi-max-frequency\u662f\u8be5SPI\u5916\u8bbe\u7684\u6700\u5927\u8f93\u51fa\u65f6\u949f\u9891\u7387\uff0c\u914d\u7f6e\u65f6\u4e0d\u53ef\u8d85\u8fc7dtsi\u4e2d\u914d\u7f6e\u7684SPI\u63a7\u5236\u5668\u6700\u5927\u65f6\u949f\u9891\u7387"}),"\n",(0,r.jsx)(n.li,{children:"spi-rx-bus-width\u662f\u8bfb\u7ebf\u5bbd\uff0c\u53ef\u914d\u7f6ex1,x2,x4\uff1bspi-tx-bus-width\u662fspi nand\u7684\u5199\u7ebf\u5bbd\uff0c\u53ef\u914d\u7f6ex1/x4"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\u6d4b\u8bd5-2",children:"\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# time dd if=/dev/mtd3 of=/dev/null bs=4096 count=10240\r\n\u547d\u4ee4\u5206\u6790\uff1a\r\n    time\uff1a\t\t \u547d\u4ee4\u5e38\u7528\u4e8e\u6d4b\u91cf\u4e00\u4e2a\u547d\u4ee4\u7684\u8fd0\u884c\u65f6\u95f4\u3002\r\n\tdd\uff1a\t\t\t \u7528\u6307\u5b9a\u5927\u5c0f\u7684\u5757\u62f7\u8d1d\u4e00\u4e2a\u6587\u4ef6\uff0c\u5e76\u5728\u62f7\u8d1d\u7684\u540c\u65f6\u8fdb\u884c\u6307\u5b9a\u7684\u8f6c\u6362\u3002\r\n\tif=\u6587\u4ef6\u540d\uff1a    \u8f93\u5165\u6587\u4ef6\u540d\uff0c\u7f3a\u7701\u4e3a\u6807\u51c6\u8f93\u5165\u3002\u5373\u6307\u5b9a\u6e90\u6587\u4ef6\u3002< if=input file >\r\n\t/dev/mtd3\uff1a\t \u7269\u7406\u5206\u533a\uff0c\u6839\u636e\u4f60\u5b9e\u9645\u4f7f\u7528\u60c5\u51b5\u9009\u62e9\uff0c\u5bf9\u5b83\u7684\u8bfb\u53d6\u4f1a\u4ea7\u751fIO\r\n\tof=\u6587\u4ef6\u540d\uff1a\t   \u8f93\u51fa\u6587\u4ef6\u540d\uff0c\u7f3a\u7701\u4e3a\u6807\u51c6\u8f93\u51fa\u3002\u5373\u6307\u5b9a\u76ee\u7684\u6587\u4ef6\u3002< of=output file >\r\n\t/dev/null\uff1a   \u662f\u4e00\u4e2a\u4f2a\u8bbe\u5907\uff0c\u76f8\u5f53\u4e8e\u56de\u6536\u7ad9\uff0cof\u5230\u8be5\u8bbe\u5907\u4e0d\u4f1a\u4ea7\u751fIO\uff08\u4e5f\u53ef\u4ee5\u6307\u5b9a\u5b58\u5728\u7684\u6587\u4ef6\uff0c\u4f46\u4f1a\u4ea7\u751fIO\uff09\r\n\tbs=bytes\uff1a    \u540c\u65f6\u8bbe\u7f6e\u8bfb\u5165/\u8f93\u51fa\u7684\u5757\u5927\u5c0f\u4e3abytes\u4e2a\u5b57\u8282\u3002\r\n\tcount=blocks\uff1a\u4ec5\u62f7\u8d1dblocks\u4e2a\u5757\uff0c\u5757\u5927\u5c0f\u7b49\u4e8eibs\u6307\u5b9a\u7684\u5b57\u8282\u6570\u3002\n"})}),"\n",(0,r.jsx)(n.h3,{id:"dbi-\u6a21\u5f0f",children:"DBI \u6a21\u5f0f"}),"\n",(0,r.jsx)(n.p,{children:"DBI \u6a21\u5f0f\u4e3b\u8981\u9a71\u52a8LCD\u5c4f\uff0c\u5c06SPI\u4e0eLCD\u5bf9\u5e94\u7684\u5f15\u811a\u8fde\u63a5\u5373\u53ef\uff0cLCD \u9a71\u52a8\u914d\u7f6e\u8bf7\u67e5\u770b\u5bf9\u5e94\u6587\u6863\uff0c\u8fd9\u91cc\u53ea\u6ce8\u91cd SPI \u7684\u914d\u7f6e\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'&spi1 {\r\n\tsunxi,spi-bus-mode = <SUNXI_SPI_BUS_DBI>;\r\n\tsunxi,spi-cs-mode = <SUNXI_SPI_CS_AUTO>;\r\n\tstatus = "okay";\r\n};\r\n\r\n&lcd_fb0 {\r\n\tlcd_used = <1>;\r\n\tlcd_driver_name = "kld2844b";\r\n\tlcd_if = <1>;\r\n\tlcd_dbi_if = <4>;\r\n\tlcd_data_speed = <60>;\r\n\tlcd_spi_bus_num = <1>;\r\n\tlcd_x = <240>;\r\n\tlcd_y = <320>;\r\n\tlcd_pixel_fmt = <0>;\r\n\tlcd_dbi_fmt = <3>;\r\n\tlcd_rgb_order = <0>;\r\n\tlcd_width = <60>;\r\n\tlcd_height = <95>;\r\n\tlcd_pwm_used = <1>;\r\n\tlcd_pwm_ch = <6>;\r\n\tlcd_pwm_freq = <5000>;\r\n\tlcd_pwm_pol = <1>;\r\n\tlcd_frm = <1>;\r\n\tlcd_gamma_en = <1>;\r\n\tfb_buffer_num = <2>;\r\n\tlcd_backlight = <100>;\r\n\tlcd_fps = <60>;\r\n\tlcd_dbi_te = <1>;\r\n\tlcd_dbi_clk_mode = <0>;\r\n\tlcd_gpio_0 = <&pio PD 4 GPIO_ACTIVE_LOW>;\r\n\t/*lcd_spi_dc_pin = <&pio PD 5 GPIO_ACTIVE_HIGH>;*/\r\n\tstatus = "okay";\r\n};\n'})}),"\n",(0,r.jsx)(n.h3,{id:"bit-\u6a21\u5f0f",children:"BIT \u6a21\u5f0f"}),"\n",(0,r.jsx)(n.p,{children:"BIT\u6a21\u5f0f\u4ec5\u652f\u6301CPU\u4f20\u8f93\u65b9\u5f0f\uff0c\u786c\u4ef6\u4e0a\u65e0FIFO\u4e0d\u652f\u6301DMA\uff0c\u4e0d\u652f\u6301\u5168\u53cc\u5de5\u81ea\u6d4b\uff0c\u9700\u8981\u63a5\u793a\u6ce2\u5668/\u903b\u8f91\u5206\u6790\u4eea\u770b\u6ce2\u5f62"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:'&spi0 {\r\n\tsunxi,spi-bus-mode = <SUNXI_SPI_BUS_BIT>;\r\n\tsunxi,spi-cs-mode = <SUNXI_SPI_CS_AUTO>;\r\n\tstatus = "okay";\r\n\r\n\tspidev@0 {\r\n\t\tcompatible = "rohm,dh2228fv";\r\n\t\treg = <0x0>;\r\n\t\tspi-3wire; # 3\u7ebfbit\u6a21\u5f0f\r\n\t\tspi-max-frequency = <10000000>;\r\n\t\tspi-rx-bus-width = <1>;\r\n\t\tspi-tx-bus-width = <1>;\r\n\t\tstatus = "okay";\r\n\t};\r\n};\n'})}),"\n",(0,r.jsx)(n.h4,{id:"\u6d4b\u8bd5-3",children:"\u6d4b\u8bd5"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"# /bsptest/bin/spidev-test -D /dev/spidev1.0 -s 10000000 -S 4 -I 1 -3 -b 12 -v\r\nspi mode: 0x10\r\nbits per word: 12\r\nmax speed: 10000000 Hz (10000 kHz)\r\nTX | 7C FD 89 4C __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __  ||..L|\r\nRX | 00 00 00 00 __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __ __  |....|\r\nrx/tx buffer is not same, data error!!!\r\ntotal size   : 4 B\r\ntotal time   : 46.17 us\r\naverange rate: 0.08 MB/s\r\naverange time: 46.17 us\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"image-20240330111345343",src:s(36901).Z+"",width:"982",height:"387"})}),"\n",(0,r.jsx)(n.h2,{id:"\u9a71\u52a8\u8c03\u8bd5",children:"\u9a71\u52a8\u8c03\u8bd5"}),"\n",(0,r.jsx)(n.h3,{id:"\u8c03\u8bd5\u8282\u70b9",children:"\u8c03\u8bd5\u8282\u70b9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/sys/devices/platform/soc@3000000/4025000.spi/info"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6253\u5370SPI\u63a7\u5236\u5668\u7684\u786c\u4ef6\u8d44\u6e90\u4fe1\u606f\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/ # cat /sys/devices/platform/soc@3000000/4025000.spi/info\r\nIP Version = V1.3\r\npdev->id   = 0\r\npdev->name = 4025000.spi\r\npdev->num_resources = 2\r\npdev->resource = [mem 0x04025000-0x04025fff flags 0x200]\r\nctlr->bus_num = 0\r\nctlr->num_chipselect = 1\r\nctlr->dma_alignment  = 128\r\nctlr->mode_bits = 3855\r\nctlr->dma_tx = [dma0chan0]\r\nctlr->dma_rx = [dma0chan1]\r\nctlr->min_speed_hz = 187500\r\nctlr->max_speed_hz = 100000000\r\nsspi->base_addr = 0xffffffc0093e1000\r\nsspi->irq = 118\r\nsspi->bus_mode = 16\r\nsspi->bus_num  = 0\r\nsspi->bus_freq = 100000000\r\nsspi->cs_mode  = 1\r\nsspi->cs_num   = 1\r\nsspi->pre_speed_hz = 0\r\nsspi->bus_sample_mode  = 0 [auto]\r\nsspi->spi_sample_mode  = 0x0\r\nsspi->spi_sample_delay = 0x0\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/sys/devices/platform/soc@3000000/4025000.spi/status"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6253\u5370SPI\u63a7\u5236\u5668\u8fd0\u884c\u72b6\u6001\u4fe1\u606f"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/ # cat /sys/devices/platform/soc@3000000/4025000.spi/status\r\nctlr->flags = 0x20\r\nctlr->busy = 0\r\nctlr->running = 1\r\nsspi->mode_type = 0\r\nsspi->result = 0\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/sys/devices/platform/soc@3000000/4025000.spi/fifo"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u6253\u5370SPI\u63a7\u5236\u5668\u7684fifo\u72b6\u6001\uff08\u5305\u62ec\u786c\u4ef6fifo\u5927\u5c0f\uff0c\u89e6\u53d1\u6c34\u7ebf\u53ca\u6570\u636e\u7684\u5b9e\u65f6\u6570\u91cf\uff09\u3002"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/ # cat /sys/devices/platform/soc@3000000/4025000.spi/fifo\r\ntx fifo size      : 64\r\nrx fifo size      : 128\r\ntx trigger level  : 32\r\nrx trigger level  : 64\r\n\r\ntx shift buf count: 0\r\ntx buffer count   : 0\r\ntx fifo   count   : 0\r\nrx buffer count   : 0\r\nrx fifo   count   : 0\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"/sys/devices/platform/soc@3000000/4025000.spi/dump"})}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"/ # cat /sys/devices/platform/soc@3000000/4025000.spi/dump\r\n[ 7781.698377] 0x04025000: 00010003 00000087 000000c7 00000000\r\n[ 7781.704639] 0x04025010: 00000000 00000032 00200040 00000000\r\n[ 7781.710888] 0x04025020: 00000000 00000002 00002000 00000000\r\n[ 7781.717138] 0x04025030: 00000000 00000000 00000000 00000000\r\n[ 7781.723385] 0x04025040: 000000a0 00000000 00000000 00000000\r\n[ 7781.729628] 0x04025400: 00000000 00000000 00000000 00000000\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.code,{children:"debug_mask"})}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u7528\u4e8e\u52a8\u6001\u6253\u5f00\u8c03\u8bd5\u6253\u5370\u4ee5\u8ddf\u8e2a\u6bcf\u6b21\u6570\u636e\u4f20\u8f93\u524d\u540e\u7684\u5bc4\u5b58\u5668\u72b6\u6001\u53d8\u5316\u5373\u6536\u53d1\u7684\u6570\u636e\u5185\u5bb9"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-c",children:"enum {\r\n\tSUNXI_SPI_DEBUG_DUMP_REG\t= BIT(0),\r\n\tSUNXI_SPI_DEBUG_DUMP_DATA\t= BIT(1),\r\n};\n"})}),"\n",(0,r.jsxs)(n.p,{children:["\u5f53\u524d\u6709 ",(0,r.jsx)(n.code,{children:"spi/dbi"})," \u4e24\u4e2a\u8282\u70b9\u63a7\u5236\uff0c\u5411\u5176\u5199\u5165\u5bf9\u5e94\u7684 ",(0,r.jsx)(n.code,{children:"bit"})," \u63a9\u7801\uff0c\u5373\u53ef\u6253\u5f00\u5bf9\u5e94\u6253\u5370\u4fe1\u606f"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-shell",children:"echo 3 > /sys/module/spi_sunxi/parameters/spi_debug_mask\r\necho 3 > /sys/module/spi_sunxi/parameters/dbi_debug_mask\n"})}),"\n",(0,r.jsx)(n.h2,{id:"faq",children:"FAQ"}),"\n",(0,r.jsx)(n.h3,{id:"\u5982\u4f55\u5f3a\u5236\u4f7f\u7528cpu\u4f20\u8f93",children:"\u5982\u4f55\u5f3a\u5236\u4f7f\u7528CPU\u4f20\u8f93"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u5173\u95edDMA\u76f8\u5173\u914d\u7f6e\u5b8f ",(0,r.jsx)(n.code,{children:"CONFIG_DMADEVICES/CONFIG_AW_DMA/CONFIG_DMA_ENGINE"})]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u6ce8\u91cadtsi\u4e2dSPI\u63a7\u5236\u5668\u7684",(0,r.jsx)(n.code,{children:'dma-names = "tx", "rx"'}),"\u914d\u7f6e\u4fe1\u606f"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:["\u5c06SPI\u9a71\u52a8\u4e2d\u7684",(0,r.jsx)(n.code,{children:"sspi->use_dma"}),"\u5f3a\u5236\u4fee\u6539\u4e3afalse"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"\u4ee5\u4e0a\u4e09\u79cd\u529e\u6cd5\u4efb\u9009\u5176\u4e00\u5373\u53ef\u3002"})]})}function p(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(_,{...e})}):_(e)}},59758:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/image-20240330103657973-d7edbf486b2c90afaeda7039d8e49533.png"},62047:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/image-20240330104418565-0685e1349f3997410e9aaeac2469b058.png"},14236:(e,n,s)=>{s.d(n,{Z:()=>r});const r=s.p+"assets/images/image-20240330104541071-ac555d9f608dc4aef457427d50c2e072.png"},36901:(e,n,s)=>{s.d(n,{Z:()=>r});const r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAA9YAAAGDCAIAAABBVx+IAAAavklEQVR4nO3dP6gd6XkH4O9mVblYLGEXaQw+mGMsFkywE1dBErjOlbLZJk2Q5GZx4cXgFbjYwkXguljswrjxleLGzWajuDfsLqmcOBiD2cWX5QTcJBC4BBHcLTfFyJPR/DszZ+a8M+fM82CW0dw5M++dleTfffedb07W63WCF50/fvLwwf2DPmDyAroc8Mt//bev/cWfz7nIyQs4jgMmL+A4Dpi8gOM4YPICjuOAyQs4jgMmL2DaA05EcMKcXV49unEydRUAABP7k6kLAACAZRHBAQAglAgOAAChzIIDAEAoXXAAAAglghPn7PJq6hIAAKYnggMAQCgRHAAAQongAAAQyoooAAAQShccAABCieDEsSIKAEASwQEAIJgIDgAAoa5NXQAQ4Ru/eHnqEgBgi598/dnUJQTRBSfOoxsnU5ewUPI3AMyKCA4AwCwsp2ckghPHiigAAEkEp9bFxcXUJQAAHC2PY1Lv4uKi6c2p54+fZBsPH9xvP0l+ZHbwarU6f/ut4p7qYV1O21RM7XbLtUo7u1+37/HTWs5/1AOAQyGC06g2hZ8/flJMri0xtHRkSmmz2XzmxeCbbWf/bD9bk6a0XXvOaknFnd0LqF60ardvBwAW7hu/eHkJ66IYRKHNWBMpWRid1Yoo1djdJVgDAAynC844qk3fLNEO6QSP3kgepaSWnXmsL+4vteGLRwIAyySC06ZpHLyqNlPmfeXsq9mKKN1jaPecmmfrrW3sUkm9tM+x5NtNYy3dZ3hGZBAcAGZIBKdR9/zdonbeY/hphxgyet5ythGPBIAlW8I4uFlw6o2Svxei2Pwe60gA4IiJ4NQYJX/PsN1bLak4u7JbX3zrpwaeHwA4PieanfRVO8xdO/qcb5dmMFqOTHWrFm4tpjQL3rRSYe2i4Knuucn2y7WctlR/7YVqa9gHg+AAHKijH0QRweFoieAAHK7jTuEexyTO2eXVrJYGB2jx5ud+lW9///dfrd1f/FLT8QBVIjgA1Pj+77/65ud+lYXpfCP/UraRx+7iAaWMDlDlcUw4TqZQYERZHM+3s42tAR2giQgOAMDsHHcvSQSnxunp3X1sPLpxsqcz2yhtAMBxmMn/sY6+YUUUOE7H3TyAGKUJ79JDmU1fAsZyxIui6IIT5+zyauoSAACmJ4IDwBbtfe7iw5rJiigwkiNugSeLEsKx+snXn5lFgSGyJJ39c+ucSe2SKQBNRHAAqNGepKtflbyB7gyiEMerMQEAkggOAMDcHPcgeBLBiWRFlGBH//cXABwoERwAAEI9fxzzly+91HLQ1z75JKQY+rl58+aQj3/44YdjVQIAQHe64Ms1MMEDAOzDEgYpRfBFC07hVkSJt4S/xQDg4IjgS6cXDgAQTAQnLoVbEQUAIIngZPTCAYA5WMgIZY8X1J8/fpJtPHxwf+sx2WGlX5YOaD/VEeh1x9pvxfnjJx3v1dOnT/Pte/fudflI5ubNm9ZIOUo/+fqzb/zi5amrAAD+X9cIXoyATXGwdEz6YwrPw/fDB/eL28Orn7Md7ljTPSn93NLu3r17T58+zcJ3vtGRFA4AEGDoIEpTOjz6hD2Kjncp8mbudSLFiigAAKnXIEqtYjrMJ09KkbF2J7ni/an+SBN/3/TCAYBJLGQQPA2P4CW1cybCd7vqoM6xOru80gifxHL+RgOAgzByBM8UR8A5OFrgR+nLP//W1CUAwBa/Of3h1CUEGXNRwl5PDS5T6RbN8I7J30dJ/gaAWTlZr9cppV++9FLLQV/75JPUsHxedRWU4jHVjyx8UcLqfxwYsnBh7aOTOy9KmPafvw2iTEUEB+BQLKQR3iOCM9Dowznjrl6i/33ERHAADsVCIri3Y8aZc8u/lL8vLi6mqgQA4Ojt5XFMDktt//vi4iL7LyRVHd/omSqzSe98+vPP3n6ruKd6WJfTNhVTKqxliczqYb2ufljrbGqBA8DciOBL1zJ/UpvCO77Rs3pkSmmz2XymbjJ+yDtTi8k731M8W1PB1bze/erVi1ZZFAgAdvDln39rCbMoBlEWbev891gTKcFhtBh/m+KyfAwATEUXfLnGff6y2vQdvjz86I3kUUpq2VmabKnOq3Sf4QEAjtjzCD75miftE7r2VPekkDVMmsbBq2ozZd6Bzr766MbJeZ8Y2ncypMt8SKmkXmrnWKqDLk2TLd1neEZkEBwAZmguXfBqHLGnfU+A7vm7RTWPTt4AHjJ63nK2EY8EgCVbwji4WXDqjZK/S84ur0Y/5xwUm99jHQkAHDERnBqj5O8J273FiZSmF7iOZWs3vbYSAGDJTvbR7OS41Q5z144+59vZl/J1wVuOLH61S2bNB7uLs+BN64LXjtT3Whe8aQHEpvpbCth6reEMggNwoI5+EEUEJ87Z5dWjGydTV7EgIjgAh+u4U/hcHsdkCeRv4IC886Vv5tuvffSj2v3FLzUdD1AlggNAjdc++tE7X/pmFqbzjfxL2UYeu4sHlDI6QJXHMYlzrCuizJMpFBhRFsfz7Wxja0AHaCKCAwAwO8fdSxLBAQAglAgOAL2Vhk8AehHBiWNFFACAJIIDwFbtPe/iw5rJiigwEuuCwzi8mifSb05/eNwPssC+ZUk6++fWmZPaJVMAmojgAFCjPUlXvyp5A90ZRAEAgFAiOAAA83Lcg+BJBCeSQfBgR//3FwAcKBEcAABCieDEObu8mroEAIDpieAAAMzIEgYpRXA4Zkv4WwwADo4IDgAAoURw4lgRBQAgieAAAMzHQkYoRXDiWBFlEgv5uwwADogIDgAAoURwAAAIJYIDADALyxmePFmv11PXAAAAC6ILDgAAoURw4lgRBQAgieAAABBMBAcAgFAiOAAAhLIiCgAAhNIFBwCAUCI4cayIAgCQRHAAAAgmggMAQCgRHAAAQlkRBQAAQumCAwBAKBGcOFZEAQBIIjgAAAQTwQEAIJQIDgAAoayIAgAAoXTBAQAglAhOHCuiAAAkERwAAIKJ4AAAEEoEBwCAUM9XRPnwX77UctDNv/woqh56eP2Vj4d8/Me//cJYlQAA0J0u+HINTPAAAOxGBF+04BRuRRQAgCSCoxcOABBMBEcKB4C9+N3FRe0vi/tL28X/9bpEx89uPW1tkU0fbD9b07fZfpKmI0vfYN8btcN1m+5ty5Et2yXXdiu6u/PHT1JKDx/c3/eFGOL1Vz72dCYAxPviev27i4svrtf5L7ONjsmy+PG+n+0oO1t+8qar76x6B2rPWdzTdNGt33jxFm0tO68kOzL/SPUq+ZHZl0opvPZCPSJ4FqZTc57ODyge9vDB/dL+4i9F8y623vmiN979JN/+wasvdb9KQAp/dONkr+cHgLnJ82spnNXG7t1s/fjWdm/TGWrDd3sPuEs9VS0FNKXe2otWY3ptAi79u6j+6FL7ryb/l9j000j+zy75vmsEP3/8JM9/xe2ibGfTV2vP0/HqS9blzhf94NWX3nj3kyx85xsd6YUDwFhKOawYB1si2m4N7NprpUowbY+G1R8PmhrPXU5Se9r2j9det/abKrac841qAU1RO1Vid/G72xr3W4J47RjP0C54ra2hsCVna4HP0F5T+NnllUY4AMtRzYjVmFublbufv+mDW1u/1SNLPx6Uom3LmWu/Woq2Tf3srbm8+NXSMU0/EhSv2NJHL9bQkqdr29u1ob+2yKbrDo3gW2O0nH1w9MIBYLjaKe2mw1JDVmsfgC71g9s/W1tGe9N9yLx1xzHx0s8hpW509VtIlZRfrbP0A0/Hgptub+05m76FLpfLWBGFGqend23YsGHDhg0bAzdyp6d3m1bVyA9+8ztv5k/+ZRtvfufN4jFfXK+rl8iOKX0q+2V+TLF3W1tDqeY8uZb+l5eRl5pfvbSndDeyExbrabpR1Xqq9+f09G727RT35Ad3LKx4B/Lvq6Ww/K5Wb29pY+vdyDa6vqC++0TykK9S1XLnmxYT3HkWPGMQBQCGK00DV3u6LcPHRR2nU1r6xx13lprKLQWnF2N9+2x3dSBk692oPaD92986bdL0rbVfuuN/ZOh1ZGbvixK2EMdnaK8jKPI3AMvRK0e2D5y0+90fF86rDa+lI9sLLh3Tcaai/dHD7t9L6RtpOUnT99gyxNKljPZ5ofTiDx4dTzJ0Fry4tmAxN9eucNKyFnjTeWjS945lixJm/+zbAjcCDgCjq50Irz6V2NIk7nLy1GH8esgsePfQ2V5kSyXtd6DpOc7q2Zru7Vjab1rHn1t6dMFbFiJsOaDjeWjR647tMHmSCcjfBlEAWJqOAyelJmtTBm3ZU3yiMfXpPbcX37S/188JXXS5A7UZfevzkbVFdgzKpTNUf5TKz9b3hkw5iMJ86H8DwD4UM1lTU7l2qLoapptmPGoP6xLEqzG0tKe24FJKbv9UerG93VRSyx3o9S3UtsZrs3jtz0WlClvGu2vL7jUL3vVxzJavMpWmxzH7CsvfuuAAAMmihOh/AwAEE8EXLTh/a4EDACQRfMn0vwEAJvF8Fnxy+bp76Y8LgNjTvucQmQUHAEjzieAsgQgOAJAMogAAQDARHAAAQhlEAQCAULrgAAAQSgQnztnl1dQlAABMTwQHAIBQIjgAAIQSwQEAIJQVUQAAIJQuOAAAhBLBiWNFFACAJIIDAEAwERwAAEKJ4AAAEMqKKAAAEEoXHAAAQongxLEiCgBAEsEBACCYCA4AAKFEcAAACGVFFAAACKULDgAAoa5NXQBzdP74yT5O+9nvfv+v/uujfZwZAKDWe+9/sNlspq6iTASnxsMH9/dx2nc+/fl9nBYAoMlms9lTsBnCIAoAAIQSwQEAIJQITpxnb781dQkAANMTwQEAIJQITpyXv/29qUsAAJieCA4AAKFEcAAACCWCAwBAqOev5ml/G+IM1zM/dP/9d+/s/NnP/vS1bOPmzZtDavjwww+HfHwHz95+K/m9BAAsni74cg1M8AAA7EYEX7TgFG5FFACAJIKjFw4AEOza1AVs9977H6SUNptNcWfTeHr7UHuvz65Wq5TSndu3Ota5s3/6mz8t/vKv//E/m3buyc2bN+PnwgEAFksXnJT0wgEAAvXogudN4uAFUrL+d8eLDqmt9NkuDfVRlDrcWf97SNv76dOn2ca9e/e6fyqgF25FFACA1D2Cnz9+kifU4jZz8/Tp0zx5F7e7MJECABDAIAov2OtEihVRAACSCE6VuXAAgL0SwalxenrXhg0bNmzYsGHDxp42TtbrderwgvoJZ8Gz2uKnz/d63ZYX1G99HLP9BfVDZsEz+xsHf+fTn3/tf/5jTycHAKia50OMuuC8YK+PYz57+639nRwA4FB0XREla4Tn23urh6Hu3bu326KEac/5GwCATI91wcOSd+1bKuNl1y0Vs4+3co7+dswdhk9SSP62IgoAQDKIQkb/GwAgTI8ueJiZDLrcuX2r+8FDaq7tcA95O2Zf8jcAQCRd8KWTvwEAgongixacv62IAgCQRPAl0/8GAJjE81nwyceviyuKZMUc+57/3f08P32+cXAZ2oooAAApfzsmBPB2TAAgmLdjAgAAIjgAAMQSwYljRRQAgCSCAwBAMBGcOFZEAQBIIjgAAAQTwQEAIJQIDgAAoa5NXQAL8pl//ofzzWbqKgCABVmtVlOXUMPbMQEAIJRBFOKcXV5NXQIAwPREcAAACCWCAwBAKBEcAABCeRwTAABC6YIDAEAoEZw4VkQBAEgiOAAABBPBAQAglAgOAAChrIgCAAChdMEBACDUtakLYEHOLq8e3TiZuopFeO/9DzabzSinWq1Wd27fmk89aX4lqWeruZU0t3rS/EqaWz1pfiUdZT1pliUdKxEcjtBms3n44P4opzp//GT4SUasJ82vJPVsNbeS5lZPml9Jc6snza+ko6wnzbKkY2UQBQAAQongAAAQSgQnjkFwAIAkggMAQDARnDhnl1dTlwAAMD0RHAAAQongAAAQSgQHAIBQz1/N0758+ohL6zOi11/5eMjHf/zbL4xVSUdWRAEASLrgSzYwwQMAsBsRfNGCU7gVUQAAkgiOXjgAQLBrUxew3Xvvf5BS2mw2xZ1N4+ntQ+29PrtarVJKd27f6ljnzkrXzcqr3bknr7/ycfxcOADAYumCk5JeOABAoH5d8PPHT+JXR8n63x2vO6S80me7NNRHUXvdgff5jXc/+cGrL/X6SEAv3IooAACpVxc8LJIy0BvvfrLbB/XCAQAC9IjgVgc/FH3730V7TeFWRAEASGbBqdILBwDYKxGcGqend20c9Mb169fnUMZs67ERvDG33wBzq+dYv6+51WMjeMNvgPaNk/V6nTq/oH6SxzFHeTzxKK/b0q7e4XHM3P4eyjy7vPJEZowR/6iOcqpx/+qYW0nqiTmbWxRzknnWM9bZjvgWjXWqGZZ0rHTBecFeF0WRvwEA0g4rolgXZf6yFVF2WBfFC3oAAAL0WBc87L8m1L6lMl523Y5vqRzxrZzD34652whKQP42iAIAkAyikNH/BgAI0+/tmDFmMrx/5/at7geP+FbO4SfsS/4GAIikC7508jcAQDARfNGC87dBcACAJIIvmf43AMAkns+CTz5+XVwApLokiD3VPekAM7QVUQAA0nwex6z+DGBP+x4AAA6UQRQAAAglggMAQCgRnDgGwQEAkggOAADBRHDinF1eTV0CAMD0RHAAAAglggMAQCgRHAAAQs3l1TzMSvFlnCOfeU/n5UWr1WrEUw3//TBiPWl+Jamny9lmVdLc6knzK2lu9aT5lXSU9aRZlnSsTtbr9dQ1AADAghhEIY4VUQAAkggOAADBRHAAAAglggMAQCiPYwIAQChdcAAACCWCE8eKKAAASQQHAIBgIjgAAIQSwQEAIJQVUQAAIJQuOAAAhLo2dQHM0fnjJ/s47cvf/t6zt9/ax5lZoNVqdef2ramreO699z/YbDZTV1E2n1s0z/sDw83nTxkHRwSnxsMH9/dx2rPLq0f7OTMLtKcfFHez2Wz29KdmiPnconneHxhuPn/KODgGUQAAIJQIDgAAoURw4jy6cTJ1CQAA0xPBAQAglAhOnLPLq6lLAACYnggOAAChRHAAAAglggMAQKjnr+ZpX1veKxXm6WcXF0M+/rfr9ViVdGRFFACApAu+ZAMTPAAAuxHBFy04hVsRBQAgieDohQMABLs2dQHbvff+BymlzWZT3Nk0nt4+1N7rs6vVKqV05/atjnXurHTdrLzanXvys4uL+LlwAIDF0gUnJb1wAIBAPbrgeV82eIGUrP/d8aJDait9tktDfRS11x3yjXzl6vnI9b+f9FiBJKAXbkUUAIDUPYKfP36Sh8LiNnPzlaurPHkXt7swkQIAEMAgCi/Y60SKFVEAAFL3CK4Ffih2boHnzIUDAOxVvy64/H0ods7fmdPTuzZs2Oi+cf369TmUMdsN98eGDRs2Shsn6/U6dXtB/VT5e/jjicd63aZ29cD8vb9x8LPLK09kMpZZdQRmVUxuPlXNpxIYl9/b7KxrF9xvskMx2/ydrIgCAJBS2m1RwjRFb5ju8kUJU891CS2HAgAQoGsEj8zctW+pjJddt+NbKkd8K+fAt2Pu3AIPyN8GUQAAkkUJyeh/AwCE6TGIEmYmUy53bt/qfvCIb+UcfsK+5G8AgEi64EsnfwMABBPBFy04fxsEBwBIIviS6X8DAEzi+Sz45OPX1RUP7Wnfkw4wQ1sRBQAg5W/HhAAiOCOa1fvCZlVMbj5VzacSGJff2+zMIAoAAIQSwQEAIJQIThxTKAAASQQHAIBgIjhxzi6vpi4BAGB6IjgAAIQSwQEAIJQIDgAAoa5NXQALYkUURrRarYpvjZ3WarWauoQa87lF87w/MNx8/pRxcLwdEwAAQhlEIY4VUQAAkggOAADBRHAAAAglggMAQCiPYwIAQChdcAAACCWCE8eKKAAASQQHAIBgIjgAAIQSwQEAIJQVUQAAIJQuOAAAhLo2dQHM0fnjJ/s47cvf/t6zt9/ax5lZptVqdef2ramrSCml997/YLPZTF1FmfsDAebzB43DIoJT4+GD+/s47dnl1aP9nJll2tPPijvYbDZ7+lMzhPsDAebzB43DYhAFAABCieAAABBKBCfOoxsnU5cAADA9ERwAAEKJ4MQ5u7yaugQAgOmJ4AAAEEoEBwCAUCI4AACEev5qnvaF5b1SYZ5+/erFkI//2bvrsSrpyIooAABJF3zJBiZ4AAB2I4IvWnAKtyIKAEASwdELBwAIdm3qArZ77/0PUkqbzaa4s2k8vX2ovddnV6tVSunO7Vsd69xZ6bpZebU79+TXr17Ez4UDACyWLjgp6YUDAATq0QXP+7LBC6Rk/e+OFx1SW+mzXRrqo6i97pBv5FN//3zk+g/f7bECSUAv3IooAACpewQ/f/wkD4XFbebmU39/lSfv4nYXJlIAAAJ0HUSRuQ9Fr8xdtdeJFCuiAACkvo9jDp+RIEY2i7JbHNcLBwDYq36PYz58cP/hg/thQ9Ls7A/fPfnDd0/yofC+Tk/v2rBho/vG9evX51DGbDfcHxs2bNgobZys1+vU8wX1wbPgU7Xe53/drUMjfWfBM/trgZ9dXnkikxHN57mU+VRSNJ+q5lMJjM5vb3bTtQuu830odu58Z/Y6giJ/AwCk7rPgxfkTP+3NWXH+pG8L3Ag4AECAHo9jhiXv2rdUxsuu2/EtlSO+lXP42zF3ewozIH8bRAEASN6OSUb/GwAgTL9FCWPMZNDlzu1b3Q8e8a2cw0/Yl/wNABBJF3zp5G8AgGAi+KIF52+D4AAASQRfMv1vAIBJPJ8Fn3z8urgASHVJEHuqe9IBZmgrogAApPztmBBABGdc83kp3XwqKZpPVfOpBEbntze7MYgCAAChRHAAAAglghPHFAoAQBLBAQAgmAhOnLPLq6lLAACYnggOAAChRHAAAAglggMAQKhrUxfAglgRhXGtVqvii2MntFqtpi6hhvsDAebzB43D4u2YAAAQyiAKcayIAgCQRHAAAAgmggMAQCgRHAAAQnkcEwAAQumCAwBAKBGcOFZEAQBIIjgAAAQTwQEAIJQIDgAAoayIAgAAoXTBAQAglAhOHCuiAAAkERwAAIKJ4AAAEEoEBwCAUFZEAQCAULrgAAAQSgQnjhVRAACSCA4AAMH+D19r58T1i6SXAAAAAElFTkSuQmCC"},11151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>d});var r=s(67294);const t={},i=r.createContext(t);function d(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),r.createElement(i.Provider,{value:n},e.children)}}}]);