"use strict";(self.webpackChunkavaota_docs=self.webpackChunkavaota_docs||[]).push([[3688],{33991:(e,r,n)=>{n.r(r),n.d(r,{assets:()=>t,contentTitle:()=>a,default:()=>p,frontMatter:()=>l,metadata:()=>s,toc:()=>c});var i=n(85893),d=n(11151);const l={},a="Android Display \u663e\u793a",s={id:"android/develop/display",title:"Android Display \u663e\u793a",description:"HWC \u4f7f\u7528\u8bf4\u660e",source:"@site/docs/android/develop/display.md",sourceDirName:"android/develop",slug:"/android/develop/display",permalink:"/en-US/android/develop/display",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"androidSidebar",previous:{title:"Android GPIO \u63a7\u5236",permalink:"/en-US/android/develop/android-led"}},t={},c=[{value:"HWC \u4f7f\u7528\u8bf4\u660e",id:"hwc-\u4f7f\u7528\u8bf4\u660e",level:2},{value:"HWC \u8c03\u8bd5\u5de5\u5177",id:"hwc-\u8c03\u8bd5\u5de5\u5177",level:3},{value:"\u4f8b",id:"\u4f8b",level:4},{value:"\u56fe\u5c42\u6570\u636e\u4fdd\u5b58",id:"\u56fe\u5c42\u6570\u636e\u4fdd\u5b58",level:3},{value:"\u4f8b",id:"\u4f8b-1",level:4},{value:"Display HAL",id:"display-hal",level:2},{value:"CEC hal",id:"cec-hal",level:3},{value:"\u663e\u793a\u8f93\u51fa\u914d\u7f6e",id:"\u663e\u793a\u8f93\u51fa\u914d\u7f6e",level:3},{value:"\u663e\u793a\u52a8\u6001\u914d\u7f6e\u63a5\u53e3\u5b9e\u73b0",id:"\u663e\u793a\u52a8\u6001\u914d\u7f6e\u63a5\u53e3\u5b9e\u73b0",level:3},{value:"dispalyd",id:"dispalyd",level:3}];function o(e){const r={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,d.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(r.h1,{id:"android-display-\u663e\u793a",children:"Android Display \u663e\u793a"}),"\n",(0,i.jsx)(r.h2,{id:"hwc-\u4f7f\u7528\u8bf4\u660e",children:"HWC \u4f7f\u7528\u8bf4\u660e"}),"\n",(0,i.jsxs)(r.p,{children:["HWC \u4ee3\u7801\u4f4d\u4e8e\uff1a",(0,i.jsx)(r.code,{children:"android/hardware/aw/display/hwc\u2011hal"}),"\uff0c\u4e3b\u8981\u7528\u4e8e\u5b9e\u73b0\u786c\u4ef6\u5408\u6210\u5668\u76f8\u5173\u529f\u80fd\u5bf9\u63a5\u3002"]}),"\n",(0,i.jsx)(r.p,{children:"\u76ee\u5f55\u7ed3\u6784\u5982\u4e0b\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:".\r\n\u251c\u2500\u2500 aidl\r\n\u251c\u2500\u2500 common\r\n\u251c\u2500\u2500 disp2\r\n\u2502   \u2514\u2500\u2500 include\r\n\u251c\u2500\u2500 include\r\n\u251c\u2500\u2500 rotator\r\n\u251c\u2500\u2500 scripts\r\n\u251c\u2500\u2500 strategy\r\n\u251c\u2500\u2500 tests\r\n\u2502   \u2514\u2500\u2500 layertest\r\n\u2502   \u2514\u2500\u2500 cases\r\n\u251c\u2500\u2500 vendorservice\r\n\u2502   \u251c\u2500\u2500 default\r\n\u2502   \u2514\u2500\u2500 homlet\r\n\u2514\u2500\u2500 writeback\n"})}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"aidl: \u9876\u5c42\u9002\u914d\u4ee3\u7801\uff0c\u5bf9\u63a5 HWC AIDL"}),"\n",(0,i.jsx)(r.li,{children:"common: \u901a\u7528\u4ee3\u7801\uff0c\u9002\u914d android.hardware.graphics.composer"}),"\n",(0,i.jsx)(r.li,{children:"disp2: \u9a71\u52a8\u9002\u914d\u4ee3\u7801"}),"\n",(0,i.jsx)(r.li,{children:"rotator: \u786c\u4ef6\u65cb\u8f6c\u4ee3\u7801\u5b9e\u73b0"}),"\n",(0,i.jsx)(r.li,{children:"strategy: \u56fe\u5c42\u5408\u6210\u7b56\u7565"}),"\n",(0,i.jsx)(r.li,{children:"tests: \u5355\u5143\u6d4b\u8bd5\u4ee3\u7801\uff0c\u4e3b\u8981\u5305\u62ec\u56fe\u5c42\u5206\u914d\u7b56\u7565\u6d4b\u8bd5\u5df2\u7ecf\u786c\u4ef6\u65cb\u8f6c\u529f\u80fd\u6d4b\u8bd5"}),"\n",(0,i.jsx)(r.li,{children:"vendorservice\uff1a\u81ea\u5b9a\u4e49\u663e\u793a\u63a5\u53e3\u5b9e\u73b0"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"hwc-\u8c03\u8bd5\u5de5\u5177",children:"HWC \u8c03\u8bd5\u5de5\u5177"}),"\n",(0,i.jsxs)(r.p,{children:["\u7cfb\u7edf\u5185\u96c6\u6210\u4e86 HWC \u8c03\u8bd5\u5de5\u5177 ",(0,i.jsx)(r.code,{children:"hwcdebug"}),"\uff0c\u901a\u8fc7\u8be5\u5de5\u5177\u6267\u884c\u8c03\u8bd5\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"usage: hwcdebug [options] [categories...]\r\noptions include:\r\n\u2011o       enable hwc log output which indicate by the following categories\r\n\u2011x       disbale all hwc log output\r\n\u2011\u2011list   list the available logging categories\r\n\u2011\u2011dump   <type> <count> [z]\r\n    request dump buffer raw data into file\r\n    type: 0 \u2011 input buffer\r\n    1 \u2011 output buffer\r\n    2 \u2011 hardware rotated buffer\r\n    count: total request count\r\n    z : which z order of input buffer will be dump\r\n\u2011\u2011freeze <enable> \u2011s <display>\r\n    freezes the output content of the specified logic display for debugging\r\n\u2011\u2011help   show this usage\n"})}),"\n",(0,i.jsx)(r.p,{children:"HWC \u901a\u8fc7 tag \u8fdb\u884c\u8fc7\u6ee4\u8c03\u8bd5\u4fe1\u606f\u8f93\u51fa\uff0c\u652f\u6301\u7684 tag \u5305\u62ec\uff1a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"layer    \u2011 Layer planner debug output\r\nvsync    \u2011 Vsync timestamp print\r\nscale    \u2011 Hardware scaler detect\r\nfps      \u2011 Show primary display refresh rate\r\nrotate   \u2011 Hardware rotator relate information\r\nperf     \u2011 Hardware rotator relate information\n"})}),"\n",(0,i.jsx)(r.h4,{id:"\u4f8b",children:"\u4f8b"}),"\n",(0,i.jsx)(r.p,{children:"\u6253\u5f00\u5e27\u7387\u4fe1\u606f\u663e\u793a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"hwcdebug \u2011o fps && logcat \u2011s sunxihwc\n"})}),"\n",(0,i.jsx)(r.p,{children:"\u6253\u5f00\u56fe\u5c42\u5206\u914d\u4fe1\u606f\u663e\u793a"}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"hwcdebug \u2011o layer && logcat \u2011s sunxihwc\n"})}),"\n",(0,i.jsx)(r.h3,{id:"\u56fe\u5c42\u6570\u636e\u4fdd\u5b58",children:"\u56fe\u5c42\u6570\u636e\u4fdd\u5b58"}),"\n",(0,i.jsxs)(r.p,{children:[(0,i.jsx)(r.code,{children:"hwcdebug"})," \u76ee\u524d\u652f\u6301\u622a\u53d6\u8f93\u5165\u56fe\u5c42\uff0c\u548c\u786c\u4ef6\u65cb\u8f6c\u540e\u8f93\u51fa\u7684\u56fe\u5c42\uff0c\u547d\u4ee4\u683c\u5f0f\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"hwcdebug \u2011\u2011dump <type> <count> [z]\r\ntype  \u2011 \u53ef\u53d6\u503c\u4e3a 0/2, 0 \u5bf9\u5e94\u8f93\u5165\u56fe\u5c42\uff0c2\u5bf9\u5e94\u786c\u4ef6\u65cb\u8f6c\u8f93\u51fa\u56fe\u5c42\r\ncount \u2011 \u622a\u53d6\u56fe\u5c42\u7684\u5e27\u6570\r\nz     \u2011 \u6307\u5b9a\u8f93\u5165\u56fe\u5c42\u7684zorder\uff08\u5373\u7279\u5b9azorder\u7684\u56fe\u5c42\u624d\u4f1a\u88ab\u622a\u53d6\uff09\uff0c\u5982\u679cz=255\uff0c\u622a\u53d6\u6240\u6709\u7684\u8f93\u5165\u56fe\u5c42\n"})}),"\n",(0,i.jsxs)(r.p,{children:["\u56fe\u5c42\u6587\u4ef6\u4fdd\u5b58\u4e8e ",(0,i.jsx)(r.code,{children:"/data/"})," \u76ee\u5f55\u4e0b\uff0c\u4ee5 ",(0,i.jsx)(r.code,{children:"dump_format_widthxheight_framenumber.dat"})," \u683c\u5f0f\u547d\u540d\u3002"]}),"\n",(0,i.jsx)(r.h4,{id:"\u4f8b-1",children:"\u4f8b"}),"\n",(0,i.jsxs)(r.p,{children:["\u622a\u53d6 ",(0,i.jsx)(r.code,{children:"zorder"})," \u4e3a 1 \u7684\u8f93\u5165\u56fe\u5c42 3 \u5e27\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:"$ hwcdebug \u2011\u2011dump 0 3 1\r\n$ ls \u2011l /data/\r\n\u2011rw\u2011\u2011\u2011\u2011\u2011\u2011\u2011 1 system graphics 4096000 2020\u201101\u201114 11:00 dump_RGBA8888_800x1280_1769.dat\r\n\u2011rw\u2011\u2011\u2011\u2011\u2011\u2011\u2011 1 system graphics 4096000 2020\u201101\u201114 11:00 dump_RGBA8888_800x1280_1770.dat\r\n\u2011rw\u2011\u2011\u2011\u2011\u2011\u2011\u2011 1 system graphics 4096000 2020\u201101\u201114 11:00 dump_RGBA8888_800x1280_1771.dat\n"})}),"\n",(0,i.jsx)(r.h2,{id:"display-hal",children:"Display HAL"}),"\n",(0,i.jsx)(r.p,{children:"\u67d0\u4e9b\u5e73\u53f0\u9664\u4e86\u57fa\u7840\u5fc5\u5907\u7684 hwc\u2011hal \u4ee3\u7801\u5916\uff0c\u8fd8\u6709\u4e00\u4e9b\u5982 hdmi\u3001cvbs \u70ed\u63d2\u62d4\u3001hdmi \u7684 edid \u89e3\u6790\u53ca cec \u5904\u7406\u3001\u591a\u663e\u7b56\u7565\u7b49\u62d3\u5c55\u529f\u80fd\u4ee3\u7801\uff0c\u57fa\u4e8e\u6a21\u5757\u5316\u7684\u8bbe\u8ba1"}),"\n",(0,i.jsx)(r.h3,{id:"cec-hal",children:"CEC hal"}),"\n",(0,i.jsxs)(r.p,{children:["\u4ee3\u7801\u4f4d\u4e8e\uff1a",(0,i.jsx)(r.code,{children:"android/hardware/aw/display/cec\u2011hal"})," \u6b64\u90e8\u5206\u4ee3\u7801\u7528\u4e8e\u652f\u6301 HDMI \u7684 CEC \u529f\u80fd\uff0c\u9664\u975e\u4ea7\u54c1\u652f\u6301 CEC\uff0c\u5426\u5219\u8be5\u90e8\u5206\u4ee3\u7801\u4e0d\u4f1a\u4f7f\u7528\u3002"]}),"\n",(0,i.jsx)(r.h3,{id:"\u663e\u793a\u8f93\u51fa\u914d\u7f6e",children:"\u663e\u793a\u8f93\u51fa\u914d\u7f6e"}),"\n",(0,i.jsxs)(r.p,{children:["\u4ee3\u7801\u4f4d\u4e8e\uff1a",(0,i.jsx)(r.code,{children:"android/hardware/aw/display/configs"})," \u5176\u4e2d ",(0,i.jsx)(r.code,{children:"dispconfigs"})," \u5b50\u76ee\u5f55\u4e3a\u5404\u914d\u7f6e\u6587\u4ef6\u7684\u5b58\u653e\u76ee\u5f55\uff0c\u914d\u7f6e\u6587\u4ef6\u7528\u4e8e\u5bf9\u663e\u793a\u8f93\u51fa\u63a5\u53e3\u53ca\u5206\u8fa8\u7387\u3001\u4e3b\u526f \u663e\u6620\u5c04\u7b49\u4fe1\u606f\u8fdb\u884c\u914d\u7f6e\u3002\u9664\u975e\u4ea7\u54c1\u4ec5\u4ec5\u652f\u6301 LCD \u5355\u663e\uff0c\u5426\u5219\u4f1a\u4f7f\u7528\u5230\u8be5\u90e8\u5206\u4ee3\u7801\u3002"]}),"\n",(0,i.jsxs)(r.p,{children:["\u9ed8\u8ba4\u662f\u901a\u8fc7",(0,i.jsx)(r.code,{children:"ro.product.vendor.device"}),"\u5c5e\u6027\u6765\u627e\u914d\u7f6e\u6587\u4ef6\uff0c\u5f53\u4e0d\u5b58\u5728\u65f6\u4f7f\u7528 ",(0,i.jsx)(r.code,{children:"config.json"})," \u914d\u7f6e\u7684\u6587\u4ef6\u3002\u4e3e\u4f8b \u914d\u7f6e\u5982\u4e0b\uff1a"]}),"\n",(0,i.jsx)(r.pre,{children:(0,i.jsx)(r.code,{children:'{\r\n    "DisplayEngineVersion": 2,\r\n    "DisplayNumber": 3, /*Display0, Display1, Display2 */\r\n\r\n    "PrimaryDisplay": ["Display0"],\r\n    "ExternalDisplay": ["Display1", "Display2"],\r\n\r\n    "Display0": {\r\n        /* Available interface type: LCD/HDMI/CVBS */\r\n        "InterfaceType": "LCD",\r\n        "DisplayEnginePortId": 0,\r\n        "OverrideFramebufferSize": 1,\r\n        "FramebufferWidth": 1024,\r\n        "FramebufferHeight": 600,\r\n        "DpiX": 213,\r\n        "DpiY": 213,\r\n        "HotplugSupported": 0,\r\n        "AfbcSupported": 0,\r\n        "HardwareRotateSupported": 0,\r\n        "BandwidthLimited": 338800,\r\n        "DefaultOutputMode": 0\r\n    },\r\n\r\n    "Display1": {\r\n        /* Available interface type: LCD/HDMI/CVBS */\r\n        "InterfaceType": "HDMI",\r\n        "DisplayEnginePortId": 1,\r\n        "OverrideFramebufferSize": 1,\r\n        "FramebufferWidth": 1280,\r\n        "FramebufferHeight": 720,\r\n        "DpiX": 160,\r\n        "DpiY": 160,\r\n        "HotplugSupported": 0,\r\n        "AfbcSupported": 0,\r\n        "HardwareRotateSupported": 0,\r\n        "BandwidthLimited": 338800,\r\n        "DefaultOutputMode": 0\r\n    },\r\n\r\n    "Display2": {\r\n        /* Available interface type: LCD/HDMI/CVBS */\r\n        "InterfaceType": "DP",\r\n        "DisplayEnginePortId": 1,\r\n        "OverrideFramebufferSize": 1,\r\n        "FramebufferWidth": 1280,\r\n        "FramebufferHeight": 720,\r\n        "DpiX": 160,\r\n        "DpiY": 160,\r\n        "HotplugSupported": 0,\r\n        "AfbcSupported": 0,\r\n        "HardwareRotateSupported": 0,\r\n        "BandwidthLimited": 338800,\r\n        "DefaultOutputMode": 0\r\n    }\r\n}\n'})}),"\n",(0,i.jsx)(r.p,{children:"\u91cd\u70b9\u8bf4\u660e\u4e00\u4e9b\u5e38\u7528\u7684\u53ef\u4fee\u6539\u914d\u7f6e\u9879\uff0c\u5176\u4ed6\u4e0d\u5efa\u8bae\u4fee\u6539:"}),"\n",(0,i.jsxs)(r.ul,{children:["\n",(0,i.jsx)(r.li,{children:"PrimaryDisplay: \u53ea\u80fd\u5f15\u7528\u540e\u8fb9\u5217\u51fa\u7684 Display0\u3001Display1\u3001Display2\uff0c\u7528\u4e8e\u914d\u7f6e\u9ed8\u8ba4\u5b89\u5353\u4e3b\u663e \u4ee5\u53ca\u526f\u663e\uff0c\u82e5\u652f\u6301\u70ed\u63d2\u62d4\uff0c\u53ef\u540c\u65f6\u914d\u7f6e\u591a\u4e2a\u3002"}),"\n",(0,i.jsx)(r.li,{children:"ExternalDisplay: \u7c7b\u4f3c\u4e8e PrimaryDisplay\uff0c\u7528\u4e8e\u914d\u7f6e\u6309\u5b89\u5353\u526f\u663e\u3002"}),"\n",(0,i.jsx)(r.li,{children:"InterfaceType: \u63a5\u53e3\u7c7b\u578b\uff0c\u53ea\u80fd\u4e3a LCD/HDMI/CVBS \u4e4b\u4e00\u3002"}),"\n",(0,i.jsx)(r.li,{children:"DisplayEnginePortId: \u7ed1\u5b9a\u5230\u786c\u4ef6 DE \u7684\u5e8f\u53f7, \u4e00\u822c\u4e0d\u4fee\u6539\u3002"}),"\n",(0,i.jsx)(r.li,{children:"OverrideFramebufferSize: 1 \u8868\u793a\u4f7f\u7528 FramebufferWidth \u53ca FramebufferHeight \u4f5c\u4e3a UI \u5206\u8fa8 \u7387\u3002 \u2022"}),"\n",(0,i.jsx)(r.li,{children:"HotplugSupported\uff1a\u662f\u5426\u652f\u6301\u70ed\u63d2\u62d4\u3002"}),"\n"]}),"\n",(0,i.jsx)(r.h3,{id:"\u663e\u793a\u52a8\u6001\u914d\u7f6e\u63a5\u53e3\u5b9e\u73b0",children:"\u663e\u793a\u52a8\u6001\u914d\u7f6e\u63a5\u53e3\u5b9e\u73b0"}),"\n",(0,i.jsxs)(r.p,{children:["\u4ee3\u7801\u4f4d\u4e8e\uff1a",(0,i.jsx)(r.code,{children:"android/hardware/aw/display/libdisplayconfig"}),"\u3001",(0,i.jsx)(r.code,{children:"android/hardware/aw/display/interfaces "}),"\u663e\u793a\u7684\u4e00\u4e9b\u652f\u6301\u52a8\u6001\u914d\u7f6e\u7684\u8bbe\u7f6e\u9879\u5728\u6b64\u5b8c\u6210\u652f\u6301\uff0c\u4e3b\u8981\u5305\u62ec\u5982\u4eae\u5ea6\u5bf9\u6bd4\u5ea6\u9971\u548c\u5ea6\u7b49\u663e\u793a\u6548\u679c\u8c03\u6574 \u4ee5\u53ca\u663e\u793a\u5207\u8fb9\uff0cHDMI\u3001CVBS \u7684\u8f93\u51fa\u5206\u8fa8\u7387\u7b49\uff0c\u9664\u975e\u4ea7\u54c1\u652f\u6301 HDMI \u6216 CVBS\uff0c\u5426\u5219\u4e0d\u4f1a\u4f7f\u7528\u5230\u8be5 \u90e8\u5206\u4ee3\u7801\u3002"]}),"\n",(0,i.jsx)(r.h3,{id:"dispalyd",children:"dispalyd"}),"\n",(0,i.jsxs)(r.p,{children:["\u4ee3\u7801\u4f4d\u4e8e\uff1a",(0,i.jsx)(r.code,{children:"android/hardware/aw/display/libdisplayd"})," \u4e3b\u8981\u7528\u4e8e\u5bf9\u663e\u793a\u8f93\u51fa\u8bbe\u5907\u7684\u70ed\u63d2\u62d4\u3001\u8f93\u51fa\u6a21\u5f0f\u3001\u591a\u663e\u7b56\u7565\u7b49\u8fdb\u884c\u7ba1\u7406\uff0c\u9700\u8981\u8bbe\u5907\u652f\u6301 HDMI\u3001 CVBS \u7b49\u70ed\u63d2\u62d4\u8f93\u51fa\u63a5\u53e3\uff0c\u5426\u5219\u8be5\u90e8\u5206\u4ee3\u7801\u4e0d\u4f1a\u4f7f\u7528\u5230\u3002"]})]})}function p(e={}){const{wrapper:r}={...(0,d.a)(),...e.components};return r?(0,i.jsx)(r,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},11151:(e,r,n)=>{n.d(r,{Z:()=>s,a:()=>a});var i=n(67294);const d={},l=i.createContext(d);function a(e){const r=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(r):{...r,...e}}),[r,e])}function s(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:a(e.components),i.createElement(l.Provider,{value:r},e.children)}}}]);